<!doctype html>
<html lang="zh-Hans-CN">
<head>
  <meta charset="utf-8" />
  <title>KPMG Audit Compass</title>
  <base href="/AuditCompass/">
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <meta http-equiv="x-ua-compatible" content="ie=edge" />
  <link rel="icon" type="image/x-icon" href="favicon.ico" />
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
  <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css">

  
  <!-- ECharts -->
  <script src="https://unpkg.com/echarts@5/dist/echarts.min.js"></script>
  <script src="/static/echarts/map/js/china.js"></script>
  <script src="/static/js/audit-routine.js"></script>
  <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>

  

  <!-- ====== å¹³å°åŸºç¡€æ ·å¼CSS ====== -->
  <style>
  html,body{width:100%;height:100%}
  *,*:before,*:after{box-sizing:border-box}
  html{font-family:sans-serif;line-height:1.15;-webkit-text-size-adjust:100%}
  body{margin:0;color:#000000d9;font-size:14px;
    font-family:-apple-system,BlinkMacSystemFont,Segoe UI,Roboto,Helvetica Neue,Arial,Noto Sans,sans-serif,"Apple Color Emoji","Segoe UI Emoji",Segoe UI Symbol,"Noto Color Emoji";
    line-height:1.5715;background:var(--body-background)}
  :root{
    --primary-color:#1e49e2; --primary-color-opacity:rgba(30,73,226,.4);
    --deep-blue:#00338d; --base-space:16px;
    --table-head-background:#F6F8FE; --table-border:1px solid #f0f0f0;
    --warning-color:#faad14; --body-background:#f5f7fa;
    /* å…¼å®¹å†…å®¹é¡µè‡ªç”¨å˜é‡ */
    --primary:#2563eb; --primary-600:#1e40af; --muted:#64748b; --text:#0f172a;
    --bg:#f5f7fa; --card:#fff; --border:#e8e8ed; --shadow:0 6px 18px rgba(17,24,39,.08);
  }

  /* ====== é¡¶éƒ¨ Headerï¼ˆå ä½ï¼Œç±»åä¿æŒï¼Œç”¨äºæ— ç¼æ›¿æ¢ï¼‰ ====== */
  .layout-header {display:flex;align-items:center;height:48px;background:var(--primary-color);
    padding:0 16px;color:#fff;position:sticky;top:0;z-index:9999}
  .layout-header .layout-header-name{font-size:22px;font-weight:700}
  .layout-header .layout-header-project{margin-left:12px;opacity:.9}
  .layout-header .layout-header-nav{margin-left:auto;display:flex;gap:12px}

  /* ====== ä¸»å¸ƒå±€ ====== */
  .layout-main{display:flex;height:calc(100vh - 48px)}
  .sidebar{width:200px;background:#fff;border-right:1px solid #eaecef;overflow-y:auto}
  .sidebar-menu{list-style:none;margin:0;padding:8px}
  .sidebar-menu li{padding:8px 10px;border-radius:6px;cursor:pointer}
  .sidebar-menu li.active,.sidebar-menu li:hover{background:#f0f4ff}
  .main-right{flex:1;display:flex;flex-direction:column;overflow:hidden}
  .breadcrumb-bar{background:#fff;padding:6px 8px;color:#999;margin:0 var(--base-space)}
  .content-scroll{flex:1;overflow:auto}
  .content-wrap{margin:var(--base-space)}

  /* ====== å†…å®¹é¡µ ====== */
  .container{max-width:1480px;margin:auto}
  .header{display:flex;align-items:center;gap:12px}
  .header .breadcrumb{font-size:13px;color:var(--muted)}
  .toolbar{margin-left:auto;display:flex;gap:10px}
  .btn{padding:6px 10px;border-radius:6px;border:1px solid var(--border);
    background:linear-gradient(135deg,#fff,#f9fafb);cursor:pointer;font-size:13px;transition:all .25s ease}
  .btn:hover{border-color:var(--primary);box-shadow:0 2px 6px rgba(37,99,235,.2)}
  .btn-primary{background:linear-gradient(135deg,var(--primary),var(--primary-600));color:#fff;border:none}

  .tabbar{display:flex;gap:6px;border-bottom:2px solid var(--border);margin:10px 0 16px}
  .tab{padding:10px 14px;border-radius:8px 8px 0 0;color:var(--muted);cursor:pointer}
  .tab.active{background:#fff;border:1px solid var(--border);border-bottom:0;color:var(--primary)}
  .card{background:#fff;border:1px solid var(--border);border-radius:12px;box-shadow:var(--shadow);margin-bottom:16px;overflow:hidden}
  .card .head{display:flex;align-items:center;justify-content:space-between;padding:12px 16px;border-bottom:1px solid var(--border);background:#f9fbff;position:relative}
  .card .head::before{content:"";position:absolute;left:0;top:0;width:4px;height:100%;background:var(--primary)}
  .card .title{font-weight:600;margin-left:8px}
  .card .content{padding:14px 16px}
  

   
  .filters{display:flex;flex-wrap:wrap;gap:12px;align-items:center}
  .filters label{font-size:12px;color:var(--text)}
  .select{padding:4px 8px;font-size:12px;color:var(--text);background:#fff;border:1px solid var(--border);
    border-radius:6px;min-width:100px;transition:all .25s ease;box-shadow:0 2px 5px rgba(0,0,0,.05);appearance:none}
  .select:hover{border-color:var(--primary);box-shadow:0 0 0 3px rgba(37,99,235,.15)}
  .select:focus{outline:none;border-color:var(--primary-600);box-shadow:0 0 0 3px rgba(37,99,235,.25)}
  .chart{height:300px}

  .table{width:100%;border-collapse:collapse;font-size:13px}
  .table th,.table td{border:1px solid var(--border);padding:8px;text-align:center;white-space:nowrap}
  .table th{background:#f1f5ff;color:#1e293b;font-weight:600}
  .table tr:hover td{background:#f9fbff}
  .table-tabs{display:flex;gap:10px;margin:10px 0}
  .table-tab{padding:6px 14px;border:1px solid var(--border);border-radius:8px;background:#f8fafc;color:var(--muted);cursor:pointer}
  .table-tab.active{background:var(--primary);color:#fff;border-color:var(--primary)}

  .split{display:grid;grid-template-columns:300px 1fr;gap:16px}
  .sidebar-pane{background:#fff;border:1px solid var(--border);border-radius:12px;padding:12px}
  .menu{display:flex;flex-direction:column;gap:6px}
  .menu .item{padding:8px 10px;border:1px solid var(--border);border-radius:8px;background:#eef2ff;cursor:pointer;font-size:13px}
  .menu .item.active{background:#fff;outline:2px solid var(--primary-600)}
  .small{font-size:12px;color:var(--muted)}
  .top-strip{display:grid;grid-template-columns:repeat(6,1fr);gap:10px}
  .top-item{background:#f9fafb;border:1px solid var(--border);border-radius:10px;padding:10px 12px}
  .top-item .lbl{font-size:12px;color:var(--muted)}
  .top-item .num{font-weight:700;margin-top:6px}
  .rank-list{display:grid;gap:6px;margin-top:6px}
  .rank-row{display:flex;align-items:center;justify-content:space-between;font-size:12px;border-bottom:1px dashed var(--border);padding:4px 0}
  .rank .bul{display:inline-block;width:10px;height:10px;border-radius:50%;margin-right:8px}
  .grid-2{display:grid;grid-template-columns:2fr 1fr;gap:16px}
  .pagination{display:flex;gap:6px;flex-wrap:wrap;margin-top:10px}
  .pagination .btn{padding:6px 10px}
  .hide{display:none}
  #tblTop20 {
    width: 100%;
    border-collapse: collapse;
    font-size: 13px;
  }
  #tblTop20 th, #tblTop20 td {
    border: 1px solid #e5e7eb;
    padding: 6px 8px;
    text-align: center;
  }
  #tblTop20 th {
    background: #f9fafb;
    font-weight: 600;
  }
  .color-dot {
    display:inline-block;
    width:10px;
    height:10px;
    border-radius:50%;
    margin-right:4px;
  }
 
/* å³ä¸Šæ•´æ¡å¯¼èˆªåŒºåŸŸï¼šé å³å¯¹é½ */
.layout-header-nav {
  margin-left: auto;
  display: flex;
  align-items: center;
  gap: 8px;
  font-size: 13px;
  color: #fff;
}

/* é€šç”¨æŒ‰é’®æ ·å¼ï¼ˆæ–‡å­— / å›¾æ ‡æŒ‰é’®ç»Ÿä¸€åŸºå‡†ï¼‰ */
.nav-btn {
  height: 32px;
  padding: 0 12px;
  border-radius: 4px;
  border: none;
  background: transparent;
  color: #fff;
  display: inline-flex;
  align-items: center;
  justify-content: center;
  cursor: pointer;
  font-size: 13px;
  line-height: 1;
  white-space: nowrap;
}

.nav-btn:hover {
  background: rgba(255,255,255,0.20);
}

/* å¸¦æ–‡å­— + å›¾æ ‡ï¼ˆEricï¼‰ */
.nav-btn-with-icon {
  gap: 6px;
}

/* çº¯å›¾æ ‡æŒ‰é’®ï¼ˆæ‰“å° / åé¦ˆ / è®¾ç½®ï¼‰ */
.nav-icon-btn {
  width: 32px;
  padding: 0;
}

/* å›¾æ ‡ï¼ˆç»Ÿä¸€å¤§å° & é¢œè‰²è·Ÿéš currentColorï¼‰ */
.icon svg {
  width: 16px;
  height: 16px;
  fill: currentColor;
}

/* ============ å•ä½ / å°æ•°ä½ ä¸‹æ‹‰ ============ */

.header-dropdown {
  position: relative;
  display: inline-flex;
  align-items: center;
  height: 32px;
}

.header-btn {
  background: rgba(255,255,255,0.18);
}

.header-btn:hover {
  background: rgba(255,255,255,0.28);
}

/* ä¸‹æ‹‰åˆ—è¡¨ */
.dropdown-menu {
  position: absolute;
  top: 36px;
  left: 0;
  min-width: 120px;
  background: #fff;
  border: 1px solid #d0d7e2;
  border-radius: 4px;
  padding: 6px 0;
  margin: 0;
  list-style: none;
  box-shadow: 0 4px 12px rgba(0,0,0,0.12);
  display: none;
  z-index: 2000;
}

.dropdown-menu li {
  padding: 8px 12px;
  font-size: 13px;
  color: #333;
  cursor: pointer;
}

.dropdown-menu li:hover {
  background: #eef3ff;
  color: #1657b5;
}

/* hover å±•å¼€ */
.header-dropdown:hover .dropdown-menu {
  display: block;
}

/* ============ ä¸­ / EN åˆ†æ®µæŒ‰é’® ============ */
/* è¯­è¨€åŒºåŸŸæ•´ä½“ */
.lang-switch {
  display: inline-flex;
  align-items: center;
  gap: 8px;              /* ä¸­ å’Œ EN ä¹‹é—´çš„é—´è·ï¼Œå°±è·Ÿä½ å›¾é‡Œä¸€æ · */
}

/* è¯­è¨€æŒ‰é’®ï¼šåŸºäº nav-btn å†ç»†è°ƒ */
.lang-btn {
  padding: 0 8px;
  min-width: 32px;
  height: 32px;
  border-radius: 4px;
  border: none;
  background: transparent;
  color: #fff;
  font-size: 13px;
  cursor: pointer;
}

/* hover åªåšè½»å¾®é«˜äº® */
.lang-btn:hover {
  background: rgba(255,255,255,0.15);
}

/* å½“å‰è¯­è¨€ï¼šæ·±è‰²å°æ–¹å—ï¼ˆä½ æˆªå›¾é‡Œçš„â€œä¸­â€æ ·å¼ï¼‰ */
.lang-btn.lang-active {
  background: rgba(0, 0, 0, 0.25);  /* æ¯”é¡¶éƒ¨è“å†æ·±ä¸€ç‚¹ */
  box-shadow: 0 0 0 1px rgba(0,0,0,0.15) inset;
}

/* å½“å‰è¯­è¨€ hover å†ç¨å¾®äº®ä¸€ç‚¹å°±è¡Œ */
.lang-btn.lang-active:hover {
  background: rgba(0, 0, 0, 0.32);
}


/* === Sidebar: final, deduped copyright=== */
.layout-main{display:flex;height:calc(100vh - 48px);}
.sidebar{flex:0 0 230px;background:#f8f8f8;border-right:1px solid #ddd;padding:10px 16px;}
.main-right{flex:1;min-width:0;display:flex;flex-direction:column;}

.sidebar .sidebar-menu,
.sidebar .sidebar-menu ul,
.sidebar .sb-submenu{list-style:none;margin:0;padding-left:0}

/* é¡¶å±‚é¡¹ï¼šé¡¹ç›®åˆ—è¡¨ï¼ˆä¸æŠ˜å ï¼‰ */
.sidebar .sidebar-menu > li:not(.sb-toggle){
  display:flex;align-items:center;gap:8px;
  padding:12px 8px;border-radius:8px;
  color:#003366;font-size:15px;cursor:pointer;
}
.sidebar .sidebar-menu > li:not(.sb-toggle):hover{background:#eef3f8;}
.sidebar .ico{width:16px;text-align:center;font-size:14px;color:#003366;}
.sidebar .sb-txt{color:#003366;font-size:15px;white-space:nowrap;overflow:hidden;text-overflow:ellipsis;}
.sidebar .caret{margin-left:auto;font-size:12px;color:#8a8a8a;transition:transform .18s;}

/* å¯æŠ˜å é¡¹ï¼šå·¥ä½œç°¿è¯¦æƒ…ï¼ˆçºµå‘å®¹å™¨ï¼‰ */
.sidebar .sb-toggle{display:block;padding:0;}
.sidebar .sb-toggle-head{
  display:flex;align-items:center;gap:8px;
  padding:12px 8px;border-radius:8px;color:#003366;cursor:pointer;
}
.sidebar .sb-toggle-head:hover{background:#eef3f8;}
.sidebar .sb-toggle.open .caret{transform:rotate(90deg);}

/* äºŒçº§èœå•ï¼ˆåµŒå…¥ sb-toggle å†…ï¼‰ */
.sidebar .sb-submenu{display:none;margin:4px 0 8px 16px;}
.sidebar .sb-toggle.open > .sb-submenu{display:block;}

/* äºŒçº§è¡Œï¼šä¸¤åˆ—ç½‘æ ¼ï¼ˆå›¾æ ‡/æ–‡æœ¬ï¼‰ï¼Œæ— å›¾æ ‡é¡¹å ä½ä»¥å¯¹é½ */
.sidebar .sb-submenu .sb-row{
  display:grid;grid-template-columns:18px 1fr;align-items:center;
  column-gap:8px;padding:8px 6px;border-radius:8px;color:#333;font-size:14px;cursor:pointer;
}
.sidebar .sb-submenu .sb-row:hover{background:#eef3f8;color:#2f5ea8;}
.sidebar .sb-submenu .sb-row .sb-txt{color:#333;}
.sidebar .sb-submenu .sb-row:not(.active)::before{content:"";width:18px;height:18px;}

/* é€‰ä¸­ï¼šåªæœ‰â€œé“¶è¡Œæµæ°´åˆ†æâ€æœ‰ç»¿è‰²åœ†åœˆä¸é«˜äº® */
.sidebar .sb-submenu .sb-row.active{background:#e9f2ff;font-weight:600;color:#2f5ea8;}
.sidebar .sb-submenu .sb-row.active .sb-txt{color:#2f5ea8;}
.sidebar .sb-submenu .sb-row.active .ico{color:#32b27c;font-size:15px;}

/* ç½®ç°ç¦ç”¨é¡¹æ ·å¼ */
.sidebar .sb-submenu .sb-row.disabled {
  color: #999 !important;
  background: transparent !important;
  cursor: not-allowed !important;
  opacity: 0.6;
  pointer-events: none;  /* ç¦æ­¢ç‚¹å‡» */
}

.sidebar .sb-submenu .sb-row.disabled .sb-txt {
  color: #999 !important;
}
.main-right { flex:1; display:flex; flex-direction:column; }

/* ===============================
   Breadcrumb é¢åŒ…å±‘å¯¼èˆª
   =============================== */
/* è¿”å›æŒ‰é’®ï¼šè“è‰² */
.breadcrumb-bar {
  background:#fff;
  border-bottom:1px solid #e6edf5;
  padding:12px 20px;
  font-size:14px;
  color:#94a3b8;   /* é»˜è®¤æµ…ç°ï¼Œä½œä¸ºè·¯å¾„åŸºè‰² */
}

/* å·¦ä¾§â€œè¿”å›é¡¹ç›®åˆ—è¡¨â€â€”â€”æ·±è“ã€å¼ºè°ƒ */
.breadcrumb-bar .back-link {
  color:#003366;
  font-weight:600;
  text-decoration:none;
  margin-right:4px;
}

/* åˆ†éš”ç¬¦ï¼ˆæ›´æµ…ä¸€ç‚¹çš„ç°ï¼‰ */
.breadcrumb-bar .sep {
  margin:0 6px;
  color:#cbd5e1;   /* åˆ†éš”ç¬¦æ¯”æ–‡å­—å†æµ…ä¸€çº§ */
}

/* è·¯å¾„æ–‡å­—ï¼ˆTest / audit compass â€¦ï¼‰ */
.breadcrumb-bar span {
  color:#94a3b8;   /* æµ…ç° */
}

/* å½“å‰é¡µé¢ï¼ˆé“¶è¡Œæµæ°´åˆ†æï¼‰ï¼šæ·±ç°ï¼Œä½†ä¸é»‘ã€ä¸åŠ ç²— */
.breadcrumb-bar b {
  color:#475569;   /* æ·±ç°ï¼Œæ¯”å‰é¢æ›´çªå‡º */
  font-weight:500;
}


/* é¡¶éƒ¨æ•´ä½“ï¼šå·¦ KPI + å³ é—®é¢˜åˆ†æ */
.kpi-and-issue{
  display:grid;
  grid-template-columns: minmax(520px, 1fr) 520px;
  gap:10px;
  padding:8px 16px 6px;
}

/* å·¦ä¾§ KPIï¼šä¸¤è¡Œç»“æ„ï¼ˆå‰ä¸‰åˆ—æ›´ç˜¦ï¼Œå³ä¸¤åˆ—æ›´é•¿ï¼‰ */
.kpi-grid{
  display:grid;
  grid-template-columns: 0.8fr 0.8fr 0.8fr 1.2fr 1.2fr;
  grid-template-rows: 64px 64px;
  gap:10px;
  align-items:stretch;
  grid-template-areas:
    "k1 k2 k3 k4 k5"
    "k1 k2 k3 k6 k7";
}

/* KPI åŒºåŸŸæ˜ å°„ */
.k1{ grid-area:k1; } .k2{ grid-area:k2; } .k3{ grid-area:k3; }
.k4{ grid-area:k4; } .k5{ grid-area:k5; } .k6{ grid-area:k6; } .k7{ grid-area:k7; }

/* é€šç”¨ KPI æ ·å¼ */
.kpi{
  background:#f8fafc;
  border:1px solid #e6edf5;
  border-radius:8px;
  padding:6px 10px;
  display:flex;
  flex-direction:column;
  justify-content:center;
  align-items:flex-start;
}
.kpi-label{
  font-size:17px;
  color:#334155;
  font-weight:600;
  margin-bottom:3px;
  white-space:nowrap;
}
.kpi-value{
  font-size:17px;
  font-weight:700;
  color:#0f172a;
  line-height:1.1;
  white-space:nowrap;
}
.kpi-value.pos{color:#0f7a43}
.kpi-value.neg{color:#b2162a}
.link-num{ text-decoration:none; border-bottom:1px dotted currentColor }
.link-num:hover{ opacity:.85 }
.link-num.danger{ color:#D2283E }

/* âœ… å‰ä¸‰åˆ—ï¼ˆk1~k3ï¼‰å†…å®¹æ•´ä½“å±…ä¸­ */
.k1, .k2, .k3 {
  display:flex !important;
  flex-direction:column !important;
  justify-content:center !important;
  align-items:center !important;
  text-align:center !important;
}

/* âœ… å³ä¾§ 2Ã—2ï¼ˆk4~k7ï¼‰æ¨ªæ’ï¼Œæ•°å€¼å³å¯¹é½ */
.k4,.k5,.k6,.k7{
  display:flex !important;
  flex-direction:row !important;
  align-items:center !important;
  justify-content:space-between !important;
}
.k4 .kpi-label,.k5 .kpi-label,.k6 .kpi-label,.k7 .kpi-label{margin-bottom:0}
.k4 .kpi-value,.k5 .kpi-value,.k6 .kpi-value,.k7 .kpi-value{
  margin-left:auto; text-align:right;
}

/* âœ… æ•°æ®é—®é¢˜åˆ†æå¡ï¼ˆä¸å·¦ä¾§KPIæ€»é«˜ä¸€è‡´ï¼‰ */
.issue-card{
  background:#fffdf7;
  border:1px solid #ffe6b3;
  border-radius:8px;
  padding:10px 12px;
  height:calc(60px * 2 + 10px);  /* è·Ÿå·¦ä¾§ä¸¤è¡Œæ€»é«˜ä¸€è‡´ï¼ˆ2*è¡Œé«˜ + gapï¼‰ */
  display:flex;
  flex-direction:column;
  justify-content:space-between;
}
.issue-head{
  display:flex;
  align-items:center;
  justify-content:space-between;
  margin-bottom:6px;
}
.issue-title{color:#8a5c00;font-weight:600}
.issue-link{
  font-size:12px;
  color:#8a5c00;
  text-decoration:none;
  border:1px solid #f5cf85;
  padding:2px 8px;
  border-radius:999px;
  background:#fff7e3;
}
.dot{width:8px;height:8px;border-radius:50%;display:inline-block;margin-right:6px}
.dot-warn{background:#f59e0b;box-shadow:0 0 0 3px rgba(245,158,11,.15)}
.issue-body{color:#8a5c00;font-size:12px;line-height:1.45;flex:1;overflow:auto}
.issue-foot{margin-top:6px}
.mini-link{font-size:12px;color:#8a5c00;text-decoration:underline}

/* ====== æ•°æ®é—®é¢˜å¡æ ¸å¿ƒæ ·å¼ ====== */
.issue-card{
  position: relative;
  background:#fffdf7;
  border:1px solid #ffe6b3;
  border-radius:8px;
  padding:10px 16px 30px;         /* é¢„ç•™åº•éƒ¨ç©ºé—´ç»™å›ºå®šæŒ‰é’® */
  height:calc(60px * 2 + 16px);   /* ä¿æŒä¸å·¦ä¾§ä¸¤è¡ŒKPIç­‰é«˜ */
  display:flex;
  flex-direction:column;
  justify-content:flex-start;
  overflow:hidden;                /* é˜²æ­¢å¤–æº¢ */
}

/* é¡¶éƒ¨æ ‡é¢˜æ  */
.issue-head{
  display:flex;
  align-items:center;
  justify-content:space-between;
  margin-bottom:6px;
}
.issue-title{color:#8a5c00;font-weight:600;font-size:14px;}
.issue-link{
  font-size:12px;
  color:#8a5c00;
  text-decoration:none;
  border:1px solid #f5cf85;
  padding:2px 8px;
  border-radius:999px;
  background:#fff7e3;
}
.issue-link:hover{background:#ffeab5;}

/* å†…å®¹åŒºå¯æ»šåŠ¨ */
.issue-body-simple{
  font-size:12px;
  color:#8a5c00;
  line-height:1.65;
  overflow-y:auto;
  padding-right:8px;
  flex:1;
}

/* ç¬¬ä¸€è¡Œè¯´æ˜ */
.issue-note b{ color:#8a5c00; }

/* ç¬¬äºŒè¡Œï¼šçº¢è‰²è­¦ç¤º + è·³è½¬é“¾æ¥ */
.issue-inline{
  display:flex;
  align-items:center;
  gap:6px;
  margin:0;
  flex-wrap:wrap;
}
.dot-danger{
  width:8px;
  height:8px;
  border-radius:50%;
  background:#dc2626;
  box-shadow:0 0 0 3px rgba(220,38,38,.12);
}
.issue-inline span{
  color:#b2162a;
  font-weight:500;
}
.issue-inline-link{
  color:#b2162a;
  font-weight:600;
  text-decoration:none;
  border-bottom:1px dotted currentColor;
  margin-left:4px;
}
.issue-inline-link:hover{ opacity:.85; }

/* å›ºå®šå³ä¸‹è§’æŒ‰é’® */
.issue-toggle{
  position:absolute;
  right:12px;
  bottom:8px;
  font-size:12px;
  color:#475569;
  text-decoration:underline;
  background:#fffdf7;
  padding:2px 6px;
  border-radius:4px;
  cursor:pointer;
  z-index:2;
}
.issue-toggle:hover{ color:#003366 }

/* å¯é€‰ï¼šç»†æ»šåŠ¨æ¡ï¼ˆç¾åŒ–ï¼‰ */
.issue-body-simple::-webkit-scrollbar{ width:6px; }
.issue-body-simple::-webkit-scrollbar-thumb{
  background:rgba(0,0,0,.15);
  border-radius:4px;
}
.issue-body-simple::-webkit-scrollbar-track{ background:transparent; }











/* ===== Tab å®¹å™¨ï¼šå¼ºåˆ¶æ’‘æ»¡æ•´è¡Œï¼Œä¸ KPI å·¦å¯¹é½ ===== */
.tab-container{
  background:#fff;
  border:1px solid #e6edf5;
  border-radius:8px;
  margin:10px px 0;      /* å’Œ .chart-card ä¸€æ ·ç”¨å¤–è¾¹è·å¯¹é½ */
  padding:0;
  box-shadow:0 1px 3px rgba(0,0,0,.04);
  box-sizing:border-box;

  /* â›” åˆ æ‰ calcï¼Œé¿å…å†æ¬¡è¢«çˆ¶å®¹å™¨â€œç¼©ä¸€éâ€ */
  width:auto;              /* è®©çˆ¶å®¹å™¨å†³å®šå®½åº¦ */
  min-width:0;
  max-width:none;

  /* æ— è®ºçˆ¶çº§æ˜¯ grid è¿˜æ˜¯ flexï¼Œéƒ½å¼ºåˆ¶è·¨æ•´è¡Œå¹¶æ‹‰æ»¡ */
  grid-column: 1 / -1;     /* Grid: è·¨å…¨åˆ— */
  justify-self: stretch;   /* Grid: æ‹‰æ»¡ */
  align-self: stretch;     /* Flex/Grid: æ‹‰æ»¡ */
  flex: 1 1 auto;          /* Flex: å¯ä¼¸å±• */
}

/* ===== Tab è¡Œï¼šæ‹‰æ»¡å®¹å™¨ï¼Œç¦ç”¨ä»»ä½• margin ç¼©çŸ­ ===== */
.tab-container .tabbar{
  position:relative;
  display:flex;
  align-items:center;
  flex-wrap:nowrap;
  gap:10px;

  padding:10px 16px 8px;   /* ä¸å¡ç‰‡å†…å®¹ç•™ç™½ä¸€è‡´ */
  margin:0 !important;     /* è¦†ç›–å…¨å±€ `.tabbar{ margin:8px 16px }` çš„å¹²æ‰° */

  border-bottom:1px solid #e6edf5;
  background:#fff;

  width:100%;
  max-width:100%;
  min-width:0;
  overflow-x:auto;
  overflow-y:hidden;
}


/* ===== å•ä¸ª Tabï¼šä»…æ–‡å­—å˜åŒ–ï¼Œä¸é«˜äº®æ•´å—èƒŒæ™¯ ===== */
.tab-container .tab{
  flex:0 0 auto;
  padding:10px 16px;
  cursor:pointer;
  color:#475569;
  border:none;
  background:transparent;
  white-space:nowrap;
  transition:color .15s;
}
.tab-container .tab:hover{ background:transparent; color:#1e40af; }
.tab-container .tab.active{ color:#003366; font-weight:600; background:transparent; }

/* ===== inkbarï¼šåº•éƒ¨è“çº¿ ===== */
.tab-container .inkbar{
  position:absolute;
  bottom:0;
  height:2px;
  background:#003366;   /* ä¸ KPI ä¸»è‰²ä¸€è‡´ */
  border-radius:2px;
  transition:left .25s ease, width .25s ease;
}

/* ===== è¯´æ˜æ¡ï¼ˆä¸å˜ï¼‰ ===== */
.tab-container .tab-intro{
  display:flex;
  align-items:center;
  gap:8px;
  padding:8px 16px 12px 16px;   /* â† ä¸ tabbar åŒæ­¥ä¸º 16px */
  color:#334155;
  font-size:13.5px;
  line-height:2;
  width:100%;
  box-sizing:border-box;
}
.tab-container .ti-icon{ width:14px; height:14px; margin-top:2px; color:#1e40af;flex-shrink:0; }
.tab-container .ti-title{ font-weight:600; margin-right:6px; }

/* è®© Tabs å’Œ æ¯ä¸ª Tab é¡µçš„å†…å®¹ï¼Œç”¨åŒä¸€æ¡â€œå†…å®¹å®½åº¦â€ */

.tab-pane{
  border:1px solid #e6edf5;
  border-radius:8px;
  margin:10px px 0;      /* å’Œ .chart-card ä¸€æ ·ç”¨å¤–è¾¹è·å¯¹é½ */
  padding:0;
  box-shadow:0 1px 3px rgba(0,0,0,.04);
  box-sizing:border-box;

  /* â›” åˆ æ‰ calcï¼Œé¿å…å†æ¬¡è¢«çˆ¶å®¹å™¨â€œç¼©ä¸€éâ€ */
  width:auto;              /* è®©çˆ¶å®¹å™¨å†³å®šå®½åº¦ */
  min-width:0;
  max-width:none;

  /* æ— è®ºçˆ¶çº§æ˜¯ grid è¿˜æ˜¯ flexï¼Œéƒ½å¼ºåˆ¶è·¨æ•´è¡Œå¹¶æ‹‰æ»¡ */
  grid-column: 1 / -1;     /* Grid: è·¨å…¨åˆ— */
  justify-self: stretch;   /* Grid: æ‹‰æ»¡ */
  align-self: stretch;     /* Flex/Grid: æ‹‰æ»¡ */
  flex: 1 1 auto;          /* Flex: å¯ä¼¸å±• */

}

/* æ¯ä¸ª Tab é¡µé‡Œçš„å¡ç‰‡ï¼šå æ»¡å½“å‰å†…å®¹å®½åº¦ */
.tab-pane .card{
  width:auto;              /* è®©çˆ¶å®¹å™¨å†³å®šå®½åº¦ */
  min-width:0;
  max-width:none;
  box-sizing: border-box;
}

/* è®©æ¯ä¸ª Tab é¡µä¸‹é¢çš„å†…å®¹è‡ªå·±æ»šåŠ¨ */
/* ========= è®© tab-scroll è‡ªå·±æ»š ========= */
.tab-scroll{
  /* å æ»¡æ•´è¡Œï¼Œè®©æ»šåŠ¨æ¡åœ¨æœ€å³è¾¹ */
  width: 100%;
  margin: 0;
  padding-right: 8px;      /* é¢„ç•™ä¸€ç‚¹ï¼Œæ»šåŠ¨æ¡ä¸ä¼šå‹ä½å†…å®¹ */
  box-sizing: border-box;

  /* å†…éƒ¨æ»šåŠ¨ï¼šé«˜åº¦ = è§†å£é«˜åº¦ - ä¸Šé¢å›ºå®šåŒº */
  max-height: calc(100vh - 280px);  /* 280 å¯æŒ‰éœ€è¦æ”¹æˆ 260/300 ç­‰ */
  overflow-y: auto;
  overflow-x: hidden;

  /* æ»šåŠ¨æ¡ç¾åŒ–ï¼ˆä¿æŒä½ åŸæ¥çš„é£æ ¼ï¼‰ */
  scrollbar-width: thin;
  scrollbar-color: rgba(15,23,42,.18) transparent;
}





/* Tab 1 è´¦æˆ·æ€»è§ˆ */

/* å›¾ä¾‹ */
.legend{display:flex;gap:14px;justify-content:flex-end;margin:6px 0 10px}
.legend i{width:10px;height:10px;border-radius:2px;display:inline-block;margin-right:6px}
.lg-warn{background:#facc15}.lg-none{background:#cbd5e1}.lg-ok{background:#3b82f6}.lg-err{background:#ef4444}

/* æ§åˆ¶å‚æ•° */
.check-scope{--dot:12px;--col:22px;--gap:4px;--sepw:20px;--year:#334155}

/* è¡¨å¤´ä¸ç®­å¤´ */
.check-head{display:flex;align-items:center;gap:8px;color:#475569;font-size:13px;user-select:none;white-space:nowrap}
.check-head .y{color:var(--year);font-weight:600}
.arrow-btn{display:inline-flex;align-items:center;justify-content:center;width:26px;height:24px;border:1px solid #cbd5e1;background:#fff;border-radius:6px;cursor:pointer;transition:.25s}
.arrow-btn:hover{background:#f1f5f9}
.arrow-btn svg{width:14px;height:14px;fill:#334155;transition:transform .25s}
.arrow-btn.expanded svg{transform:rotate(90deg)}

/* æœˆä»½ç½‘æ ¼ */
.months-grid{
  display:inline-grid;
  align-items:center;justify-content:flex-start;
  column-gap:var(--gap);
  grid-template-columns:[y24] repeat(12,var(--col));
  width:max-content;white-space:nowrap;
}
.check-scope.expanded .months-grid{
  grid-template-columns:[y23] repeat(12,var(--col)) [sep] var(--sepw) [y24] repeat(12,var(--col));
}

/* å¹´ä»½æ ‡ç­¾ç½‘æ ¼ */
.y-labels{
  display:inline-grid;align-items:center;column-gap:var(--gap);
  grid-template-columns:[y24] repeat(12,var(--col));
  width:max-content;
}
.check-scope.expanded .y-labels{
  grid-template-columns:[y23] repeat(12,var(--col)) [sep] var(--sepw) [y24] repeat(12,var(--col));
}
.y-2023{grid-column:y23}
.y-2024{grid-column:y24}
.sep-label{grid-column:sep;text-align:center;color:#94a3b8}

/* æ”¶èµ·é»˜è®¤éšè—2023åˆ— */
.y-2023,.sep-label,.col-2023,.col-sep{display:none!important}
.check-scope.expanded .y-2023,
.check-scope.expanded .sep-label,
.check-scope.expanded .col-2023,
.check-scope.expanded .col-sep{display:inline-block!important}

/* æœˆä»½æ•°å­—ï¼ˆåˆè®¡è¡Œï¼‰ */
.month-num{font-size:12px;color:#64748b;text-align:center;line-height:1}

/* æ•°æ®ç‚¹ */
.months-grid .chk-dot{display:inline-block;width:var(--dot);height:var(--dot);border-radius:3px;vertical-align:middle}
.months-grid .chk-ok{background:#3b82f6}
.months-grid .chk-none{background:#cbd5e1}
.months-grid .chk-warn{background:#facc15}
.months-grid .chk-err{background:#ef4444}

/* è¡¨æ ¼åˆ—å®½ä¼˜åŒ– */
.table{table-layout:auto}
.table th.check-col,.table td.check-col{width:1%;white-space:nowrap}
.table td .check-row{padding:6px 0}

/* ===== è¡¨å¤´é¢œè‰²å®šä¹‰ ===== */
.table thead th {
  background: #F6F8FE;   /* è¿™æ˜¯ä½ æˆªå›¾ä¸­è¡¨å¤´çš„æµ…è“ç°è‰²ï¼Œå¯æ¢å…¶ä»–è‰² */
  color: #0f172a;         /* å­—ä½“é¢œè‰² */
  font-weight: 600;
}

/* ===== åˆè®¡è¡Œä¸è¡¨å¤´åŒè‰² ===== */
.table tr.sum-row td {
  background: #F6F8FE;
  color: #0f172a;
  font-weight: 600;
}

/* ç¼ºå¤±åŒåè´¦æˆ·å¯å±•å¼€æŒ‰é’®æ ·å¼ */
.expand-btn{
  border:none;
  background:none;
  cursor:pointer;
  font-size:14px;
  margin-right:4px;
  color:#334155;
  transition:.2s;
}
.expand-btn:hover{color:#1e3a8a}

/* è¡Œæ ·å¼ */
.group-row td{
  font-weight:600;
  background:#F6F8FE;  /* æµ…ç°åº•ï¼ŒåŒºåˆ†å±‚çº§ */
}
.detail-row{
  background:#ffffff;   /* æ˜ç»†è¡Œç™½åº• */
}
.text-muted{
  color:#94a3b8;
  font-size:12px;
}

/* ===== æ“ä½œåˆ—å›¾æ ‡æ ·å¼ ===== */
.actions a {
  display: inline-block;
  margin: 0 6px;
  font-size: 16px;
  color: #2563eb;          /* è“è‰²ï¼Œä¸æŒ‰é’®ä¸€è‡´ */
  text-decoration: none;
  transition: 0.2s ease;
}
.actions a:hover {
  color: #1e3a8a;          /* æ·±è“ hover æ•ˆæœ */
  transform: scale(1.1);
}

/* å¯é€‰ï¼šè®©æ“ä½œåˆ—å›ºå®šå®½åº¦ï¼Œå›¾æ ‡å±…ä¸­ */
.actions {
  text-align: center;
  min-width: 70px;
}

#btnAccountLogic::before {
  content: "ğŸ’¡";           /* ç¯æ³¡å›¾æ ‡ */
  margin-right: 6px;
  font-size: 15px;
  vertical-align: middle;
}

#btnAccountTips::before {
  content: "â­";           /* æ˜Ÿæ˜Ÿå›¾æ ‡ */
  margin-right: 6px;
  font-size: 15px;
  vertical-align: middle;
}
/* æŒ‰é’®å†…å®¹æ•´ä½“å¯¹é½å¾®è°ƒï¼ˆå¯é€‰ï¼‰ */
.head-inline .btn {
  display: inline-flex;
  align-items: center;     /* âœ… å›¾æ ‡ä¸æ–‡å­—å‚ç›´å±…ä¸­ */
  justify-content: center;
  gap: 4px;                /* å›¾æ ‡å’Œæ–‡å­—ä¹‹é—´çš„é—´è· */
}

/* ========== è¡¨å¤´åŒç®­å¤´ç¾åŒ–ï¼ˆç´§å‡‘å¯¹é½ç‰ˆï¼‰ ========== */

/* ==================== è¡¨å¤´åŒç®­å¤´æ ·å¼ ==================== */
#tblAccountSummary thead th.sortable:not(.check-col) {
  position: relative;
  padding-right: 20px;         /* ç®­å¤´é¢„ç•™ç©ºé—´ */
  cursor: pointer;
  color: #334155;
  font-weight: 500;
  user-select: none;
  white-space: nowrap;
}

/* é»˜è®¤çŠ¶æ€ï¼šä¸Šä¸‹ç°ç®­å¤´ */
#tblAccountSummary thead th.sortable:not(.check-col)::before,
#tblAccountSummary thead th.sortable:not(.check-col)::after {
  content: "";
  position: absolute;
  right: 6px;
  border-left: 4px solid transparent;
  border-right: 4px solid transparent;
  opacity: 0.6;
  transition: all 0.2s ease;
}

/* ä¸Šç®­å¤´ï¼ˆæœä¸Šï¼‰ */
#tblAccountSummary thead th.sortable:not(.check-col)::before {
  top: calc(50% - 6px);
  border-bottom: 6px solid #cbd5e1;
}

/* ä¸‹ç®­å¤´ï¼ˆæœä¸‹ï¼‰ */
#tblAccountSummary thead th.sortable:not(.check-col)::after {
  top: calc(50% + 3px);
  border-top: 6px solid #cbd5e1;
}

/* æ‚¬åœæ—¶æ•´ä½“å˜äº® */
#tblAccountSummary thead th.sortable:not(.check-col):hover::before,
#tblAccountSummary thead th.sortable:not(.check-col):hover::after {
  border-bottom-color: #94a3b8;
  border-top-color: #94a3b8;
  opacity: 0.9;
}

/* å‡åºï¼šä¸Šç®­å¤´è“ï¼Œä¸‹ç®­å¤´ç° */
#tblAccountSummary thead th.sortable.sort-asc:not(.check-col)::before {
  border-bottom-color: #1e40af;
  opacity: 1;
}
#tblAccountSummary thead th.sortable.sort-asc:not(.check-col)::after {
  border-top-color: #cbd5e1;
  opacity: 0.5;
}

/* é™åºï¼šä¸‹ç®­å¤´è“ï¼Œä¸Šç®­å¤´ç° */
#tblAccountSummary thead th.sortable.sort-desc:not(.check-col)::after {
  border-top-color: #1e40af;
  opacity: 1;
}
#tblAccountSummary thead th.sortable.sort-desc:not(.check-col)::before {
  border-bottom-color: #cbd5e1;
  opacity: 0.5;
}

/* æ˜ç¡®ä¸æ˜¾ç¤ºç®­å¤´çš„åˆ— */
#tblAccountSummary thead th.nosort::before,
#tblAccountSummary thead th.nosort::after {
  content: none !important;
}

/* ==================== è¡¨å¤´åŒç®­å¤´æ ·å¼ ==================== */
#tblMissingSameName thead th.sortable:not(.check-col) {
  position: relative;
  padding-right: 20px;
  cursor: pointer;
  color: #334155;
  font-weight: 500;
  user-select: none;
  white-space: nowrap;
}

/* é»˜è®¤çŠ¶æ€ï¼šä¸Šä¸‹ç°ç®­å¤´ */
#tblMissingSameName thead th.sortable:not(.check-col)::before,
#tblMissingSameName thead th.sortable:not(.check-col)::after {
  content: "";
  position: absolute;
  right: 6px;
  border-left: 4px solid transparent;
  border-right: 4px solid transparent;
  opacity: 0.6;
  transition: all 0.2s ease;
}

/* ä¸Šç®­å¤´ï¼ˆæœä¸Šï¼‰ */
#tblMissingSameName thead th.sortable:not(.check-col)::before {
  top: calc(50% - 6px);
  border-bottom: 6px solid #cbd5e1;
}

/* ä¸‹ç®­å¤´ï¼ˆæœä¸‹ï¼‰ */
#tblMissingSameName thead th.sortable:not(.check-col)::after {
  top: calc(50% + 3px);
  border-top: 6px solid #cbd5e1;
}

/* æ‚¬åœäº®ä¸€ç‚¹ */
#tblMissingSameName thead th.sortable:not(.check-col):hover::before,
#tblMissingSameName thead th.sortable:not(.check-col):hover::after {
  border-bottom-color: #94a3b8;
  border-top-color: #94a3b8;
  opacity: 0.9;
}

/* âœ… å‡åºçŠ¶æ€ */
#tblMissingSameName thead th.sortable.sort-asc:not(.check-col)::before {
  border-bottom-color: #1e40af;
  opacity: 1;
}
#tblMissingSameName thead th.sortable.sort-asc:not(.check-col)::after {
  border-top-color: #cbd5e1;
  opacity: 0.4;
}

/* âœ… é™åºçŠ¶æ€ */
#tblMissingSameName thead th.sortable.sort-desc:not(.check-col)::after {
  border-top-color: #1e40af;
  opacity: 1;
}
#tblMissingSameName thead th.sortable.sort-desc:not(.check-col)::before {
  border-bottom-color: #cbd5e1;
  opacity: 0.4;
}

/* ä¸æ’åºçš„åˆ— */
#tblMissingSameName thead th.nosort::before,
#tblMissingSameName thead th.nosort::after {
  content: none !important;
}





/* Tab 2 ç»è¥å®è´¨ */
.biz-filter-bar {
  background:#fff;
  padding: 4px 12px 10px;
  border-left:1px solid #e5edf5;
  border-right:1px solid #e5edf5;
  border-bottom:1px solid #e5edf5;
}

/* å–æ¶ˆå¤–å±‚ cardï¼ˆä½ è¦æ±‚çš„ï¼‰ */
.biz-filter-bar .filter-card {
  background:transparent;
  border:none;
  box-shadow:none;
  padding:0;
  margin:0;
}

/* æ•´ä½“ç­›é€‰åŒºåŸŸç´§å‡‘å¸ƒå±€ */
.biz-filter-bar .filter-area {
  display:flex;
  flex-wrap:wrap;
  align-items:center;
  gap:10px 14px;
  padding:6px 0 4px;
}

/* å°å­—ä½“ã€ç´§å‡‘è¡Œé«˜ */
.biz-filter-bar .filter-area label {
  font-size:12px;
  color:#334155;
  font-weight:600;
  line-height:28px;
  margin-right:4px;
}

/* èƒ¶å›Šè¾“å…¥æ¡†/ä¸‹æ‹‰æ¡†ï¼ˆæ•´ä½“ç¼©å°ï¼‰ */
.biz-filter-bar select,
.biz-filter-bar input[type="text"],
.biz-filter-bar input[type="date"] {
  font-size:12px;
  height:30px;
  line-height:30px;
  padding:0 12px;
  min-width:130px;
  border:1px solid #cfd9e5;
  border-radius:50px;
  background:#fff;
  transition:.2s;
}

/* Hover + Focus æ•ˆæœä¿ç•™ */
.biz-filter-bar select:hover,
.biz-filter-bar input:hover {
  border-color:#1e49e2;
  box-shadow:0 0 0 2px rgba(30,73,226,.1);
}
.biz-filter-bar select:focus,
.biz-filter-bar input:focus {
  outline:none;
  border-color:#0d3bc4;
  box-shadow:0 0 0 2px rgba(13,59,196,.15);
}

/* â€œè‡³â€ */
.biz-filter-bar .range-sep {
  margin:0 4px;
  color:#64748b;
  font-size:12px;
  line-height:30px;
}

/* æŒ‰é’®ä¹Ÿç¼©å° */
.biz-filter-bar button {
  height:30px;
  font-size:12px;
  padding:0 14px;
  border-radius:50px;
  cursor:pointer;
  transition:.2s;
}

/* ä¸»è‰²æŒ‰é’® */
.biz-filter-bar .query { background:#1e49e2; color:#fff; }
.biz-filter-bar .query:hover { background:#0d3bc4; }

/* é‡ç½®æŒ‰é’® */
.biz-filter-bar .reset { background:#eef3fb; color:#334155; }
.biz-filter-bar .reset:hover { background:#e6eefc; }

/* ä¸‹æ‹‰ç®­å¤´ */
.biz-filter-bar .select-wrap {
  position:relative;
  display:inline-block;
}
.biz-filter-bar .select-wrap select {
  appearance:none;
  padding-right:30px;
}
.biz-filter-bar .select-wrap .chev {
  position:absolute;
  right:10px;
  top:50%;
  width:15px;
  height:15px;
  transform:translateY(-50%);
  opacity:.7;
}

/* â€œä¸åŒ…å«â€ å°åœ†ç‚¹ */
.biz-filter-bar .negate {
  display:inline-flex;
  align-items:center;
  gap:4px;
  font-size:12px;
  color:#5b6b7e;
}
.biz-filter-bar .negate input {
  appearance:none;
  width:12px;
  height:12px;
  border:2px solid #7788a0;
  border-radius:50%;
}
.biz-filter-bar .negate input:checked {
  border-color:#1e49e2;
}
.biz-filter-bar .negate input:checked::after {
  content:"";
  position:absolute;
  inset:2px;
  border-radius:50%;
  background:#1e49e2;
}

/* ç»è¥å®è´¨ä¸‹é¢çš„å†…å®¹ç»§ç»­å†…éƒ¨æ»šåŠ¨ï¼ˆå¦‚æœä½ è¦å†…éƒ¨æ»šåŠ¨çš„è¯ï¼‰*/
#page-biz .tab-scroll {
  max-height: calc(100vh - 260px);  /* 260 å¯ä»¥æŒ‰å±å¹•å†å¾®è°ƒï¼Œè¶Šå¤§å¯è§åŒºåŸŸè¶Šå¤š */
  overflow-y: auto;
  overflow-x: hidden;
  padding-bottom: 16px;
  box-sizing: border-box;
}

/* ====== ç»è¥å®è´¨é¢æ¿ ====== */
#pane-biz .panel{
  position:relative;
  background:#fff;
  border:1px solid #e6edf5;
  border-radius:10px;
  margin:12px 16px;
  padding:12px 16px 16px 28px; /* å·¦ä¾§ç•™ç©ºé—´ */
  box-shadow:0 2px 8px rgba(17,24,39,.04);
}
#pane-biz .panel::before{
  content:"";
  position:absolute;
  left:10px; top:12px; bottom:12px;
  width:4px; border-radius:4px;
  background:#dadbe0;
}

/* é¢æ¿å¤´éƒ¨ */
#pane-biz .panel-head{
  display:flex; align-items:center; justify-content:space-between;
  background:#f8fbff;
  border:1px solid #e8f0ff;
  border-radius:8px;
  padding:8px 12px;
  margin:-4px 0 10px;
}
.ph-left{ display:flex; align-items:center; gap:10px; }
.ph-title{ font-size:15px; font-weight:700; color:#0f172a; }

/* å³ä¾§æŒ‰é’® */
.btn-ghost{
  height:26px; padding:0 10px; border:1px solid #d8e1ee; border-radius:14px;
  background:#fff; color:#334155; font-size:12px; cursor:pointer;
}
.btn-ghost:hover{ background:#eef3ff; border-color:#c7d4f4; }
.ph-right{ display:flex; align-items:center; gap:10px; }
.note-link{ display:inline-flex; align-items:center; gap:6px; color:#1e49e2; cursor:pointer; }
.note-link .icon{ width:14px; height:14px; }
.note-link u{ text-underline-offset:3px; }

/* æ ‡é¢˜å³ä¾§èƒ¶å›Šä¸‹æ‹‰ */
.pill-wrap{ position:relative; display:inline-block; }
.pill-select{
  appearance:none; -webkit-appearance:none; -moz-appearance:none;
  height:30px; line-height:30px;
  border-radius:20px; border:1px solid #cfd9e5;
  padding:0 30px 0 12px; font-size:13px; background:#fff; cursor:pointer;
}
.pill-wrap .chev{
  position:absolute; right:10px; top:50%; transform:translateY(-50%);
  width:16px; height:16px; pointer-events:none; color:#64748b;
}

/* KPI ç»Ÿä¸€ */
#pane-biz .kpi-row{
  display:grid; grid-template-columns:repeat(4,1fr);
  gap:10px; margin:8px 0 4px;
}
#pane-biz .kpi{
  background:#f8fafc; border:1px solid #eef2f7;
  border-radius:10px; padding:10px 12px;
}
#pane-biz .kpi .k{ font-size:12px; color:#64748b; margin-bottom:2px; }
#pane-biz .kpi .v{ font-weight:700; color:#0f172a; }

/* å›¾è¡¨é«˜åº¦ */
#pane-biz .chart-lg{ height:300px; }
#pane-biz .chart-md{ height:260px; }

/* ===== æ„æˆåŒºåŸŸæ ·å¼ï¼ˆä¸ä½ ç°æœ‰é£æ ¼ä¸€è‡´ï¼‰ ===== */
/* ä¸€ã€è¿˜åŸâ€œäº¤æ˜“æ€»é¢ / æµå…¥æ–¹ / æµå‡ºæ–¹â€è¿™è¡Œ mini Tab çš„æ ·å¼ */
/* ä¿è¯å®ƒä¸è¢«å…¨å±€ .tab è¦†ç›– */
/* ===== æ„æˆåŒºåŸŸæ ·å¼ï¼ˆä¸ä½ ç°æœ‰é£æ ¼ä¸€è‡´ï¼‰ ===== */
.tabs-mini{display:inline-flex;gap:6px;background:#f8fafc;border:1px solid #e6edf5;border-radius:20px;padding:3px;margin:6px 0 10px}
.tabs-mini .tab{padding:6px 12px;border-radius:14px;font-size:12px;cursor:pointer;color:#334155;user-select:none}
.tabs-mini .tab.active{background:#eef3ff;color:#2152ff;border:1px solid #d6e4ff}

.seven-cats{display:grid;grid-template-columns:repeat(7,1fr);gap:10px;margin:6px 0 2px}
.seven-cats .cat{background:#f8fafc;border:1px solid #e6edf5;border-radius:10px;padding:10px 8px;text-align:center}
.seven-cats .name{font-size:12px;color:#475569;margin-bottom:6px}
.seven-cats .pct{font-weight:700;color:#0f172a}

.grid-2{display:grid;grid-template-columns:1.2fr .95fr;gap:14px;margin-top:10px}
.chart-md{width:100%;height:320px;min-height:300px;background:#fff;border:1px solid #e6edf5;border-radius:10px;padding:8px}

/* â€”â€” Top20 åˆ—è¡¨å¡ â€”â€” */
/* ===== Top20ï¼šæ ‡é¢˜åœ¨ä¸Š + å³ä¾§æ€»é¢ï¼Œåˆ—è¡¨è‡ªé€‚åº”å‰©ä½™é«˜åº¦ï¼ˆæ— éœ€æ”¹JSï¼‰ ===== */
.top20-card{
  background:#fff;
  border:1px solid #e6edf5;
  border-radius:10px;
  padding:10px 12px;

  /* å…³é”®ï¼šæ”¹ä¸ºå¼¹æ€§å¸ƒå±€å¹¶å æ»¡å®¹å™¨é«˜åº¦ */
  display:flex;
  flex-direction:column;
  height:100%;
  overflow:hidden;   /* é˜²æ­¢é˜´å½±/å†…å®¹æº¢å‡º */
  min-height:0;     /* å…³é”®ï¼šå…è®¸åœ¨çˆ¶å®¹å™¨ä¸­è¢«å‹ç¼© */
}

/* å¤´éƒ¨ï¼šå·¦æ ‡é¢˜ + å³æ€»é¢ */
.top20-head{
  display:flex;
  align-items:baseline;
  justify-content:space-between;
  margin-bottom:8px;
  flex:0 0 auto;    /* å›ºå®šé«˜åº¦åŒºåŸŸ */
}
.top20-title{ font-size:14px; font-weight:800; color:#0f172a; }
.top20-total{ font-weight:800; color:#2152ff; font-variant-numeric:tabular-nums; }
.top20-sub{ font-size:12px; color:#64748b; margin-left:8px; }

/* åˆ—è¡¨åŒºåŸŸï¼šå æ»¡å‰©ä½™ç©ºé—´ + å¯æ»šåŠ¨ï¼ˆæ ¸å¿ƒæ”¹åŠ¨ï¼‰ */
.top20-list{
  flex:1 1 auto;    /* åƒæ‰å‰©ä½™é«˜åº¦ */
  min-height:0;     /* å…³é”®ï¼šä¸å†™è¿™å¥ä¼šæŠŠçˆ¶å®¹å™¨æ’‘ç ´å¯¼è‡´â€œæ¡†å¤–â€ */
  overflow:auto;
  padding-right:4px;
}

/* è¡Œï¼šæ’è¡Œ + åç§° + é‡‘é¢ */
.top20-row{
  display:grid;
  grid-template-columns:26px 1fr 120px;
  align-items:center;
  padding:6px 0;
  border-bottom:1px dashed #eef2f7;
}
.top20-row:last-child{ border-bottom:none; }

/* æ’åå¾½ç« ï¼šå‰ä¸‰ï¼ˆé‡‘/é“¶/é“œï¼‰ï¼Œå…¶ä½™è“æè¾¹ */
.rank-badge{
  width:22px; height:22px; border-radius:50%;
  display:flex; align-items:center; justify-content:center;
  font-size:12px; font-weight:700;
  color:#2152ff; background:#eef3ff; border:1px solid #d6e4ff;
}
.rank-badge.top1{ background:#fddc7a; color:#7a5900; border-color:#f4cc50; } /* é‡‘ */
.rank-badge.top2{ background:#e8edf5; color:#364152; border-color:#cfd8e3; } /* é“¶ */
.rank-badge.top3{ background:#f4e1cf; color:#6b3f23; border-color:#edc8a9; } /* é“œ */

.cp-name{
  color:#0f172a; font-size:13px;
  white-space:nowrap; overflow:hidden; text-overflow:ellipsis;
}
.cp-amt{
  text-align:right; color:#0f172a; font-weight:700;
  font-variant-numeric:tabular-nums;
}

/* æ»šåŠ¨æ¡ç¾åŒ– */
.top20-list::-webkit-scrollbar{ width:6px }
.top20-list::-webkit-scrollbar-thumb{ background:#e6edf5; border-radius:99px }
.top20-list::-webkit-scrollbar-thumb:hover{ background:#d5dfef }

/* â€”â€” è¡¨æ ¼ä¸Šæ–¹æç¤ºè¡Œ â€”â€” */
.table-announce{
  display:flex; align-items:center; justify-content:space-between;
  gap:12px; padding:6px 2px 8px; margin:8px 0 6px;
  font-size:13px; line-height:1.7; color:#334155;
  /* è·Ÿå¡ç‰‡/è¡¨æ ¼å¯¹é½ï¼šå®¹å™¨å®½åº¦ç”±çˆ¶çº§å†³å®š */
  width:100%; box-sizing:border-box;
}
.table-announce .left-msg{ flex:1 1 auto; min-width:0; }
.table-announce .right-msg{ flex:0 0 auto; white-space:nowrap; color:#64748b; }

/* æ–‡ä»¶åé«˜äº®ï¼ˆè“è‰²ï¼‰ */
.table-announce .file-link{
  color:#2152ff; text-decoration:underline; cursor:pointer;
}
.table-announce .file-link:hover{ text-decoration:none; }

/* å°å±æ—¶è‡ªåŠ¨æ¢è¡Œï¼Œå³ä¾§æç¤ºä¸‹ç§»é å³ */
@media (max-width: 1200px){
  .table-announce{ flex-direction:column; align-items:flex-start; }
  .table-announce .right-msg{ align-self:flex-end; }
}


/* å“åº”å¼ï¼šçª„å±æŠŠæ€»é¢å¡å †åˆ°ä¸Šé¢ */
@media (max-width: 1280px){
  .top20-panel{ grid-template-columns: 1fr }
  .top20-left{ height: 96px }
  .top20-list{ max-height: 212px }
}
    
/* è®© ECharts å®¹å™¨æ›´é«˜çº§ä¸€äº›ï¼ˆåœ†è§’+é˜´å½±ä¸é¢æ¿ç»Ÿä¸€ï¼‰ */
.chart-lg, .chart-md {
  border-radius: 10px;
  background: #fff;
  box-shadow: 0 2px 8px rgba(17,24,39,.04) inset;
}
/* tooltip å¡ç‰‡ */
.tip-card{
  padding:8px 10px;border:1px solid #e6edf5;border-radius:8px;background:#fff;
  box-shadow:0 6px 24px rgba(15,23,42,.08);font-size:12px;color:#0f172a
}
.tip-card .t{font-weight:700;margin-bottom:6px;color:#334155}
.tip-row{display:flex;justify-content:space-between;gap:16px;line-height:18px}
.tip-k{color:#64748b}
.tip-v{font-variant-numeric:tabular-nums}

/* çª„å±é€‚é… */
@media (max-width:1200px){
  .filter-area{
    justify-content:center;
    gap:10px 12px;
  }
  .filter-area select,
  .filter-area input{
    min-width:130px;
  }
}

/* å·¥å…·æ è¡Œï¼šå·¦å³åˆ†å¸ƒï¼Œè‡ªåŠ¨æ¢è¡Œ */
.table-toolbar{
  display:flex; align-items:center; justify-content:space-between;
  gap:12px; margin:10px 0 8px;
}

/* ä¸¤æ®µå¼åˆ‡æ¢ï¼ˆSegmented Controlï¼‰ */
.seg{
  display:inline-flex; gap:0; background:#f8fafc;
  border:1px solid #e6edf5; border-radius:22px; padding:3px;
}
.seg .opt{
  min-width:86px; padding:6px 14px; border:0; cursor:pointer;
  background:transparent; color:#334155; font-size:13px; border-radius:16px;
  transition:all .18s ease; outline:none;
}
.seg .opt:hover{ color:#1e40af; }
.seg .opt.active{
  background:#eef3ff; color:#2152ff; border:1px solid #d6e4ff;
}

/* å³ä¾§æŒ‰é’®ç»„ï¼ˆä¸ä½ ç°æœ‰é£æ ¼åè°ƒï¼‰ */
.btn-bar{ display:flex; gap:8px; flex-wrap:wrap; }
.btn{
  padding:6px 12px; border-radius:8px; font-size:13px; line-height:1;
  border:1px solid #e6edf5; background:#fff; color:#0f172a; cursor:pointer;
  transition:all .15s ease;
}
.btn:hover{ background:#f6f9ff; border-color:#d6e4ff; }
.btn.ghost{ color:#2152ff; border-color:#d6e4ff; background:#fff; }
.btn.ghost:hover{ background:#eef3ff; }
.btn.primary{ color:#fff; background:#2152ff; border-color:#2152ff; }
.btn.primary:hover{ filter:brightness(.96); }

/* æ”¶çª„å±å¤„ç†ï¼šæŒ‰é’®æ¢è¡Œï¼Œåˆ‡æ¢å§‹ç»ˆåœ¨æœ€å·¦ */
@media (max-width: 1200px){
  .table-toolbar{ flex-direction:column; align-items:stretch; }
  .btn-bar{ justify-content:flex-end; }
}



/* ===== Tab 6 ç‰¹å®šå·¥å•†æŸ¥è¯¢ ===== */



/* ä¸»ä½“åˆ†æ ï¼šå·¦ä¾§èœå• + å³ä¾§å†…å®¹ */
#pane-routine .split{
  position:relative;
  display:flex;
  gap:16px;
}

/* ä¾§æ ï¼Œå¸¦å³ä¾§è“è‰²ç«–çº¿å’Œå†…è´´å¼æŠ˜å æŒ‰é’® */
#pane-routine .sidebar-pane{
  position:relative;
  width:260px; min-width:260px;
  transition:width .2s ease;
  border-right:2px solid #1e40af;
  --sbar-toggle-offset: 84px;   /* â† æƒ³å†é«˜ä¸€ç‚¹å°±æŠŠ 84 æ”¹å¤§/å° */
}

#pane-routine main{
  flex:1 1 auto;
  min-width:0;
}

/* å†…è´´å¼æŠ˜å æŒ‰é’® */
.sbar-toggle-inset{
  position:absolute;
  top:var(--sbar-toggle-offset);
  right:0;
  transform:translateY(-50%);
  width:12px;
  height:36px;
  background:transparent;
  border:none;
  cursor:pointer;
  color:#64748b;
  line-height:36px;
  padding:0;
  z-index:2;
}
.sbar-toggle-inset::before{
  content:'â®';
  display:block;
  text-align:center;
  font-size:16px;
}
.sbar-toggle-inset:hover{ color:#1e40af; }

/* æŠ˜å æ€ï¼šåªä¿ç•™ 12px å¯¼è½¨å’ŒæŒ‰é’® */
#pane-routine .split.is-collapsed .sidebar-pane{
  width:12px;
  min-width:12px;
  overflow:hidden;
  border-right:2px solid #1e40af;
}
#pane-routine .split.is-collapsed .sidebar-pane > *{
  display:none;
}
#pane-routine .split.is-collapsed .sidebar-pane > .sbar-toggle-inset{
  display:block !important;
}
#pane-routine .split.is-collapsed .sbar-toggle-inset::before{
  content:'â¯';
}
#pane-routine .split.is-collapsed main{
  flex:1 1 100%;
  min-width:0;
}

/* ===== é€šç”¨ Routine ä¸»å¡ç‰‡ï¼šå·¦ ç”°å­—æ ¼ + å³æ•£ç‚¹å›¾ ===== */

/* å·¦å³ä¸¤åˆ—ï¼Œä¿æŒä¸€ä¾§ç”°å­—æ ¼ã€ä¸€ä¾§æ•£ç‚¹å›¾ï¼Œä¸å†ä¸­å°å±æ¢è¡Œ */
/* å·¦ 4 å¡ + å³ä¾§æ°”æ³¡å›¾ï¼šä¸¤åˆ—ç­‰å®½ï¼Œç¡®ä¿å¯¹é½ */
.routine-main {
  display: grid;
  grid-template-columns: repeat(2, minmax(0, 1fr)); /* â† ç­‰å®½ */
  gap: 18px;
  align-items: stretch;
}

/* å·¦ä¾§ KPI åŒºåŸŸæ ‡é¢˜ */
.routine-kpi-panel {
  display: flex;
  flex-direction: column;
  gap: 10px;
}

.routine-kpi-panel .kpi-panel-title,
.routine-scatter .scatter-title {
  font-size: 13px;
  font-weight: 600;
  color: #475569;
  margin-bottom: 8px;          /* ä¸¤è¾¹æ ‡é¢˜é—´è·ç»Ÿä¸€ */
}

/* ç”°å­—æ ¼ 2Ã—2 */
.routine-card .top-strip {
  display: grid;
  grid-template-columns: repeat(2, minmax(0, 1fr));
  gap: 12px;
}

/* å¡ç‰‡ + å³ä¾§å°ç®±çº¿å›¾ */
.kpi-box-card {
  display: grid;
  grid-template-columns: minmax(0, 1fr) 90px;
  align-items: center;
  padding: 10px 12px;
  border-radius: 10px;
  border: 1px solid rgba(15, 23, 42, 0.06);
  box-shadow: 0 2px 5px rgba(15, 23, 42, 0.04);
  background: #ffffff;
  column-gap: 8px;
}

/* å½©è‰²èƒŒæ™¯ */
.kpi-box-card.kpi-red    { background:#ef4444; color:#ffffff; }
.kpi-box-card.kpi-orange { background:#f59e0b; color:#ffffff; }
.kpi-box-card.kpi-blue   { background:#2563eb; color:#ffffff; }
.kpi-box-card.kpi-green  { background:#16a34a; color:#ffffff; }

.kpi-boxplot .boxplot-chart {
  width: 80px;
  height: 60px;
}

/* å³ä¾§æ°”æ³¡å›¾åŒºå®¹å™¨ï¼šä¸è¦è´Ÿå¤–è¾¹è·ï¼Œåªè®©å®ƒæ­£å¸¸å æ»¡ */
.routine-scatter{
  padding: 0;
  margin: 0;              /* â† åˆ æ‰ -20px */
  
  min-width: 0;           /* é˜²æ­¢è¢«å·¦å³åŒºåŸŸæŒ¤å‹å¯¼è‡´å†…éƒ¨ canvas è®¡ç®—é”™è¯¯ */
  overflow: visible;      /* ä¿é™©ï¼šå°±ç®—æ²¡å¼€ containLabel ä¹Ÿä¸è£åˆ‡è½´æ ‡ç­¾ */
}

/* å›¾è¡¨åŒºåŸŸå›ºå®šé«˜åº¦ï¼Œä¿è¯æœ‰ç©ºé—´ç”»è½´å’Œæ»‘å— */
.routine-scatter .chart{
  width: 100%;
  height: 360px;          /* ä½ éœ€è¦çš„é«˜åº¦ */
}

/* Routine4 ç­›é€‰æ¡ */
.filters-bar{
  display:flex; flex-wrap:wrap; align-items:center; gap:12px 16px;
  margin: 6px 0 12px 0;
}
.filters-bar .field{ display:flex; align-items:center; gap:8px; }
.filters-bar label{ color:#334155; font-size:13px; white-space:nowrap; }
.filters-bar .breaks input{
  width:88px; padding:6px 8px; border:1px solid #e5e7eb; border-radius:6px; font-size:13px;
}
.filters-bar .breaks .sep{ color:#94a3b8; }

.filters-bar .btn.primary{
  padding:6px 12px; border-radius:8px; border:1px solid #2066c9; background:#2066c9;
  color:#fff; font-size:13px; cursor:pointer;
}

/* å¤šé€‰ä¸‹æ‹‰ */
.multi{ position:relative; }
.multi-toggle{
  min-width:160px; padding:6px 10px; border:1px solid #e5e7eb; border-radius:8px;
  background:#fff; color:#334155; font-size:13px; display:flex; justify-content:space-between; align-items:center;
}
.multi .chev{ margin-left:8px; font-size:12px; color:#64748b; }
.multi-menu{
  position:absolute; top:36px; left:0; z-index:30; width:220px; max-height:240px; overflow:auto;
  background:#fff; border:1px solid #e5e7eb; border-radius:10px; box-shadow:0 10px 30px rgba(15,23,42,.08);
  padding:8px; display:none;
}
.multi-menu .row{ display:flex; align-items:center; gap:8px; padding:6px 4px; border-radius:6px; }
.multi-menu .row:hover{ background:#f8fafc; }
.multi-menu input[type="checkbox"]{ width:14px; height:14px; }
.multi-menu .search{
  display:flex; align-items:center; gap:6px; padding:4px 6px; border:1px solid #e5e7eb; border-radius:8px; margin:4px 4px 8px;
}
.multi-menu .search input{ flex:1; border:none; outline:none; font-size:13px; }
.multi.open .multi-menu{ display:block; }

/* é»˜è®¤éšè— */
#pane-routine #r4Filters { display: none !important; }

/* åœ¨ 2.1 / 2.2 / 2.4 æ˜¾ç¤º */
#pane-routine[data-routine="2.1"] #r4Filters,
#pane-routine[data-routine="2.2"] #r4Filters,
#pane-routine[data-routine="2.4"] #r4Filters {
  display: flex !important;
}

/* å¸ƒå±€ */
/* ===== Routine7 æ ·å¼ï¼ˆä½œç”¨äº #r7x ä½œç”¨åŸŸï¼‰ ===== */
#r7x .r7x-layout{
  display:grid; grid-template-columns: 380px 1fr; gap:16px; align-items:start;
}

#r7x .r7x-left{ display:flex; flex-direction:column; gap:12px; }

/* é¡¶éƒ¨ç­›é€‰æ¡ */
#r7x .r7x-filters{
  display:flex; align-items:center; flex-wrap:wrap; gap:10px;
  background:#fff; border:1px solid #e5e7eb; border-radius:10px; padding:10px 12px;
}
#r7x .r7x-filters .lbl{ color:#334155; font-size:13px; }
#r7x .r7x-filters .chk{ font-size:13px; color:#334155; margin-right:6px; }
#r7x .r7x-filters .sep{ width:1px; height:18px; background:#e5e7eb; margin:0 8px; display:inline-block; }

/* 2Ã—2 ç”°å­—æ ¼ KPI */
#r7x .r7x-kpi-grid{ display:grid; grid-template-columns: 1fr 1fr; gap:12px; }
#r7x .r7x-kpi{
  border-radius:10px; padding:12px 14px; color:#fff; box-shadow:0 6px 18px rgba(0,0,0,.06);
  min-height:110px; display:flex; flex-direction:column; justify-content:center;
}
#r7x .kpi-title{ font-weight:600; margin-bottom:4px; opacity:.95; }
#r7x .kpi-num{ font-size:28px; font-weight:800; line-height:1.1; margin:6px 0 8px; }
#r7x .kpi-sub{ font-size:13px; opacity:.95; }

#r7x .kpi-blue{ background:#2563eb; }
#r7x .kpi-green{ background:#16a34a; }
#r7x .kpi-orange{ background:#f59e0b; }
#r7x .kpi-red{ background:#ef4444; }

/* é”šç‚¹ä¿¡æ¯å æ»¡ä¸¤åˆ— */
#r7x .r7x-anchor{
  grid-column: 1 / span 2;
  padding:10px 12px; border:1px dashed #e5e7eb; border-radius:8px; background:#fff;
}
#r7x .anchor-xy{ font-family: ui-monospace,Menlo,monospace; color:#334155; }

/* åœ°å›¾ */
#r7x .r7x-map-wrap{ position:relative; min-height:520px; }
#r7x #r7xMap{ width:100%; height:520px; border-radius:10px; border:1px solid #e5e7eb; }
#r7x .r7x-legend{
  position:absolute; right:8px; bottom:8px; background:rgba(255,255,255,.92);
  border:1px solid #e5e7eb; border-radius:8px; padding:6px 8px; display:flex; gap:8px; font-size:12px; color:#334155;
}
#r7x .r7x-legend i{ display:inline-block; width:12px; height:12px; border-radius:3px; margin-right:4px; vertical-align:-2px; }

/* çª„å±è‡ªé€‚åº” */
@media (max-width: 1280px){
  #r7x .r7x-layout{ grid-template-columns: 320px 1fr; }
}
@media (max-width: 1024px){
  #r7x .r7x-layout{ grid-template-columns: 1fr; }
  #r7x #r7xMap{ height:420px; }
}


/* åº•ç¨¿å¯¼å‡ºä¿¡æ¯æ¡ */
  .wp-info-bar{background:#fff;border-bottom:1px solid #e6edf5;padding:12px 16px;display:flex;gap:16px 24px;align-items:center;flex-wrap:wrap}
  .wp-info-bar .kv{color:#64748b}
  .wp-info-bar .kv b{color:#0f172a}
  .wp-info-bar .edit{margin-left:6px;cursor:pointer;color:#1e49e2;border-radius:6px;padding:2px 6px}
  .wp-info-bar .edit:hover{background:#e9efff}

  /* å¡ç‰‡ä¸»ä½“ */
  .wp-card{position:relative}
  .op-flow{display:grid;grid-template-columns:repeat(3,1fr);gap:12px;margin-bottom:6px}
  .op-step{border:1px solid #e6edf5;border-radius:12px;background:#fff}
  .op-step .op-hd{display:flex;align-items:center;gap:8px;border-bottom:1px solid #eef3ff;padding:8px 12px}
  .op-step .idx{width:22px;height:22px;border-radius:999px;background:#1e49e2;color:#fff;display:inline-flex;align-items:center;justify-content:center;font-size:12px}
  .op-step .t{font-weight:600;color:#0f172a}
  .op-step .state{margin-left:auto;color:#64748b}
  .op-step .op-bd{padding:10px 12px}
  .op-flow.small .op-hd{padding:6px 10px;font-size:12px}
  .op-flow.small .op-bd{padding:8px 10px}
  .op-flow.small .idx{width:18px;height:18px;font-size:11px}
  .row{display:flex;gap:8px;align-items:center;margin-bottom:8px}
  .muted{color:#64748b}

  /* å·¥å…·æ  + è¡¨æ ¼ */
  .table-toolbar{display:flex;align-items:center;gap:12px;justify-content:space-between;margin:8px 0}
  .table-toolbar .tt-right{display:flex;gap:8px}
  .wp-table-wrap{overflow:auto}
  .table{width:100%;border-collapse:collapse}
  .table th,.table td{padding:10px 12px;border-bottom:1px solid #e6edf5;vertical-align:middle}
  .table thead th{background:#fafbff;font-weight:600;color:#334155}
  .num{text-align:right}
  .table .sample-edit{cursor:pointer;border-bottom:1px dashed transparent}
  .table .sample-edit:hover{border-bottom-color:#cbd5e1}
  select,input[type="text"],input[type="number"]{border:1px solid #e6edf5;border-radius:8px;padding:6px 8px;background:#fff;outline:none;font-size:13px}

  /* ä»…é®â€œä¿¡æ¯æµ‹è¯•â€å¡ç‰‡ */
  .card-mask{position:absolute;inset:0;background:rgba(255,255,255,.7);display:flex;align-items:center;justify-content:center;z-index:10}
  .card-mask .note{background:#fff;border:1px dashed #cbd5e1;border-radius:10px;padding:14px 18px;color:#334155}

  /* å¼¹çª— */
  .modal{position:fixed;inset:0;background:rgba(15,23,42,.45);display:none;align-items:center;justify-content:center;z-index:1000}
  .dialog{width:min(520px,92vw);background:#fff;border:1px solid #e6edf5;border-radius:12px;box-shadow:0 10px 30px rgba(2,6,23,.18)}
  .dialog .hd{display:flex;align-items:center;justify-content:space-between;padding:12px 16px;border-bottom:1px solid #e6edf5;font-weight:600}
  .dialog .bd{padding:16px}
  .dialog .ft{padding:12px 16px;border-top:1px solid #e6edf5;display:flex;justify-content:flex-end;gap:8px}
  .x{cursor:pointer;color:#94a3b8}
  .x:hover{color:#0f172a}

  .btn{padding:6px 10px;border:1px solid #e6edf5;border-radius:8px;background:#fff;cursor:pointer;font-size:13px}
  .btn.primary{background:#1e49e2;color:#fff;border-color:#1e49e2}
  .btn:disabled{opacity:.5;cursor:not-allowed}

  /* ä¿¡æ¯æµ‹è¯• Step çŠ¶æ€å¾½æ ‡ï¼ˆå·²å®Œæˆ=ç»¿ï¼Œå¯ç”¨=è“ï¼Œæœªå®Œæˆ/ä¸å¯ç”¨=ç°ï¼‰ */
.op-step .state{
  padding: 0 8px;
  line-height: 20px;
  font-size: 12px;
  border-radius: 999px;
  border: 1px solid transparent;
  display: inline-block;
}

/* ç»¿è‰²ï¼šå·²å®Œæˆ */
.op-step .state.st-green{
  color:#047857;
  background:rgba(16,185,129,.12);
  border-color:#10b981;
}

/* è“è‰²ï¼šå¯ç”¨ */
.op-step .state.st-blue{
  color:#1e40af;
  background:rgba(59,130,246,.12);
  border-color:#3b82f6;
}

/* ç°è‰²ï¼š / ä¸å¯ç”¨ */
.op-step .state.st-gray{
  color:#475569;
  background:rgba(148,163,184,.15);
  border-color:#cbd5e1;
}

/* çº¢è‰²ï¼šæœªå®Œæˆ */
.op-step .state.st-red{
  color:#dc2626;
  background:rgba(239,68,68,.12);
  border-color:#fca5a5;
}

/* è¡¨å¤´å°åœ†åœˆç¼–å· */
.th-pill{display:inline-flex;align-items:center;gap:6px;vertical-align:middle}
.th-pill .pill{
  width:18px;height:18px;border-radius:50%;
  display:inline-flex;align-items:center;justify-content:center;
  font-size:12px;font-weight:700;line-height:18px;
  background:#1e49e2;color:#fff;
}
.table thead th .pill{position:relative;top:-1px}

/* åªå½±å“è¡¨å¤´ï¼Œè®©æ•°å€¼åˆ—çš„è¡¨å¤´ä»ç„¶é å·¦æ˜¾ç¤ºå›¾æ ‡+æ–‡å­— */
.table thead th.num{ text-align:left; }
    

/* ===== Footer å®‰å…¨åŒº + æ»šåŠ¨ä¸è¢«é®æŒ¡ ===== */
:root{ --footer-h: 56px; }               /* å…œåº•é«˜åº¦ï¼ŒJS ä¼šåŠ¨æ€è¦†ç›– */

.tab-scroll{ padding-bottom: calc(var(--footer-h) + 16px) !important; }
/* è‹¥å·¥ä½œåº•ç¨¿é¡µè¿˜æœ‰å†…éƒ¨å¯æ»šåŒºåŸŸï¼Œä¹ŸåŒæ ·é¢„ç•™ */
#pane-workingpaper .wp-table-wrap{ padding-bottom: var(--footer-h); }

/* è‹¥ä½ çš„ç‰ˆæƒæ¡æœ‰å›ºå®šç±»åï¼Œæ‹©ä¸€å¯ç”¨ï¼ˆä»»é€‰å…¶ä¸€æˆ–éƒ½åŠ ï¼‰ */
.copyright-bar,
.footer-bar,
.app-footer,
[data-role="copyright"]{
  position: fixed; left:0; right:0; bottom:0;
  z-index: 50;
  /* è®©é¼ æ ‡æ»šè½®èƒ½ç©¿é€ï¼Œä¸å½±å“é¡µé¢æ»šåŠ¨ï¼›è‹¥éœ€è¦ç‚¹å‡»é“¾æ¥ï¼Œè§ä¸‹ä¸€æ®µ */
  pointer-events: none;
}

/* å¦‚æœç‰ˆæƒæ¡é‡Œæœ‰é“¾æ¥/æŒ‰é’®éœ€è¦å¯ç‚¹ï¼ŒæŠŠå®ƒä»¬é‡æ–°æ‰“å¼€äº‹ä»¶ */
.copyright-bar a, .copyright-bar button,
.footer-bar a,   .footer-bar button,
.app-footer a,   .app-footer button,
[data-role="copyright"] a,
[data-role="copyright"] button{
  pointer-events: auto;
}


/* å›ºå®šåº•éƒ¨ footerï¼ˆç‹¬ç«‹ï¼Œä¸ä¾èµ–é¢å¤–å®¹å™¨ï¼‰ */
#app-footer{
  position: fixed;      /* å¦‚æœä¸æƒ³å›ºå®šï¼Œæ”¹æˆ position: static; å¹¶å»æ‰ body çš„ padding-bottom */
  left: 0;
  right: 0;
  bottom: 0;
  background:#fff;
  border-top:1px solid #eaecef;
  padding: 6px 12px;
  font-size:12px;
  line-height:1.4;
  z-index:1000;                 /* é˜²æ­¢è¢«è¡¨æ ¼/åˆ†é¡µæµ®å±‚ç›–ä½ */
  box-shadow:0 -2px 8px rgba(0,0,0,.04);
  padding-bottom: calc(6px + env(safe-area-inset-bottom, 0));
}
#app-footer p{ margin:0; user-select:text; }

/* ç»™é¡µé¢å†…å®¹ç•™å‡ºå’Œ footer åŒé«˜çš„ç©ºé—´ï¼Œé¿å…è¢«æŒ¡ä½ */
body{ padding-bottom: 60px; }   /* ä¸ footer å®é™…é«˜åº¦ä¿æŒä¸€è‡´ï¼Œå¯æŒ‰éœ€å¾®è°ƒ */


  </style>
</head>

<body>
  <!-- ====== å¹³å° Header ====== -->
  <header class="layout-header">
    <div _ngcontent-ng-c2218024402="" class="header-menu-control" style="position: relative;"><svg _ngcontent-ng-c2218024402="" viewBox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" style="width: var(--responsive-size-16); height: var(--responsive-size-16);"><path _ngcontent-ng-c2218024402="" fill-rule="evenodd" clip-rule="evenodd" d="M1.40003 2.79995C1.40003 2.46858 1.66866 2.19995 2.00003 2.19995L14.8 2.19995C15.1314 2.19995 15.4 2.46858 15.4 2.79995C15.4 3.13132 15.1314 3.39995 14.8 3.39995L2.00003 3.39995C1.66866 3.39995 1.40003 3.13132 1.40003 2.79995ZM15.0909 5.47515C15.2816 5.58088 15.4 5.7818 15.4 5.9999L15.4003 9.9999C15.4004 10.218 15.282 10.419 15.0912 10.5247C14.9005 10.6305 14.6673 10.6244 14.4824 10.5088L11.2821 8.50876C11.1066 8.39913 11 8.20684 11 7.99996C11 7.79309 11.1066 7.6008 11.282 7.49115L14.482 5.49115C14.667 5.37556 14.9001 5.36943 15.0909 5.47515ZM12.7321 7.99993L14.2003 8.91741L14.2001 7.08245L12.7321 7.99993ZM1.40003 6.26662C1.40003 5.93524 1.66865 5.66662 2.00002 5.66662L8.40003 5.66662C8.7314 5.66662 9.00003 5.93525 9.00003 6.26662C9.00003 6.59799 8.7314 6.86662 8.40003 6.86662L2.00002 6.86662C1.66865 6.86662 1.40002 6.59799 1.40003 6.26662ZM1.40002 9.73328C1.40002 9.40191 1.66865 9.13328 2.00002 9.13328H8.40003C8.7314 9.13328 9.00003 9.40191 9.00003 9.73328C9.00003 10.0647 8.7314 10.3333 8.40003 10.3333H2.00002C1.66865 10.3333 1.40002 10.0647 1.40002 9.73328ZM1.40002 13.1999C1.40002 12.8686 1.66865 12.5999 2.00002 12.5999L14.8 12.6C15.1314 12.6 15.4 12.8686 15.4 13.2C15.4 13.5313 15.1314 13.8 14.8 13.8L2.00002 13.7999C1.66865 13.7999 1.40002 13.5313 1.40002 13.1999Z" fill="white"></path></svg><!----><!----></div>
    <div _ngcontent-ng-c2218024402="" class="layout-header-name">KPMG Audit Compass <span _ngcontent-ng-c2218024402="" class="layout-header-project ng-star-inserted">Test2 20251022</span><!----></div>
    <nav class="layout-header-nav">

      <!-- å•ä½åˆ‡æ¢ -->
      <div class="header-dropdown">
        <button class="nav-btn header-btn">
          åƒå…ƒ/K â–¾
        </button>
        <ul class="dropdown-menu">
          <li data-value="yuan">å…ƒ</li>
          <li data-value="k">åƒå…ƒ/K</li>
          <li data-value="w">ä¸‡å…ƒ/W</li>
          <li data-value="m">ç™¾ä¸‡/M</li>
          <li data-value="b">äº¿å…ƒ/B</li>
        </ul>
      </div>

      <!-- å°æ•°ä½åˆ‡æ¢ -->
      <div class="header-dropdown">
        <button class="nav-btn header-btn">
          0 â–¾
        </button>
        <ul class="dropdown-menu">
          <li data-value="0">0</li>
          <li data-value="1">0.0</li>
          <li data-value="2">0.00</li>
          <li data-value="3">0.000</li>
          <li data-value="4">0.0000</li>
        </ul>
      </div>

      <!-- ä¸­ / EN è¯­è¨€åˆ‡æ¢ï¼šä¸€ä¸ªæ¡†é‡Œä¸¤ä¸ªæŒ‰é’® -->
      <!-- è¯­è¨€åˆ‡æ¢ -->
      <div class="lang-switch">
        <button class="nav-btn lang-btn lang-active" data-lang="zh">ä¸­</button>
        <button class="nav-btn lang-btn" data-lang="en">EN</button>
      </div>

      <!-- ç”¨æˆ·ï¼šå›¾æ ‡ + åå­— -->
      <button class="nav-btn nav-btn-with-icon">
        <span class="icon">
          <!-- ç”¨æˆ·å›¾æ ‡ -->
          <svg viewBox="0 0 16 16" aria-hidden="true">
            <path d="M8 1.5a3 3 0 0 0-3 3v1a3 3 0 1 0 6 0v-1a3 3 0 0 0-3-3Zm0 8A4.5 4.5 0 0 0 3.5 14v.75c0 .414.336.75.75.75h7.5a.75.75 0 0 0 .75-.75V14A4.5 4.5 0 0 0 8 9.5Z"/>
          </svg>
        </span>
        <span>Hu, Eric H.Y. (SH/AQPP)</span>
      </button>

      <!-- æ‰“å°æŒ‰é’® -->
      <button class="nav-btn nav-icon-btn" title="æ‰“å°">
        <span class="icon">
          <svg viewBox="0 0 16 16" aria-hidden="true">
            <path d="M4 2.5A1.5 1.5 0 0 1 5.5 1h5A1.5 1.5 0 0 1 12 2.5V4H4V2.5ZM4 5.5h8v2h1a1 1 0 0 1 1 1v4.25a.75.75 0 0 1-.75.75H12v-3H4v3H2.75A.75.75 0 0 1 2 12.75V8.5a1 1 0 0 1 1-1h1v-2Zm1 5h6v3H5v-3Zm7-6.5h1a1 1 0 1 1 0 2h-1v-2Z"/>
          </svg>
        </span>
      </button>

      <!-- å‘é€åé¦ˆæŒ‰é’® -->
      <button class="nav-btn nav-icon-btn" title="å‘é€åé¦ˆ">
        <span class="icon">
          <svg viewBox="0 0 16 16" aria-hidden="true">
            <path d="M2.5 2A1.5 1.5 0 0 0 1 3.5v5A1.5 1.5 0 0 0 2.5 10H4v3.25a.75.75 0 0 0 1.28.53L8.06 10h5.44A1.5 1.5 0 0 0 15 8.5v-5A1.5 1.5 0 0 0 13.5 2h-11Z"/>
          </svg>
        </span>
      </button>

      <!-- è®¾ç½®æŒ‰é’® -->
      <button class="nav-btn nav-icon-btn" title="è®¾ç½®">
        <span class="icon">
          <svg viewBox="0 0 16 16" aria-hidden="true">
            <path d="M8.93 1.5a.75.75 0 0 0-1.86 0l-.26.78a4.5 4.5 0 0 0-1.23.71l-.8-.31a.75.75 0 0 0-.95.95l.31.8a4.5 4.5 0 0 0-.71 1.23l-.78.26a.75.75 0 0 0 0 1.86l.78.26c.16.45.4.87.71 1.23l-.31.8a.75.75 0 0 0 .95.95l.8-.31c.36.31.78.55 1.23.71l.26.78a.75.75 0 0 0 1.86 0l.26-.78a4.5 4.5 0 0 0 1.23-.71l.8.31a.75.75 0 0 0 .95-.95l-.31-.8c.31-.36.55-.78.71-1.23l.78-.26a.75.75 0 0 0 0-1.86l-.78-.26a4.5 4.5 0 0 0-.71-1.23l.31-.8a.75.75 0 0 0-.95-.95l-.8.31a4.5 4.5 0 0 0-1.23-.71L8.93 1.5ZM8 6a2 2 0 1 1 0 4 2 2 0 0 1 0-4Z"/>
          </svg>
        </span>
      </button>

    </nav>
  </header>

  <!-- ====== ä¸»ä½“åŒºåŸŸï¼šå·¦ä¾§å¹³å°ä¾§æ  + å³ä¾§å†…å®¹æ»šåŠ¨å®¹å™¨ ====== -->
<div class="layout-main">
  <!-- å·¦ä¾§ -->
  <aside class="sidebar">
    <ul class="sidebar-menu">
      <!-- é¡¶å±‚ï¼šé¡¹ç›®åˆ—è¡¨ -->
      <li>
        <i class="fa-solid fa-bars ico"></i>
        <span class="sb-txt">é¡¹ç›®åˆ—è¡¨</span>
      </li>
  
      <!-- é¡¶å±‚ï¼šå·¥ä½œç°¿è¯¦æƒ…ï¼ˆä¸‹æ‹‰ï¼‰ -->
      <li class="sb-toggle">
        <div class="sb-toggle-head" onclick="toggleSb(this.parentElement)">
          <i class="fa-solid fa-folder ico"></i>
          <span class="sb-txt">å·¥ä½œç°¿è¯¦æƒ…</span>
          <i class="fa-solid fa-angle-right caret"></i>
        </div>
  
        <!-- äºŒçº§èœå•ï¼šåªæœ‰â€œé“¶è¡Œæµæ°´åˆ†æâ€æœ‰ç»¿è‰²åœ†åœˆ -->
        <ul class="sb-submenu">
          <li class="sb-row active">
            <i class="fa-regular fa-circle-check ico"></i>
            <span class="sb-txt">æ•°æ®ä¸Šä¼ </span>
          </li>
          <li class="sb-row active">
            <i class="fa-regular fa-circle-check ico"></i>
            <span class="sb-txt">é“¶è¡Œæµæ°´åˆ†æ</span>
          </li>
          <li class="sb-row disabled"><span class="sb-txt">å¢å€¼ç¨æ•°æ®åˆ†æ</span></li>
          <li class="sb-row disabled"><span class="sb-txt">è´¢åŠ¡æ•°æ®åˆ†æ</span></li>
          <li class="sb-row disabled"><span class="sb-txt">æ•°æ®ç»¼åˆåˆ†æ</span></li>
        </ul>
      </li>
    </ul>
  </aside>

  
  <!-- å³ä¾§ï¼ˆå¿…é¡»ä¸ aside åŒçº§ï¼Œä¸”å…±åŒåŒ…åœ¨ layout-main å†…ï¼‰ -->
  <section class="main-right">
    <div class="breadcrumb-bar">
      <a href="" class="back-link">â† è¿”å›é¡¹ç›®åˆ—è¡¨</a >
      <span class="sep">/</span>
      <span class="crumb">Test2</span>
      <span class="sep">/</span>
      <span class="crumb">20251022</span>
      <span class="sep">/</span>
      <b class="crumb">é“¶è¡Œæµæ°´åˆ†æ</b>
    </div>
    
    <!-- 2) KPI + æ•°æ®é—®é¢˜åˆ†æï¼ˆæ•´å—ï¼‰ -->
    <div class="kpi-and-issue">
      <!-- å·¦ä¾§ KPI æ€»å®¹å™¨ï¼šå·¦1åˆ—(å‰ä¸‰ä¸ªçºµæ’) + å³2åˆ—(åå››ä¸ª2Ã—2) -->
      <div class="kpi-grid">
        <div class="kpi k1">
          <div class="kpi-label">è¢«å®¡è®¡å•ä½</div>
          <div class="kpi-value">1 å®¶</div>
        </div>
        <div class="kpi k2">
          <div class="kpi-label">å¯¹æ‰‹æ–¹</div>
          <div class="kpi-value">29 å®¶</div>
        </div>
        <div class="kpi k3">
          <div class="kpi-label">è´¦å·</div>
          <div class="kpi-value">17 ä¸ª</div>
        </div>
    
        <div class="kpi k4">
          <div class="kpi-label">äº¤æ˜“æ€»é¢</div>
          <div class="kpi-value">562.2 K</div>
        </div>
        <div class="kpi k5">
          <div class="kpi-label">æµæ°´æ€»æ•°</div>
          <div class="kpi-value">145 æ¡</div>
        </div>
        <div class="kpi k6">
          <div class="kpi-label">æµå…¥æ€»é¢</div>
          <div class="kpi-value pos"><a class="link-num" href="javascript:;">270.2 K</a ></div>
        </div>
        <div class="kpi k7">
          <div class="kpi-label">æµå‡ºé‡‘é¢</div>
          <div class="kpi-value neg"><a class="link-num danger" href="javascript:;">292.0 K</a ></div>
        </div>
      </div>
    
      <!-- å³ä¾§ï¼šæ•°æ®é—®é¢˜åˆ†æ -->
      <!-- æ•°æ®é—®é¢˜åˆ†æå¡ -->
      <aside class="issue-card">
        <!-- æ»šåŠ¨å†…å®¹åŒº -->
        <div class="issue-body-simple">
          <p class="issue-note">
            <b>ä»…ä¾›é¢„è§ˆåˆ†æï¼š</b>
            å½“å‰æ•°æ®å­˜åœ¨æœªè®¤é¢† / é“¶è¡Œè´¦å·ä¸»æ¡£ä¸å®Œæ•´çš„é—®é¢˜ï¼Œä»…ä¾›é¡¹ç›®ç»„è¿›è¡Œé£é™©è¯„ä¼°ï¼Œå®è´¨æ€§å®¡è®¡ç¨‹åºä¸å¯ä¾èµ–ã€‚
          </p >
      
          <p class="issue-inline">
            <span class="dot-danger"></span>
            <span>å­˜åœ¨æœªè®¤é¢†çš„åŸå§‹æµæ°´æ–‡ä»¶ï¼Œè¯·åŠæ—¶è®¤é¢†ã€‚</span>
            <a class="issue-inline-link" href="#è®¤é¢†é¡µé¢">ç‚¹å‡»è·³è½¬ Â»</a >
          </p >
      
          <!-- å¯è¿½åŠ æ›´å¤šé—®é¢˜ -->
          <p class="issue-inline">
            <span class="dot-danger"></span>
            <span>é“¶è¡Œæµæ°´ä¸­ï¼Œå­˜åœ¨æœªåœ¨é“¶è¡Œè´¦å·ä¸»æ¡£ç»´æŠ¤çš„è´¦å·ï¼Œè¯·è¡¥å……é“¶è¡Œè´¦å·ä¸»æ¡£</span>
            <a class="issue-inline-link" href="#è¯¦æƒ…">ç‚¹å‡»è·³è½¬ Â»</a >
          </p >

          <p class="issue-inline">
            <span class="dot-danger"></span>
            <span>å­˜åœ¨æ±‡ç‡æœªè½¬æ¢çš„æµæ°´ï¼Œè¯·åŠæ—¶è¡¥å……æ±‡ç‡ä¸»æ¡£</span>
            <a class="issue-inline-link" href="#è¯¦æƒ…">ç‚¹å‡»è·³è½¬ Â»</a >
          </p >

          <p class="issue-inline">
            <span class="dot-danger"></span>
            <span>å­˜åœ¨å½“æ—¥ä¸è¿ç»­çš„æµæ°´æ–‡ä»¶ï¼Œå¯åœ¨æœˆåº¦åˆ†å¸ƒå¤„æ‰‹å·¥æ‰“æ ‡é¦–å°¾ç¬”é‡æ–°éªŒè¯ï¼Œè¯·åŠæ—¶å¤„ç†å¹¶ç¡®è®¤æ— è¯¯</span>
            <a class="issue-inline-link" href="#è¯¦æƒ…">ç‚¹å‡»è·³è½¬ Â»</a >
          </p >
        </div>
      
        <!-- å›ºå®šåº•æ ï¼šå±•å¼€è¯¦æƒ… -->
        <a class="issue-toggle" href="javascript:void(0)">å±•å¼€è¯¦æƒ…</a >
      </aside>
    
    <!-- 3) Tabsï¼ˆç´§è´´åœ¨KPI/é—®é¢˜å¡ä¸‹é¢ï¼‰ -->
    <div class="tab-container">
      <div class="tabbar" id="topTabs">
        <div class="tab active" data-top="account">è´¦æˆ·æ€»è§ˆ</div>
        <div class="tab" data-top="biz">ç»è¥å®è´¨</div>
        <div class="tab" data-top="relation">å·²çŸ¥å…³è”æ–¹äº¤æ˜“</div>
        <div class="tab" data-top="personalâ€”transaction">ä¸ªäººäº¤æ˜“</div>
        <div class="tab" data-top="transaction">ç‰¹å®šäº¤æ˜“æŸ¥è¯¢</div>
        <div class="tab" data-top="routine">ç‰¹å®šå·¥å•†æŸ¥è¯¢</div>
        <div class="tab" data-top="statement">æµæ°´æŸ¥è¯¢</div>
        <div class="tab" data-top="verify">æ€»è´¦æ ¸å¯¹</div>
        <div class="tab" data-top="workingpaper">èµ„é‡‘æµæ°´æ ¸æŸ¥åº•ç¨¿å¯¼å‡º</div>
        <i class="inkbar" id="inkbar"></i>
      </div>
    
      <!-- âœ… è¯´æ˜æ¡æ”¾åœ¨åŒä¸€ä¸ªæ¡†å†… -->
      
      <div class="biz-filter-bar hide" id="bizFilterBar">
          <div class="filter-card">
            <div class="filter-area">

              <label>è¢«å®¡è®¡å•ä½å…¬å¸ï¼š</label>
              <span class="select-wrap">
                <select class="select" id="fCompany"></select>
                <i class="chev"><svg viewBox="0 0 24 24"><path d="M6 9l6 6 6-6" fill="none" stroke="currentColor" stroke-width="2"></path></svg></i>
              </span>
              <label class="negate"><input type="checkbox" id="negCompany">ä¸åŒ…å«</label>

              <label>é“¶è¡Œè´¦æˆ·ï¼š</label>
              <span class="select-wrap">
                <select class="select" id="fBank"></select>
                <i class="chev"><svg viewBox="0 0 24 24"><path d="M6 9l6 6 6-6" fill="none" stroke="currentColor" stroke-width="2"></path></svg></i>
              </span>
              <label class="negate"><input type="checkbox" id="negBank">ä¸åŒ…å«</label>

              <label>å…¬å¸èŒèƒ½ï¼š</label>
              <span class="select-wrap">
                <select class="select" id="fFunc"></select>
                <i class="chev"><svg viewBox="0 0 24 24"><path d="M6 9l6 6 6-6" fill="none" stroke="currentColor" stroke-width="2"></path></svg></i>
              </span>
              <label class="negate"><input type="checkbox" id="negFunc">ä¸åŒ…å«</label>

              <label>åˆ†ææ—¶é—´ï¼š</label>
              <input type="date" id="beginDate">
              <span class="range-sep">è‡³</span>
              <input type="date" id="endDate">

              <label>å¯¹æ‰‹æ–¹ç±»å‹ï¼š</label>
              <span class="select-wrap">
                <select class="select" id="fType">
                  <option value="all">å…¨éƒ¨</option>
                  <option>å®¢æˆ·</option>
                  <option>ä¾›åº”å•†</option>
                  <option>å‘˜å·¥</option>
                </select>
                <i class="chev"><svg viewBox="0 0 24 24"><path d="M6 9l6 6 6-6" fill="none" stroke="currentColor" stroke-width="2"></path></svg></i>
              </span>

              <button class="query" id="btnQueryBiz">æŸ¥è¯¢</button>
              <button class="reset" id="btnResetBiz">é‡ç½®</button>

            </div>
          </div>
        </div>
        <div class="tab-intro" id="tabIntro"></div>
     </div>

     
     
      <!-- ===================== è´¦æˆ·æ€»è§ˆé¡µ ===================== -->
      <section class="tab-pane active" id="pane-account">
        <div class="tab-scroll">
      
          <!-- ========== èµ„é‡‘æ€»è§ˆ ========== -->
          <div class="card">
            <div class="head">
              <div class="title">èµ„é‡‘æ€»è§ˆ</div>
      
              <!-- ç´§è·Ÿæ ‡é¢˜ï¼šä¸šåŠ¡é€»è¾‘ / æ“ä½œæç¤º -->
              <div class="head-inline" style="margin-left:8px;display:flex;gap:8px;">
                <button class="btn" id="btnAccountLogic">ä¸šåŠ¡é€»è¾‘</button>
                <button class="btn" id="btnAccountTips">æ“ä½œæç¤º</button>
              </div>
      
              <!-- å³ä¾§ï¼šè‡ªå®šä¹‰è¡¨å¤´ / ç”Ÿæˆåˆ†æç»“æœ -->
              <div style="margin-left:auto;display:flex;gap:8px;align-items:center;">
                <button class="btn" id="btnCustomizeCols">è‡ªå®šä¹‰è¡¨å¤´</button>
                <button class="btn primary" id="btnAnalyze">ç”Ÿæˆåˆ†æç»“æœ</button>
              </div>
            </div>
      
            <div class="content">
      
              <!-- çŠ¶æ€å›¾ä¾‹ï¼ˆé å³ï¼‰ -->
              <div class="small" style="display:flex;gap:16px;justify-content:flex-end;margin-bottom:8px;">
                <span><i style="width:10px;height:10px;border-radius:50%;background:#facc15;display:inline-block;"></i> å½“æ—¥ä½™é¢ä¸è¿ç»­</span>
                <span><i style="width:10px;height:10px;border-radius:50%;background:#cbd5e1;display:inline-block;"></i> æ— æµæ°´æ•°æ®</span>
                <span><i style="width:10px;height:10px;border-radius:50%;background:#3b82f6;display:inline-block;"></i> æ£€éªŒæ— è¯¯</span>
                <span><i style="width:10px;height:10px;border-radius:50%;background:#ef4444;display:inline-block;"></i> ä½™é¢é”™è¯¯</span>
              </div>
      
              <!-- æ€»è§ˆè¡¨ -->
              <div style="overflow:auto">
                <div id="checkScope" class="check-scope">
                  <table class="table" id="tblAccountSummary">
                    <thead>
                      <tr>
                        <th class="sortable">è¢«å®¡è®¡å•ä½å…¬å¸</th>
                        <th class="sortable">æœ¬æ–¹è´¦å·</th>
                        <th class="sortable">é“¶è¡Œåç§°</th>
                        <th class="sortable">æµå…¥æ€»é¢</th>
                        <th class="sortable">æµå‡ºæ€»é¢</th>
                        <th class="sortable">äº¤æ˜“æ€»é¢</th>
                        <th class="sortable">äº¤æ˜“æ€»é¢å æ¯”</th>
                        <th class="sortable">äº¤æ˜“ç¬”æ•°</th>
                        <th class="sortable">å¯¹æ‰‹æ–¹æ•°é‡</th>
                        <th>æµæ°´æ–‡ä»¶</th>
                        <th>æ“ä½œ</th>
                    
                        <th class="check-col">
                          <div class="check-head">
                            <button class="arrow-btn" id="btnToggleCheck" title="å±•å¼€/æ”¶èµ·2023å¹´">
                              <svg viewBox="0 0 16 16" aria-hidden="true">
                                <path d="M6.2 3.5l5 4.5-5 4.5V3.5z"></path>
                              </svg>
                            </button>
                            <span>æ ¡éªŒæƒ…å†µï¼š</span>
                            <div class="y-labels">
                              <span class="y y-2023">2023</span>
                              <span class="sep-label">ï½œ</span>
                              <span class="y y-2024">2024</span>
                            </div>
                          </div>
                        </th>
                      </tr>
                    </thead>
                    <tbody>
                      <!-- åˆè®¡è¡Œ -->
                      <tr class="sum-row">
                        <td><strong>åˆè®¡</strong></td><td></td><td></td>
                        <td style="color:#2563eb"><strong>846,223,016</strong></td><td style="color:#ef4444"><strong>693,427,537</strong></td><td><strong>1,539,650,553</strong></td>
                        <td><strong>100.00%</strong></td><td><strong>2,442</strong></td><td><strong>401</strong></td><td></td><td></td>
                        <td class="check-col">
                          <div class="months-grid">
                            <span class="month-num col-2023">1</span><span class="month-num col-2023">2</span>
                            <span class="month-num col-2023">3</span><span class="month-num col-2023">4</span>
                            <span class="month-num col-2023">5</span><span class="month-num col-2023">6</span>
                            <span class="month-num col-2023">7</span><span class="month-num col-2023">8</span>
                            <span class="month-num col-2023">9</span><span class="month-num col-2023">10</span>
                            <span class="month-num col-2023">11</span><span class="month-num col-2023">12</span>
                            <span class="col-sep"></span>
                            <span class="month-num">1</span><span class="month-num">2</span>
                            <span class="month-num">3</span><span class="month-num">4</span>
                            <span class="month-num">5</span><span class="month-num">6</span>
                            <span class="month-num">7</span><span class="month-num">8</span>
                            <span class="month-num">9</span><span class="month-num">10</span>
                            <span class="month-num">11</span><span class="month-num">12</span>
                          </div>
                        </td>
                      </tr>
              
                      <!-- æ•°æ®è¡Œï¼ˆä»…ä¸€è¡Œåœ†ç‚¹ï¼‰ -->
                      <tr>
                        <td>abcæœ‰é™å…¬å¸</td>
                        <td>574***0001</td>
                        <td>æ‹›å•†é“¶è¡Œ</td>
                        <td style="color:#2563eb">846,223,016</td>
                        <td style="color:#ef4444">693,427,537</td>
                        <td><b>1,539,650,553</b></td>
                        <td>100.00%</td>
                        <td>2,442</td>
                        <td>401</td>
                        <td>1</td>
                        <td class="actions">
                        <a href=" " title="è´¦å·è¯¦æƒ…"><i class="fa-solid fa-eye"></i></a>
                        <a href="#" title="æ–‡ä»¶è¯¦æƒ…"><i class="fa-regular fa-file-lines"></i></a>
                        </td>
                        <td class="check-col">
                          <div class="months-grid check-row">
                            <i class="chk-dot chk-ok col-2023" title="2023-01"></i>
                            <i class="chk-dot chk-ok col-2023" title="2023-02"></i>
                            <i class="chk-dot chk-err col-2023" title="2023-03"></i>
                            <i class="chk-dot chk-ok col-2023" title="2023-04"></i>
                            <i class="chk-dot chk-ok col-2023" title="2023-05"></i>
                            <i class="chk-dot chk-ok col-2023" title="2023-06"></i>
                            <i class="chk-dot chk-warn col-2023" title="2023-07"></i>
                            <i class="chk-dot chk-ok col-2023" title="2023-08"></i>
                            <i class="chk-dot chk-ok col-2023" title="2023-09"></i>
                            <i class="chk-dot chk-ok col-2023" title="2023-10"></i>
                            <i class="chk-dot chk-err col-2023" title="2023-11"></i>
                            <i class="chk-dot chk-ok col-2023" title="2023-12"></i>
                            <span class="col-sep"></span>
                            <i class="chk-dot chk-ok" title="2024-01"></i>
                            <i class="chk-dot chk-ok" title="2024-02"></i>
                            <i class="chk-dot chk-ok" title="2024-03"></i>
                            <i class="chk-dot chk-warn" title="2024-04"></i>
                            <i class="chk-dot chk-ok" title="2024-05"></i>
                            <i class="chk-dot chk-ok" title="2024-06"></i>
                            <i class="chk-dot chk-none" title="2024-07"></i>
                            <i class="chk-dot chk-ok" title="2024-08"></i>
                            <i class="chk-dot chk-ok" title="2024-09"></i>
                            <i class="chk-dot chk-ok" title="2024-10"></i>
                            <i class="chk-dot chk-err" title="2024-11"></i>
                            <i class="chk-dot chk-ok" title="2024-12"></i>
                          </div>
                        </td>
                      </tr>
                    </tbody>
                  </table>
                </div>
              </div>
      
              <div id="pagination-account" class="pagination"></div>
            </div>
          </div>
      
          <!-- ========== ç¼ºå¤±åŒåè´¦æˆ·ï¼ˆä¸å˜ï¼Œä»…æé†’ï¼šå­—æ®µå·²æŒ‰ä½ è¦æ±‚æ›´æ–°ï¼‰ ========== -->
          <div class="card">
            <div class="head">
              <div class="title">ç¼ºå¤±åŒåè´¦æˆ·</div>
      
              <div class="head-inline" style="margin-left:8px;display:flex;gap:8px;">
                <button class="btn" id="btnAccountLogic">ä¸šåŠ¡é€»è¾‘</button>
                <button class="btn" id="btnAccountTips">æ“ä½œæç¤º</button>
              </div>
      
              <div style="margin-left:auto;display:flex;gap:8px;align-items:center;">
                <button class="btn primary" id="btnAnalyze">ç”Ÿæˆåˆ†æç»“æœ</button>
                <button class="btn primary" id="btnFlow">ç”Ÿæˆæµæ°´</button>
              </div>
            </div>
      
            <div class="content">
              <div style="display:grid;grid-template-columns:repeat(4,1fr);gap:10px;margin-bottom:10px;">
                <div class="top-item"><div class="lbl small">äº¤æ˜“æ€»é¢</div><div class="num">0.00</div></div>
                <div class="top-item"><div class="lbl small">æµå…¥æœ¬æ–¹æ€»é¢</div><div class="num" style="color:#2563eb">0.00</div></div>
                <div class="top-item"><div class="lbl small">æœ¬æ–¹æµå‡ºæ€»é¢</div><div class="num" style="color:#ef4444">0.00</div></div>
                <div class="top-item"><div class="lbl small">å·²è§£é‡Š/æ€»æ•°</div><div class="num">0 / 5</div></div>
              </div>
      
              <div style="overflow:auto;">
                <table class="table" id="tblMissingSameName">
                  <thead>
                    <tr>
                      <th>å¯¹æ‰‹æ–¹åç§°ï¼ˆè¢«å®¡è®¡å•ä½ï¼‰</th>
                      <th class="sortable">ç¼ºå¤±é“¶è¡Œè´¦å·</th>
                      <th class="sortable">æµå…¥æœ¬æ–¹æ€»é¢</th>
                      <th class="sortable">å æ¯”</th>
                      <th class="sortable">æœ¬æ–¹æµå‡ºæ€»é¢</th>
                      <th class="sortable">å æ¯”</th>
                      <th class="sortable">äº¤æ˜“æ¬¡æ•°</th>
                      <th class="sortable">å æ¯”</th>
                      <th>ç¼ºå¤±åŸå› </th>
                      <th>æ”¯æŒæ€§æ–‡ä»¶ç´¢å¼•</th>
                      <th>æ“ä½œ</th>
                    </tr>
                  </thead>
              
                  <tbody>
                    <!-- ====== æ±‡æ€»è¡Œï¼ˆå¯å±•å¼€/æ”¶èµ·ï¼‰ ====== -->
                    <tr class="group-row" data-group="abc">
                      <td>
                        <button class="expand-btn expanded" title="å±•å¼€/æ”¶èµ·æ˜ç»†">â–¼</button>
                        <strong>abcæœ‰é™å…¬å¸</strong>ã€€<span class="text-muted">å·²è§£é‡Š/æ€»æ•°ï¼š0/5</span>
                      </td>
                      <td></td>
                      <td style="color:#2563eb"><strong>12,360,000</strong></td>
                      <td><strong>74.15%</strong></td>
                      <td style="color:#ef4444"><strong>12,360,000</strong></td>
                      <td><strong>100.00%</strong></td>
                      <td><strong>26</strong></td>
                      <td><strong>38.40%</strong></td>
                      <td></td>
                      <td></td>
                      <td></td>
                    </tr>
              
                    <!-- ====== æ˜ç»†è¡Œï¼ˆé»˜è®¤æ˜¾ç¤ºï¼‰ ====== -->
                    <tr class="detail-row group-abc">
                      <td>ã€€â”” abcæœ‰é™å…¬å¸</td>
                      <td>6214 **** 8890</td>
                      <td>2,160,000</td>
                      <td>17.47%</td>
                      <td style="color:#ef4444">2,160,000</td>
                      <td>17.47%</td>
                      <td>8</td>
                      <td>30.77%</td>
                      <td></td>
                      <td></td>
                      <td class="actions">
                      <a href="#" title="æµæ°´æ˜ç»†"><i class="fa-regular fa-file-lines"></i></a>
                      </td>
                    </tr>
              
                    <tr class="detail-row group-abc">
                      <td>ã€€â”” abcæœ‰é™å…¬å¸</td>
                      <td>3941 **** 2193</td>
                      <td>1,500,000</td>
                      <td>12.14%</td>
                      <td style="color:#ef4444">1,500,000</td>
                      <td>12.14%</td>
                      <td>5</td>
                      <td>19.23%</td>
                      <td></td>
                      <td></td>
                      <td class="actions">
                      <a href="#" title="æµæ°´æ˜ç»†"><i class="fa-regular fa-file-lines"></i></a>
                      </td>
                    </tr>
              
                    <tr class="detail-row group-abc">
                      <td>ã€€â”” abcæœ‰é™å…¬å¸</td>
                      <td>2170 **** 7797</td>
                      <td>1,900,000</td>
                      <td>15.37%</td>
                      <td style="color:#ef4444">1,900,000</td>
                      <td>15.37%</td>
                      <td>4</td>
                      <td>15.38%</td>
                      <td></td>
                      <td></td>
                      <td class="actions">
                      <a href="#" title="æµæ°´æ˜ç»†"><i class="fa-regular fa-file-lines"></i></a>
                      </td>
                    </tr>
                  </tbody>
                </table>
              </div>
      
        </div>
      </div></div></section>

      <!-- ===================== ç»è¥å®è´¨ é¢æ¿ ===================== -->
      <section class="tab-pane" id="pane-biz">
        <div class="tab-scroll">
      
          <!-- 1) ç­›é€‰åŒº -->
          
      
          <!-- 2) èµ„é‡‘æµæ°´é‡‘é¢ -->
          <div class="card">
            <div class="head">
              <div class="ph-left">
                <div class="title">èµ„é‡‘æµæ°´é‡‘é¢</div>
                <button class="btn" id="btnAccountLogic">ä¸šåŠ¡é€»è¾‘</button>
                <button class="btn" id="btnAccountTips">æ“ä½œæç¤º</button>
              </div>
              <div class="ph-right">
                <span class="note-link"><i class="icon">
                  <svg viewBox="0 0 24 24"><path d="M12 3v18M5 6h14M5 12h14M5 18h9" fill="none" stroke="currentColor" stroke-width="1.6"></path></svg>
                </i><u>å¤‡æ³¨è¯´æ˜</u></span>
                <span class="pill-wrap">
                  <select id="yearBalance" class="pill-select">
                    <option>2023-2024</option><option>2023</option><option>2024</option>
                  </select>
                  <i class="chev"><svg viewBox="0 0 24 24"><path d="M6 9l6 6 6-6" fill="none" stroke="currentColor" stroke-width="2"></path></svg></i>
                </span>
              </div>
            </div>
      
      
            <div id="chart-balance" class="chart-lg"></div>
          </div>
      
          <!-- 3) æµå…¥æµå‡ºè¶‹åŠ¿ -->
          <div class="card">
            <div class="head">
              <div class="ph-left">
                <div class="title">æµå…¥æµå‡ºè¶‹åŠ¿</div>
                <button class="btn" id="btnAccountLogic">ä¸šåŠ¡é€»è¾‘</button>
                <button class="btn" id="btnAccountTips">æ“ä½œæç¤º</button>
              </div>
              <div class="ph-right">
                <span class="note-link"><i class="icon">
                  <svg viewBox="0 0 24 24"><path d="M12 3v18M5 6h14M5 12h14M5 18h9" fill="none" stroke="currentColor" stroke-width="1.6"></path></svg>
                </i><u>å¤‡æ³¨è¯´æ˜</u></span>
      
                <span class="pill-wrap">
                  <select id="yearIO" class="pill-select">
                    <option>2023-2024</option><option>2023</option><option>2024</option>
                  </select>
                  <i class="chev"><svg viewBox="0 0 24 24"><path d="M6 9l6 6 6-6" fill="none" stroke="currentColor" stroke-width="2"></path></svg></i>
                </span>
      
                <span class="pill-wrap">
                  <select id="ctypeIO" class="pill-select">
                    <option value="all">å…¨éƒ¨ç±»å‹</option><option>ä¾›åº”å•†</option><option>å®¢æˆ·</option><option>å‘˜å·¥</option><option>å…¶ä»–</option><option>ä¸ªäºº</option>
                  </select>
                  <i class="chev"><svg viewBox="0 0 24 24"><path d="M6 9l6 6 6-6" fill="none" stroke="currentColor" stroke-width="2"></path></svg></i>
                </span>
              </div>
            </div>
      
            <div class="kpi-row" id="kpi-io">
              <div class="kpi"><div class="k">æµå…¥é‡‘é¢</div><div class="v" id="io_in_sum">â€”</div></div>
              <div class="kpi"><div class="k">æœˆå‡æµå…¥</div><div class="v" id="io_in_avg">â€”</div></div>
              <div class="kpi"><div class="k">æµå‡ºæ€»é¢</div><div class="v" id="io_out_sum">â€”</div></div>
              <div class="kpi"><div class="k">æœˆå‡æµå‡º</div><div class="v" id="io_out_avg">â€”</div></div>
            </div>
      
            <div id="chart-io" class="chart-md"></div>
          </div>
      
          <!-- 4) æµå…¥æµå‡ºæ„æˆï¼ˆæ ‡é¢˜ + Tab + 7å æ¯” + å·¦å³ä¸¤å›¾ï¼‰ -->
          <div class="card">
            <div class="head">
              <div class="ph-left">
                <div class="title">æµå…¥æµå‡ºæ„æˆ</div>
                <button class="btn" id="btnAccountLogic">ä¸šåŠ¡é€»è¾‘</button>
                <button class="btn" id="btnAccountTips">æ“ä½œæç¤º</button>
              </div>
              <div class="ph-right">
                <span class="note-link"><i class="icon">
                  <svg viewBox="0 0 24 24"><path d="M12 3v18M5 6h14M5 12h14M5 18h9" fill="none" stroke="currentColor" stroke-width="1.6"></path></svg>
                </i><u>å¤‡æ³¨è¯´æ˜</u></span>
              </div>
            </div>
      
            <div class="tabs-mini" id="compTabs">
              <div class="tab active" data-mode="total">äº¤æ˜“æ€»é¢</div>
              <div class="tab" data-mode="in">æµå…¥æ–¹</div>
              <div class="tab" data-mode="out">æµå‡ºæ–¹</div>
            </div>
      
            <div class="seven-cats" id="compCats"></div>
      
            <div class="grid-2">
              <div id="chart-comp-monthly" class="chart-md"></div>
              <div id="chart-comp-top20" class="chart-md"></div>
            </div>
      
            <!-- å·¥å…·æ ï¼šå·¦ä¾§åˆ‡æ¢ / å³ä¾§æŒ‰é’®ç»„ -->
            <div class="table-toolbar">
              <!-- å·¦ï¼šä¸¤æ®µå¼åˆ‡æ¢ -->
              <div class="seg" id="tblSwitcher" role="tablist" aria-label="æ˜ç»†è§†å›¾åˆ‡æ¢">
                <button class="opt active" role="tab" aria-selected="true" data-view="deal">äº¤æ˜“æ˜ç»†</button>
                <button class="opt" role="tab" aria-selected="false" data-view="corp">å·¥å•†ä¿¡æ¯</button>
              </div>
            
              <!-- å³ï¼šåŠŸèƒ½æŒ‰é’® -->
              <div class="btn-bar">
                <button class="btn ghost" id="btnQuick">å¿«é€ŸæŸ¥çœ‹å‹¾é€‰ç»“æœ</button>
                <button class="btn ghost" id="btnReset">é‡ç½®ç­›é€‰</button>
                <button class="btn ghost" id="btnHead">è‡ªå®šä¹‰è¡¨å¤´</button>
                <button class="btn ghost" id="btnDist">æµå…¥æµå‡ºåˆ†å¸ƒ</button>
                <button class="btn primary" id="btnAnalyze">ç”Ÿæˆåˆ†æç»“æœ</button>
                <button class="btn primary" id="btnFlow">ç”Ÿæˆæµæ°´</button>
              </div>
            </div>

            <!-- è¡¨æ ¼ä¸Šæ–¹æç¤ºè¡Œï¼šå·¦ä¾§ + å³ä¾§å„ä¸€æ¡ -->
            <div class="table-announce" id="tableAnnounce">
              <div class="left-msg">
                å½“å‰å·¥ä½œç°¿ä¸‹æ€»è®¡æœ‰
                <strong id="fraudCount" style="font-weight:700;">0</strong>
                ä¸ªå¯¹æ‰‹æ–¹å­˜åœ¨é…åˆé€ å‡è¡Œä¸ºï¼Œè¯·å…³æ³¨ï¼
                ï¼ˆAQPP-Audit æä¾›çš„å…¨é‡é…åˆé€ å‡æ¸…å•è§
                <span class="file-link" id="fraudListFile">ç¬¬ä¸‰æ–¹é…åˆé€ å‡åå•.xlsx</span>ï¼‰
              </div>
              <div class="right-msg">ä¸å‹¾é€‰å³é»˜è®¤åŸºäºå…¨éƒ¨è®°å½•å¯¼å‡º</div>
            </div>
      
            <div id="tbl-deal-wrap">
              <table class="table" id="tblDeal">
                <thead>
                <tr>
                  <th>å¯¹æ‰‹æ–¹åç§°</th><th>å¯¹æ‰‹æ–¹ç±»å‹</th><th>å…³è”å…³ç³»</th><th>é»‘åå•</th>
                  <th>æµå…¥æ€»é¢</th><th>æµå‡ºæ€»é¢</th><th>äº¤æ˜“æ€»é¢</th><th>äº¤æ˜“æ€»é¢å æ¯”</th><th>äº¤æ˜“ç¬”æ•°</th>
                  <th>é”€å”®ç±»åˆ«</th><th>é‡‡è´­ç±»åˆ«</th><th>èŒä½</th><th>å¤‡æ³¨è¯´æ˜</th><th>æ“ä½œ</th>
                </tr>
                </thead>
                <tbody></tbody>
              </table>
              <div id="pagination-deal" class="pagination"></div>
            </div>
      
            <div id="tbl-corp-wrap" class="hide">
              <table class="table" id="tblCorp">
                <thead>
                <tr>
                  <th>å¯¹æ‰‹æ–¹åç§°</th><th>äº¤æ˜“æ€»é¢</th><th>æˆç«‹æ—¥æœŸ</th><th>ç»è¥å¼€å§‹æ—¶é—´</th>
                  <th>ç»è¥ç»“æŸæ—¶é—´</th><th>è¥ä¸šæœŸé™</th><th>ç»è¥çŠ¶æ€</th><th>æ³¨å†Œèµ„æœ¬</th>
                  <th>è¡Œä¸š</th><th>ç»è¥èŒƒå›´</th><th>æ³¨å†Œåœ°å€</th><th>ä¼ä¸šè”ç³»æ–¹å¼</th><th>è‘£ç›‘é«˜</th>
                </tr>
                </thead>
                <tbody></tbody>
              </table>
              <div id="pagination-corp" class="pagination"></div>
            </div>
          </div>
      
        </div>
      </section>

      <!-- =====================å·²çŸ¥å…³è”äº¤æ˜“ é¢æ¿ ===================== -->
      <section class="tab-pane" id="pane-relation">
        <div class="tab-scroll">

           <!-- 4) æµå…¥æµå‡ºæ„æˆï¼ˆæ ‡é¢˜ + Tab + 7å æ¯” + å·¦å³ä¸¤å›¾ï¼‰ -->
          <div class="card">
            <div class="head">
              <div class="ph-left">
                <div class="title">æµå…¥æµå‡ºæ„æˆ</div>
                <button class="btn" id="btnAccountLogic">ä¸šåŠ¡é€»è¾‘</button>
                <button class="btn" id="btnAccountTips">æ“ä½œæç¤º</button>
              </div>
              <div class="ph-right">
                <span class="note-link"><i class="icon">
                  <svg viewBox="0 0 24 24"><path d="M12 3v18M5 6h14M5 12h14M5 18h9" fill="none" stroke="currentColor" stroke-width="1.6"></path></svg>
                </i><u>å¤‡æ³¨è¯´æ˜</u></span>
              </div>
            </div>
      
            <div class="tabs-mini" id="compTabs">
              <div class="tab active" data-mode="total">äº¤æ˜“æ€»é¢</div>
              <div class="tab" data-mode="in">æµå…¥æ–¹</div>
              <div class="tab" data-mode="out">æµå‡ºæ–¹</div>
            </div>
      
            <div class="seven-cats" id="compCats"></div>
      
            <div class="grid-2">
              <div id="chart-comp-monthly" class="chart-md"></div>
              <div id="chart-comp-top20" class="chart-md"></div>
            </div>
      
            <!-- å·¥å…·æ ï¼šå·¦ä¾§åˆ‡æ¢ / å³ä¾§æŒ‰é’®ç»„ -->
            <div class="table-toolbar">
              <!-- å·¦ï¼šä¸¤æ®µå¼åˆ‡æ¢ -->
              <div class="seg" id="tblSwitcher" role="tablist" aria-label="æ˜ç»†è§†å›¾åˆ‡æ¢">
                <button class="opt active" role="tab" aria-selected="true" data-view="deal">äº¤æ˜“æ˜ç»†</button>
                <button class="opt" role="tab" aria-selected="false" data-view="corp">å·¥å•†ä¿¡æ¯</button>
              </div>
            
              <!-- å³ï¼šåŠŸèƒ½æŒ‰é’® -->
              <div class="btn-bar">
                <button class="btn ghost" id="btnQuick">å¿«é€ŸæŸ¥çœ‹å‹¾é€‰ç»“æœ</button>
                <button class="btn ghost" id="btnReset">é‡ç½®ç­›é€‰</button>
                <button class="btn ghost" id="btnHead">è‡ªå®šä¹‰è¡¨å¤´</button>
                <button class="btn ghost" id="btnDist">æµå…¥æµå‡ºåˆ†å¸ƒ</button>
                <button class="btn primary" id="btnAnalyze">ç”Ÿæˆåˆ†æç»“æœ</button>
                <button class="btn primary" id="btnFlow">ç”Ÿæˆæµæ°´</button>
              </div>
            </div>

            <!-- è¡¨æ ¼ä¸Šæ–¹æç¤ºè¡Œï¼šå·¦ä¾§ + å³ä¾§å„ä¸€æ¡ -->
            <div class="table-announce" id="tableAnnounce">
              <div class="left-msg">
                å½“å‰å·¥ä½œç°¿ä¸‹æ€»è®¡æœ‰
                <strong id="fraudCount" style="font-weight:700;">0</strong>
                ä¸ªå¯¹æ‰‹æ–¹å­˜åœ¨é…åˆé€ å‡è¡Œä¸ºï¼Œè¯·å…³æ³¨ï¼
                ï¼ˆAQPP-Audit æä¾›çš„å…¨é‡é…åˆé€ å‡æ¸…å•è§
                <span class="file-link" id="fraudListFile">ç¬¬ä¸‰æ–¹é…åˆé€ å‡åå•.xlsx</span>ï¼‰
              </div>
              <div class="right-msg">ä¸å‹¾é€‰å³é»˜è®¤åŸºäºå…¨éƒ¨è®°å½•å¯¼å‡º</div>
            </div>
      
            <div id="tbl-deal-wrap">
              <table class="table" id="tblDeal">
                <thead>
                <tr>
                  <th>å¯¹æ‰‹æ–¹åç§°</th><th>å¯¹æ‰‹æ–¹ç±»å‹</th><th>å…³è”å…³ç³»</th><th>é»‘åå•</th>
                  <th>æµå…¥æ€»é¢</th><th>æµå‡ºæ€»é¢</th><th>äº¤æ˜“æ€»é¢</th><th>äº¤æ˜“æ€»é¢å æ¯”</th><th>äº¤æ˜“ç¬”æ•°</th>
                  <th>é”€å”®ç±»åˆ«</th><th>é‡‡è´­ç±»åˆ«</th><th>èŒä½</th><th>å¤‡æ³¨è¯´æ˜</th><th>æ“ä½œ</th>
                </tr>
                </thead>
                <tbody></tbody>
              </table>
              <div id="pagination-deal" class="pagination"></div>
            </div>
      
            <div id="tbl-corp-wrap" class="hide">
              <table class="table" id="tblCorp">
                <thead>
                <tr>
                  <th>å¯¹æ‰‹æ–¹åç§°</th><th>äº¤æ˜“æ€»é¢</th><th>æˆç«‹æ—¥æœŸ</th><th>ç»è¥å¼€å§‹æ—¶é—´</th>
                  <th>ç»è¥ç»“æŸæ—¶é—´</th><th>è¥ä¸šæœŸé™</th><th>ç»è¥çŠ¶æ€</th><th>æ³¨å†Œèµ„æœ¬</th>
                  <th>è¡Œä¸š</th><th>ç»è¥èŒƒå›´</th><th>æ³¨å†Œåœ°å€</th><th>ä¼ä¸šè”ç³»æ–¹å¼</th><th>è‘£ç›‘é«˜</th>
                </tr>
                </thead>
                <tbody></tbody>
              </table>
              <div id="pagination-corp" class="pagination"></div>
            </div>
          </div>
      
        </div>
      </section>

      <!-- ===================== ç‰¹å®šå·¥å•†æŸ¥è¯¢  ===================== -->
      <section class="tab-pane" id="pane-routine">
        <div class="tab-scroll">
          <div class="split">
            <!-- å·¦ä¾§èœå• -->
            <aside class="sidebar-pane">
              <div class="menu" id="routineMenu">
                <div class="item active" data-code="2.1">1. ç»è¥æ—¶é—´è¾ƒçŸ­</div>
                <div class="item" data-code="2.2">2. ç¤¾ä¿ç¼´çº³äººæ•°è¾ƒå°‘</div>
                <div class="item" data-code="2.3">3. ä¸ºä¸ªäººæˆ–ä¸ªä½“å·¥å•†æˆ·</div>
                <div class="item" data-code="2.4">4. æ³¨å†Œèµ„æœ¬ä¸äº¤æ˜“è§„æ¨¡ä¸åŒ¹é…</div>
                <div class="item" data-code="2.5">5. äº¤æ˜“è§„æ¨¡ä¸ç¬¬ä¸‰æ–¹æ‰€å¤„è¡Œä¸šçŠ¶å†µä¸åŒ¹é…</div>
                <div class="item" data-code="2.6">6. ç»è¥èŒƒå›´ä¸äº¤æ˜“æ€§è´¨ä¸åŒ¹é…</div>
                <div class="item" data-code="2.7">7. æ³¨å†Œåœ°å€ä¸è¢«å®¡è®¡å•ä½åœ°å€è¾ƒä¸ºæ¥è¿‘</div>
                <div class="item" data-code="2.8">8. ä¸åŒç¬¬ä¸‰æ–¹çš„å·¥å•†ç™»è®°ä¿¡æ¯ç›¸åŒæˆ–ç›¸è¿‘</div>
                <div class="item" data-code="2.9">9. æ—¢æ˜¯å®¢æˆ·åˆæ˜¯ä¾›åº”å•†ï¼Œæˆ–å—åŒä¸€å®é™…æ§åˆ¶äººæ§åˆ¶</div>
              </div>
              <div class="small">è¯´æ˜ï¼šåˆ‡æ¢ Routine ä»…åˆ·æ–°å³ä¾§å†…å®¹ã€‚</div>
              <button class="sbar-toggle-inset" type="button" aria-label="æ”¶èµ·ä¾§æ "></button>
            </aside>

            <main>
              <!-- ========= é€šç”¨ Routine å¸ƒå±€ï¼ˆ1,2,3,4,5,6,8,9 å…±ç”¨ï¼‰ ========= -->
              <div class="routine-common-block" id="routineCommon">
                <!-- é¡¶éƒ¨ï¼šæ ‡é¢˜ + ä¸»å¡ç‰‡ï¼ˆå·¦ç”°å­—æ ¼ + å³æ•£ç‚¹å›¾ï¼‰ -->
                <div class="card routine-card">
                  <div class="head">
                    <div class="title" id="rTitle">ç»è¥æ—¶é—´æ±‡æ€»æŒ‡æ ‡</div>
                  </div>
                  <div class="content">
                    <div class="routine-main">
                      <!-- å·¦ï¼š2Ã—2 ç”°å­—æ ¼ + æ¯æ ¼å³ä¾§å°ç®±çº¿å›¾ -->
                      <section class="routine-kpi-panel">
                        <div class="kpi-panel-title">åˆ†æ®µæ•´ä½“æƒ…å†µ</div>
                          <!-- Routine4 ä¸“ç”¨ç­›é€‰æ¡ï¼šä»…åœ¨ 2.4 æ˜¾ç¤º -->
                          <div class="filters-bar" id="r4Filters">
                            <!-- å¯¹æ‰‹æ–¹ç±»å‹å¤šé€‰ -->
                            <div class="field">
                              <label>å¯¹æ‰‹æ–¹ç±»å‹ï¼š</label>
                              <div class="multi" id="r4TypeBox">
                                <button type="button" class="multi-toggle" id="r4TypeBtn">
                                  <span id="r4TypeText">å…¨éƒ¨</span>
                                  <i class="chev">â–¾</i>
                                </button>
                                <div class="multi-menu" id="r4TypeMenu"></div>
                              </div>
                            </div>

                            <!-- è‡ªå®šä¹‰ï¼‰ -->
                            <div class="field breaks">
                              <label>åˆ†æ®µé˜ˆå€¼ ï¼š</label>
                              <input type="number" step="0.01" id="r4b0" value="" />
                              <span class="sep">/</span>
                              <input type="number" step="0.01" id="r4b1" value="" />
                              <span class="sep">/</span>
                              <input type="number" step="0.01" id="r4b2" value="" />
                              <button class="btn primary" id="r4Apply">ç­›é€‰</button>
                            </div>
                          </div>
                        <div class="top-strip" id="topStrip">
                          <!-- JS åŠ¨æ€æ’å…¥ .kpi-box-card -->
                        </div>
                      </section>

                      <!-- å³ï¼šæ•£ç‚¹å›¾ -->
                      <section class="routine-scatter">
                        <div class="scatter-title" id="scatterTitle">
                          ç»è¥æ—¶é—´åˆ†å¸ƒè¡¨
                        </div>
                        <div id="chart-scatter" class="chart"></div>
                      </section>
                    </div>
                  </div>
                </div>

                <!-- æ˜ç»†ï¼šäº¤æ˜“æ˜ç»†è¡¨ -->
                <div class="card">
                  <div class="head">
                    <div class="title">äº¤æ˜“æ˜ç»†è¡¨</div>
                  </div>
                  <div class="content" style="overflow:auto;max-height:520px">
                    <table class="table" id="tblRoutineDetail">
                      <thead></thead>
                      <tbody></tbody>
                    </table>
                    <div id="pagination-routine" class="pagination"></div>
                  </div>
                </div>
              </div>
              <!-- ========= /é€šç”¨ Routine å¸ƒå±€ ========= -->

              <!-- ========= Routine7ï¼šæ³¨å†Œåœ°å€æ¥è¿‘ Â· åœ°å›¾ï¼ˆç‹¬ç«‹æ¨¡å— r7xï¼‰ ========= -->
              <section id="r7x" style="display:none;">
                <div class="card">
                  <div class="head">
                    <div class="title">7. æ³¨å†Œåœ°å€ä¸è¢«å®¡è®¡å•ä½åœ°å€æ¥è¿‘ Â· åœ°å›¾</div>
                  </div>

                  <div class="content">
                    <div class="r7x-layout">
                      <!-- å·¦åˆ—ï¼šç­›é€‰ + 2Ã—2 KPI -->
                      <aside class="r7x-left">
                        <!-- é¡¶éƒ¨ç­›é€‰æ¡ -->
                        <div class="r7x-filters">
                          <label class="lbl">è¢«å®¡è®¡å•ä½ï¼š</label>
                          <select id="r7xAuditSel" class="pill-select"></select>

                          <span class="sep"></span>

                          <label class="lbl">æ˜¾ç¤ºçº§åˆ«ï¼š</label>
                          <label class="chk"><input type="checkbox" value="city"     checked> åŒå¸‚</label>
                          <label class="chk"><input type="checkbox" value="district" checked> åŒåŒº/å¿</label>
                          <label class="chk"><input type="checkbox" value="street"   checked> åŒè¡—é“</label>
                          <label class="chk"><input type="checkbox" value="near"     checked> è·ç¦»&lt;1km</label>
                        </div>

                        <!-- 2Ã—2 ç”°å­—æ ¼ KPI -->
                        <div class="r7x-kpi-grid">
                          <div class="r7x-kpi kpi-blue">
                            <div class="kpi-title">åŒå¸‚</div>
                            <div class="kpi-num" id="r7xCityCnt">0</div>
                            <div class="kpi-sub">ç´¯è®¡æµå…¥ï¼š<b id="r7xCityIn">0 ä¸‡</b></div>
                            <div class="kpi-sub">ç´¯è®¡æµå‡ºï¼š<b id="r7xCityOut">0 ä¸‡</b></div>
                          </div>

                          <div class="r7x-kpi kpi-green">
                            <div class="kpi-title">åŒåŒº/å¿</div>
                            <div class="kpi-num" id="r7xDistrictCnt">0</div>
                            <div class="kpi-sub">ç´¯è®¡æµå…¥ï¼š<b id="r7xDistrictIn">0 ä¸‡</b></div>
                            <div class="kpi-sub">ç´¯è®¡æµå‡ºï¼š<b id="r7xDistrictOut">0 ä¸‡</b></div>
                          </div>

                          <div class="r7x-kpi kpi-orange">
                            <div class="kpi-title">åŒè¡—é“</div>
                            <div class="kpi-num" id="r7xStreetCnt">0</div>
                            <div class="kpi-sub">ç´¯è®¡æµå…¥ï¼š<b id="r7xStreetIn">0 ä¸‡</b></div>
                            <div class="kpi-sub">ç´¯è®¡æµå‡ºï¼š<b id="r7xStreetOut">0 ä¸‡</b></div>
                          </div>

                          <div class="r7x-kpi kpi-red">
                            <div class="kpi-title">è·ç¦» &lt; 1km</div>
                            <div class="kpi-num" id="r7xNearCnt">0</div>
                            <div class="kpi-sub">ç´¯è®¡æµå…¥ï¼š<b id="r7xNearIn">0 ä¸‡</b></div>
                            <div class="kpi-sub">ç´¯è®¡æµå‡ºï¼š<b id="r7xNearOut">0 ä¸‡</b></div>
                          </div>

                          <div class="r7x-anchor">
                            <div class="small text-muted">è¢«å®¡è®¡å•ä½åæ ‡ï¼š</div>
                            <div class="anchor-xy" id="r7xAnchorXY">â€”</div>
                          </div>
                        </div>
                      </aside>

                      <!-- å³åˆ—ï¼šåœ°å›¾ -->
                      <section class="r7x-map-wrap">
                        <div id="r7xMap" aria-label="åœ°å›¾"></div>
                        <div class="r7x-legend">
                          <span><i style="background:#2563eb;"></i>åŒå¸‚</span>
                          <span><i style="background:#16a34a;"></i>åŒåŒº/å¿</span>
                          <span><i style="background:#f59e0b;"></i>åŒè¡—é“</span>
                          <span><i style="background:#ef4444;"></i>è·ç¦»&lt;1km</span>
                          <span><i style="background:#334155;opacity:.6;"></i>å…¶ä»–</span>
                        </div>
                      </section>
                    </div>
                  </div>
                </div>

                <!-- ä¸‹ï¼šæ˜ç»†è¡¨ -->
                <div class="card">
                  <div class="head"><div class="title">å½“å‰åœ°å›¾ç‚¹ Â· å¯¹æ‰‹æ–¹æ˜ç»†</div></div>
                  <div class="content">
                    <div style="overflow:auto;max-height:360px">
                      <table class="table" id="r7xTable">
                        <thead>
                          <tr>
                            <th>å¯¹æ‰‹æ–¹åç§°</th>
                            <th>æ¥è¿‘çº§åˆ«</th>
                            <th>è·ç¦»(km)</th>
                            <th>åŸå¸‚</th>
                            <th>åŒº/å¿</th>
                            <th>è¡—é“</th>
                            <th>ç»åº¦</th>
                            <th>çº¬åº¦</th>
                            <th>ç´¯è®¡æµå…¥(ä¸‡)</th>
                            <th>ç´¯è®¡æµå‡º(ä¸‡)</th>
                            <th>äº¤æ˜“æ€»é¢(ä¸‡)</th>
                          </tr>
                        </thead>
                        <tbody></tbody>
                      </table>
                    </div>
                  </div>
                </div>
              </section>
              <!-- ========= /Routine7 ========= -->
            </main>
          </div>
        </div>
      </section>

      <!-- ===================== èµ„é‡‘æµæ°´æ ¸æŸ¥åº•ç¨¿å¯¼å‡º ===================== -->
      <!-- ===================== èµ„é‡‘æµæ°´æ ¸æŸ¥åº•ç¨¿å¯¼å‡º ===================== -->
      <section class="tab-pane" id="pane-workingpaper">
        <div class="tab-scroll">

          <!-- é¡¶éƒ¨ä¿¡æ¯æ¡ï¼ˆå°æ¡æ¡ï¼‰ -->
          <div class="wp-info-bar">
            <div class="kv">é¡¹ç›®ç¼–å·/åç§°ï¼š<b id="wpProj">2025-AC-0001 / Test2</b></div>
            <div class="kv">å·¥ä½œç°¿åç§°ï¼š<b id="wpBook">Audit Compass Dev</b></div>
            <div class="kv">å·¥ä½œç°¿ç±»å‹ï¼š<b id="wpKind">IPO</b></div>
            <div class="kv">èµ„æœ¬å¸‚åœºï¼š
              <b id="wpMarket">A</b>
              <span class="edit" id="wpEditMarket" title="ç¼–è¾‘">âœ</span>
            </div>
          </div>

          <!-- ä¿¡æ¯æµ‹è¯•ï¼ˆæ¨ªå‘æ­¥éª¤æµï¼Œä»…è¯¥å¡ç‰‡éœ€è¦é®ç½©ï¼‰ -->
          <div class="card wp-card" id="wpInfoCard">
            <div class="head">
              <div class="title">ä¿¡æ¯æµ‹è¯•ï¼ˆStep1 â†’ Step2 â†’ Step3ï¼‰</div>
            </div>

            <div class="content">
              <!-- æ¨ªå‘æ“ä½œæµï¼ˆæ›´ç´§å‡‘ï¼‰ -->
              <div class="op-flow small">
                <!-- Step1 -->
                <div class="op-step" id="opStep1">
                  <div class="op-hd">
                    <span class="idx">1</span>
                    <span class="t">æ•°æ®è·å–æ–¹å¼</span>
                    <span class="state" id="s1State">æœªå®Œæˆ</span>
                  </div>
                  <div class="op-bd">
                    <div class="row">
                      <button class="btn primary" id="s1Save" disabled>ä¿å­˜ Step1</button>
                      <button class="btn" id="s1Modify" style="display:none;">ä¿®æ”¹ Step1</button>
                    </div>
                    <div class="muted">åœ¨ä¸‹è¡¨â€œæ•°æ®è·å–æ–¹å¼ï¼ˆè¯´æ˜ï¼‰â€åˆ—é€è¡Œé€‰æ‹©å®Œæˆåï¼Œæ–¹å¯ä¿å­˜ã€‚</div>
                  </div>
                </div>

                <!-- Step2 -->
                <div class="op-step" id="opStep2">
                  <div class="op-hd">
                    <span class="idx">2</span>
                    <span class="t">Direct Test</span>
                    <span class="state" id="s2State">ä¸å¯ç”¨</span>
                  </div>
                  <div class="op-bd">
                    <div class="row">
                      <label><input type="radio" name="wpDT" value="Y" checked disabled> æ˜¯</label>
                      <label><input type="radio" name="wpDT" value="N" disabled> å¦</label>
                    </div>
                    <div class="muted" id="s2Hint">è¯·å…ˆå®Œæˆå¹¶ä¿å­˜ Step1</div>
                  </div>
                </div>

                <!-- Step3 -->
                <div class="op-step" id="opStep3">
                  <div class="op-hd">
                    <span class="idx">3</span>
                    <span class="t">é£é™©ç­‰çº§ & æ ·æœ¬é‡</span>
                    <span class="state" id="s3State">ä¸å¯ç”¨</span>
                  </div>
                  <div class="op-bd">
                    <div class="row">
                      <select id="riskSel" disabled>
                        <option value="">é€‰æ‹©é£é™©ç­‰çº§â€¦</option>
                        <option value="é‡å¤§+">é‡è¦çš„+</option>
                        <option value="é‡å¤§">é‡è¦çš„</option>
                        <option value="æé«˜">æé«˜çš„</option>
                        <option value="åŸºç¡€">åŸºç¡€çš„</option>
                      </select>
                      <button class="btn" id="btnCalc" disabled>è®¡ç®—æ ·æœ¬é‡</button>
                    </div>
                    <div class="muted" id="riskNote">åŸºäºé£é™©ç­‰çº§ï¼šâ€”</div>
                  </div>
                </div>
              </div>

              <!-- è¡¨æ ¼å·¥å…·æ ï¼ˆå³ä¸Šè§’æŒ‰é’® + å·¦ä¾§æç¤ºï¼‰ -->
              <div class="table-toolbar">
                <div class="tt-left muted">æ ·æœ¬é‡ä¼šå†™å…¥â€œæœ€å°æ ·æœ¬é‡â€åˆ—ã€‚</div>
                <div class="tt-right">
                  <button class="btn" id="btnCols">è‡ªå®šä¹‰è¡¨å¤´</button>
                  <button class="btn" id="btnExport">å¯¼å‡º</button>
                  <label class="btn">å¯¼å…¥
                    <input id="btnImport" type="file" accept=".xlsx,.csv" hidden>
                  </label>
                </div>
              </div>

              <!-- è¡¨æ ¼ï¼šæ–¹å¼åˆ—å†…ç¼–è¾‘ + æœ€å°æ ·æœ¬é‡åˆ—å±•ç¤º/å¯è¦†ç›– -->
              <div class="wp-table-wrap">
                <table class="table" id="wpTable">
                  <thead>
                    <tr>
                      <th>è¢«å®¡è®¡å•ä½åç§°</th>
                      <th>é“¶è¡Œè´¦å·</th>
                      <th>æœ¬æ–¹é“¶è¡Œ</th>
                      <th class="num">äº¤æ˜“æ€»é¢</th>
                      <th class="num">äº¤æ˜“ç¬”æ•°</th>
                      <th style="min-width:260px;">
                      <span class="th-pill"><span class="pill">1</span><span>æ•°æ®è·å–æ–¹å¼ï¼ˆè¯´æ˜ï¼‰</span></span>
                    </th>
                    <th class="num" style="min-width:140px;">
                      <span class="th-pill"><span class="pill">3</span><span>æœ€å°æ ·æœ¬é‡</span></span>
                    </th>
                    </tr>
                  </thead>
                  <tbody></tbody>
                </table>
              </div>

              <!-- ä»…é®â€œä¿¡æ¯æµ‹è¯•â€å¡ç‰‡çš„ç½©å­ -->
              <div class="card-mask" id="wpMaskInfo" style="display:none;">
                <div class="note">å½“å‰å·¥ä½œç°¿ç±»å‹ä¸ºé IPOï¼Œæœ¬åŠŸèƒ½ä¸é€‚ç”¨</div>
              </div>
            </div>
          </div>
        </div>
      </section>

      <!-- âœ ç¼–è¾‘å¼¹çª— -->
      <div class="modal" id="wpModal">
        <div class="dialog">
          <div class="hd">
            <span>ç¼–è¾‘å·¥ä½œç°¿å±æ€§</span>
            <span class="x" id="wpModalClose">âœ•</span>
          </div>
          <div class="bd">
            <div class="row2">
              <div class="field">
                <label>æ˜¯å¦ IPO</label>
                <div class="radio">
                  <label><input type="radio" name="wpIPO" value="Y" checked> æ˜¯</label>
                  <label><input type="radio" name="wpIPO" value="N"> å¦</label>
                </div>
              </div>
              <div class="field">
                <label>èµ„æœ¬å¸‚åœº</label>
                <select id="wpMarketSel">
                  <option value="A">A</option>
                  <option value="H">H</option>
                  <option value="ç§‘åˆ›æ¿">ç§‘åˆ›æ¿</option>
                  <option value="åˆ›ä¸šæ¿">åˆ›ä¸šæ¿</option>
                </select>
              </div>
            </div>
            <div class="row2" style="margin-top:12px;">
              <div class="field">
                <label>è´¢å¹´ç»“æŸæ—¥æœŸ</label>
                <input type="text" id="wpFyEnd" placeholder="ä¾‹å¦‚ï¼š12-31" value="12-31"/>
              </div>
              <div class="field">
                <label>é‡è¦æ€§æ°´å¹³ï¼ˆMaterialityï¼‰</label>
                <input type="number" id="wpMateriality" placeholder="ä»…æ­£æ•°ï¼Œæ”¯æŒåƒåˆ†ä½" min="0"/>
              </div>
            </div>
            <div class="muted" style="margin-top:6px;">å¯¼å‡ºæ ¡éªŒï¼šMateriality ä¸ºç©ºæˆ– 0 å°†é˜»æ­¢å¯¼å‡ºå¹¶æç¤ºã€‚</div>
          </div>
          <div class="ft">
            <button class="btn" id="wpModalCancel">å–æ¶ˆ</button>
            <button class="btn primary" id="wpModalOk">æäº¤</button>
          </div>
        </div>
      </div>


      


      

      


      
            <!-- ====== ä½ çš„â€œé“¶è¡Œæµæ°´åˆ†æ Â· å®Œæ•´ç‰ˆâ€å†…å®¹ç»“æŸ ====== -->
            </div>
            </div>
            
            <!-- âœ… ä¿®æ­£åçš„ Footerï¼ˆç‹¬ç«‹ã€å¯å›ºå®šï¼‰ -->
            <footer id="app-footer">
              <p>KPMG Audit Compass V3.4.0(2025.2)</p >
              <p>Â© 2025 æ¯•é©¬å¨ç§‘æŠ€æœåŠ¡(é¦™æ¸¯)æœ‰é™å…¬å¸ â€” é¦™æ¸¯ç‰¹åˆ«è¡Œæ”¿åŒºæœ‰é™è´£ä»»å…¬å¸ï¼Œæ˜¯ä¸è‹±å›½ç§è¥æ‹…ä¿æœ‰é™å…¬å¸ â€” æ¯•é©¬å¨å›½é™…æœ‰é™å…¬å¸ç›¸å…³è”çš„ç‹¬ç«‹æˆå‘˜æ‰€å…¨çƒæ€§ç»„ç»‡ä¸­çš„æˆå‘˜ã€‚ç‰ˆæƒæ‰€æœ‰ï¼Œä¸å¾—è½¬è½½ã€‚ æ¯•é©¬å¨çš„åç§°å’Œæ ‡è¯†å‡ä¸ºæ¯•é©¬å¨å…¨çƒæ€§ç»„ç»‡ä¸­çš„ç‹¬ç«‹æˆå‘˜æ‰€ç»è®¸å¯åä½¿ç”¨çš„å•†æ ‡ã€‚</p >
            </footer>


  <!-- ====== é¡µé¢è„šæœ¬ï¼šå®Œæ•´åŠŸèƒ½é€»è¾‘ä¿æŒä¸å˜ ====== -->
 <script>
  /* =============== å·¥å…· =============== */
  function ez(id,opt){const c=echarts.init(document.getElementById(id));c.setOption(opt);window.addEventListener('resize',()=>c.resize());return c;}
  function fmtWan(v){return (Math.round(v*10)/10).toLocaleString()}
  function randPick(arr){return arr[Math.floor(Math.random()*arr.length)]}

  /* =============== é€ æ›´çœŸå®çš„æ•°æ®ï¼ˆæœ¬åœ°éšæœºï¼‰ =============== */
  const companyPrefixes = ['ä¸Šæµ·','åŒ—äº¬','æ·±åœ³','æ­å·','å¹¿å·','å—äº¬','æˆéƒ½','æ­¦æ±‰','è‹å·','å¤©æ´¥','é‡åº†','åˆè‚¥','è¥¿å®‰'];
  const companyMains = ['æ’ä¿¡','å¼˜ä¸š','ä¸­ç§‘','è”åˆ›','ä½³æˆ','å®æ³°','è¿œæ™¯','è“æµ·','æ˜Ÿå®‡','æ–°é”','é¼ç››','åšçº³','å¯èˆª','å¾®è”','ç§‘è¿ˆ','ç‘åš','ç‘å£°','æ­£æ³°','ä¸­æ™º','æ™®å','å¾·å‹¤','å¿—æˆ','èˆªå¤©','åç§‘','é•¿æ±Ÿ','å‡Œäº‘'];
  const companySuffixes = ['ç§‘æŠ€æœ‰é™å…¬å¸','ä¿¡æ¯æŠ€æœ¯æœ‰é™å…¬å¸','å®ä¸šæœ‰é™å…¬å¸','ä¾›åº”é“¾ç®¡ç†æœ‰é™å…¬å¸','ç”µå­å•†åŠ¡æœ‰é™å…¬å¸','å•†ä¸šç®¡ç†æœ‰é™å…¬å¸','è´¸æ˜“æœ‰é™å…¬å¸','ç”Ÿç‰©ç§‘æŠ€æœ‰é™å…¬å¸','æ™ºèƒ½ç§‘æŠ€æœ‰é™å…¬å¸','æ•°æ®ç§‘æŠ€æœ‰é™å…¬å¸','åŒ»è¯æœ‰é™å…¬å¸','ç½‘ç»œç§‘æŠ€æœ‰é™å…¬å¸'];
  const funcs = ['æ€»éƒ¨','ç ”å‘','é”€å”®','é‡‡è´­','ç”Ÿäº§','è´¢åŠ¡','äººåŠ›','å¸‚åœº','å®¢æœ','æ³•åŠ¡'];
  const banks = ['å·¥è¡Œ','å»ºè¡Œ','å†œè¡Œ','ä¸­è¡Œ','æ‹›è¡Œ','äº¤è¡Œ','æµ¦å‘','å…´ä¸š','æ°‘ç”Ÿ','ä¸­ä¿¡'];
  const legals = ['å¼ ä¼Ÿ','ç‹ç£Š','æé™','åˆ˜æ´‹','é™ˆæ°','æ¨æ•','èµµå¼º','é»„èŠ³','å‘¨é¢–','å´ç£Š','éƒ‘å‡¯','å­™å©·','æœ±æ•','èƒ¡æ¶›','éƒ­å¼º','ä½•å†›','é«˜ç£Š','ç½—æ•','æ¢æ°','å®‹ä¼Ÿ'];
  const rels = ['å®¢æˆ·','ä¾›åº”å•†','å‘˜å·¥','å…¶ä»–'];

  const N = 220; // æ›´å¤šæ•°æ®
  const companies = Array.from({length:N},(_,i)=>{
    const foundedDays = Math.floor(Math.random()*3650)+60; // 2ä¸ªæœˆ~10å¹´
    const employees = Math.floor(Math.random()*150);
    const inflow = +(Math.random()*1500+30).toFixed(1);   // ä¸‡
    const outflow= +(Math.random()*1300+20).toFixed(1);   // ä¸‡
    const txCnt  = Math.floor(Math.random()*120)+2;
    const total  = +(inflow+outflow).toFixed(1);
    const recognized = Math.random()>0.3;
    const date = new Date(Date.now()-foundedDays*86400000);
    const dstr = `${date.getFullYear()}-${String(date.getMonth()+1).padStart(2,'0')}-${String(date.getDate()).padStart(2,'0')}`;
    const name = `${randPick(companyPrefixes)}${randPick(companyMains)}${randPick(companySuffixes)}`
    return {
      id:i+1,
      name,
      inflow, outflow, total, txCnt,
      rel: randPick(rels),
      bank: randPick(banks),
      recognized,
      foundedDays, foundedDate:dstr,
      capital: Math.floor(Math.random()*10000)+100, // ä¸‡
      legal: randPick(legals),
      status: Math.random()>0.08 ? 'å­˜ç»­' : (Math.random()>0.5 ? 'åœ¨ä¸š' : 'æ³¨é”€'),
      lawsuits: Math.floor(Math.random()*8),
      dishonesty: Math.floor(Math.random()*4),
      employees,
      type: (Math.random()>0.72 ? (Math.random()>0.5?'ä¸ªäºº':'ä¸ªä½“å·¥å•†æˆ·') : 'å…¬å¸'),

      // æ–°å¢å­—æ®µ
      blacklist: Math.random()>0.8 ? 'æ˜¯' : 'å¦',
      ctype: ['å®¢æˆ·','ä¾›åº”å•†','å‘˜å·¥'][i%3],
      relation: ['æ¯å­å…¬å¸','åŒè‚¡ä¸œ','ä¸Šä¸‹æ¸¸'][i%3],
      sales: ['åŸæ–™','æˆå“','æœåŠ¡'][i%3],
      purchase: ['åŸæ–™','æˆå“','æœåŠ¡'][2-i%3],
      job: ['æ€»ç»ç†','è´¢åŠ¡','å‘˜å·¥'][i%3],
      note: 'å¤‡æ³¨' + (i+1),
      startDate: '2019-01-01',
      endDate: '2029-12-31',
      term: '20å¹´',
      industry: ['åˆ¶é€ ä¸š','æœåŠ¡ä¸š','é›¶å”®ä¸š'][i%3],
      scope: 'ä¸»è¥ä¸šåŠ¡èŒƒå›´æè¿°',
      addr: 'æŸå¸‚æŸåŒºæŸè·¯',
      contact: '010-88888888',
      directors: 'å¼ ä¸‰/æå››/ç‹äº”'
    }
  });

    /* =============== é¡¶éƒ¨ç­›é€‰ä¸‹æ‹‰ï¼šå¤–ç½®å¹¶å¡«å……é€‰é¡¹ =============== */
    const auditedCompanies = [
      'è¢«å®¡è®¡å•ä½Aé›†å›¢æœ‰é™å…¬å¸','è¢«å®¡è®¡å•ä½Bç§‘æŠ€è‚¡ä»½æœ‰é™å…¬å¸','è¢«å®¡è®¡å•ä½Cå®ä¸šå‘å±•æœ‰é™å…¬å¸','è¢«å®¡è®¡å•ä½Dä¿¡æ¯æŠ€æœ¯æœ‰é™å…¬å¸'
    ];
    function initFilters(){
      const fCompany=document.getElementById('fCompany');
      const fBank=document.getElementById('fBank');
      const fFunc=document.getElementById('fFunc');
      fCompany.innerHTML = ['<option value="all">å…¨éƒ¨</option>',...auditedCompanies.map(x=>`<option>${x}</option>`)].join('');
      const bankOpts = ['å…¨éƒ¨',...new Set(companies.map(x=>x.bank))];
      fBank.innerHTML = bankOpts.map(x=>`<option>${x}</option>`).join('');
      fFunc.innerHTML = ['å…¨éƒ¨',...funcs].map(x=>`<option>${x}</option>`).join('');
    }
    initFilters();

    // é¡¶éƒ¨ tab åˆ‡æ¢
    const TAB_INTROS = {
      account:"æœ¬é¡µä¸ºç”¨æˆ·æä¾›èµ„é‡‘æ€»è§ˆã€è´¦æˆ·äº¤æ˜“æŒ‰æœˆåˆ†å¸ƒã€ç¼ºå¤±åŒåè´¦æˆ·ä¸‰å¤§åŠŸèƒ½æ¨¡å—ï¼Œæ—¨åœ¨å¸®åŠ©ç”¨æˆ·å…¨é¢äº†è§£å·²ä¸Šä¼ å¹¶æ‰§è¡Œåˆ†æçš„é“¶è¡Œæµæ°´çš„èµ„é‡‘è§„æ¨¡ã€å„é“¶è¡Œè´¦å·äº¤æ˜“åˆ†å¸ƒæƒ…å†µï¼ŒåŒæ—¶è¯†åˆ«å‡ºæœªè·å–æµæ°´çš„é“¶è¡Œè´¦å·ã€‚",
      biz:"æœ¬é¡µä¸ºç”¨æˆ·æä¾›å·²ä¸Šä¼ å¹¶æ‰§è¡Œåˆ†æçš„é“¶è¡Œæµæ°´çš„å¤šç»´åº¦åˆ†æï¼ŒåŒ…æ‹¬ï¼šèµ„é‡‘æµæ°´ä½™é¢ã€æµå…¥æµå‡ºè¶‹åŠ¿ã€æµå…¥æµå‡ºæ„æˆï¼Œé€šè¿‡æ—¶é—´åºåˆ—åˆ†æã€äº¤æ˜“æ€§è´¨å’Œå¯¹æ‰‹æ–¹æ€§è´¨ç­‰åˆ†æï¼Œæ—¨åœ¨å¸®åŠ©ç”¨æˆ·è¯†åˆ«åˆ°ä¸è¢«å®¡è®¡å•ä½çš„èµ„é‡‘è§„æ¨¡ä¸è¿è¥æ¨¡å¼é¢„æœŸä¸ç¬¦çš„æƒ…å†µã€‚(æœ¬é¡µçš„æ‰€æœ‰é‡‘é¢ï¼Œå·²æŒ‰ç…§ç”¨æˆ·ä¸Šä¼ çš„æ±‡ç‡ä¸»æ¡£æˆ–ç³»ç»Ÿé»˜è®¤PBOCæ±‡ç‡è¿›è¡Œè½¬æ¢ï¼Œå‡ä»¥äººæ°‘å¸æ˜¾ç¤º)",
      relation:"æœ¬é¡µå±•ç¤ºå’Œåˆ†æï¼š(1)å…³è”æ–¹ä¸»æ¡£ä¸­çš„å¯¹æ‰‹æ–¹ï¼Œå’Œ(2)äºâ€œç»è¥å®è´¨>æµå…¥æµå‡ºæ„æˆâ€ä¸­æ‰‹å·¥æ ‡è®°ä¸ºå…³è”æ–¹çš„å¯¹æ‰‹æ–¹çš„äº¤æ˜“ï¼Œæ—¨åœ¨å¸®åŠ©ç”¨æˆ·å…¨é¢äº†è§£è¢«å®¡è®¡å•ä½ä¸å…³è”æ–¹çš„èµ„é‡‘å¾€æ¥ï¼ŒååŠ©ç”¨æˆ·è¿›è¡Œå…³è”æ–¹æŠ«éœ²ã€‚å¦‚ç”¨æˆ·æš‚æœªä¸Šä¼ å…³è”æ–¹ä¸»æ¡£æˆ–æœªæ‰‹å·¥æ‰“æ ‡ï¼Œåˆ™æœ¬é¡µå±•ç¤ºå†…å®¹ä¸ºç©ºã€‚",
      transaction:"æœ¬é¡µå±•ç¤ºå’Œåˆ†æï¼š(1)å‘˜å·¥ä¸»æ¡£ä¸­çš„å¯¹æ‰‹æ–¹ï¼Œå’Œ(2)å…¶ä»–ä¸ªäºº(å°äºæˆ–ç­‰äºå››ä¸ªå­—ç¬¦)çš„å¯¹æ‰‹æ–¹äº¤æ˜“ï¼Œæ—¨åœ¨å¸®åŠ©ç”¨æˆ·å…¨é¢äº†è§£è¢«å®¡è®¡å•ä½ä¸ä¸ªäººçš„èµ„é‡‘å¾€æ¥ï¼ŒååŠ©ç”¨æˆ·è¿›è¡Œå…³è”ä¸ªäººå’Œè‘£ç›‘é«˜çš„è¯†åˆ«ä¸æŠ«éœ²ã€ä¸ªäººäº¤æ˜“çš„åˆç†æ€§åˆ†æåŠé£é™©è¯†åˆ«ã€‚å¦‚ç”¨æˆ·æš‚æœªä¸Šä¼ å‘˜å·¥ä¸»æ¡£ï¼Œåˆ™æœ¬é¡µä»…å±•ç¤ºä¸å…¶ä»–ä¸ªäººå¯¹æ‰‹æ–¹äº¤æ˜“ã€‚",
      routine:"èšåˆå·¥å•†ä¿¡æ¯å¹¶ä¸äº¤æ˜“è§„æ¨¡è”åŠ¨æ ¡éªŒä¼ä¸šçœŸå®æ€§ä¸é£é™©ã€‚",
      statement:"ç”¨æˆ·å¯å¯¹æœ¬é¡µçš„å¤šç»´ç­›é€‰å™¨è®¾ç½®ç­›é€‰æ¡ä»¶ï¼Œç³»ç»Ÿå°†åœ¨å·²ä¸Šä¼ å¹¶æ‰§è¡Œåˆ†æçš„é“¶è¡Œæµæ°´ä¸­é€‰å‡ºç¬¦åˆç­›é€‰æ¡ä»¶çš„å¼‚å¸¸äº¤æ˜“æµæ°´ï¼Œå¹¶æ”¯æŒæµæ°´å¯¼å‡ºï¼Œæ—¨åœ¨å¸®åŠ©ç”¨æˆ·æ ¹æ®é¡¹ç›®éœ€æ±‚ï¼Œå…¨é¢ã€å¿«é€Ÿã€ç²¾å‡†åœ°ç­›é€‰å‡ºå¼‚å¸¸é“¶è¡Œæµæ°´ï¼ŒååŠ©ç”¨æˆ·è¿›ä¸€æ­¥æ‰§è¡Œå®¡è®¡ç¨‹åºã€‚",
      verify:"æœ¬é¡µæ±‡æ€»å·²ä¸Šä¼ å¹¶æ‰§è¡Œåˆ†æçš„ç”µå­é“¶è¡Œæµæ°´çš„æœŸåˆé‡‘é¢ã€å€Ÿæ–¹å‘ç”Ÿé¢ã€è´·æ–¹å‘ç”Ÿé¢åŠæœŸæœ«ä½™é¢ï¼Œå¹¶å°†å…¶ä¸ä¸Šä¼ çš„é“¶è¡Œç§‘ç›®æ€»è´¦/åˆ†è´¦å·ä½™é¢è¡¨è¿›è¡Œæ¯”å¯¹ï¼Œå¹¶å±•ç¤ºä¸¤è€…å·®å¼‚ï¼ŒååŠ©ç”¨æˆ·å®Œæˆé“¶è¡Œæµæ°´çš„å®Œæ•´æ€§æµ‹è¯•ã€‚"

    };
    
    function setTabIntro(key){
      const el = document.getElementById('tabIntro');
      if(!el) return;
      el.innerHTML = `
        <svg class="ti-icon" viewBox="0 0 24 24" fill="currentColor" aria-hidden="true">
          <path d="M12 2a10 10 0 1 0 .001 20.001A10 10 0 0 0 12 2Zm0 14a1 1 0 1 1 0 2 1 1 0 0 1 0-2Zm1-9h-2a1 1 0 0 0-1 1v1h2v6h2V8a2 2 0 0 0-2-2Z"/>
        </svg>
        <div><span class="ti-title">é¡µé¢è¯´æ˜ï¼š</span>${TAB_INTROS[key]||''}</div>`;
    }
    
    function moveInkbar(activeEl){
      const bar  = document.getElementById('inkbar');
      const wrap = document.getElementById('topTabs'); // æ»šåŠ¨å®¹å™¨
      if(!bar || !wrap || !activeEl) return;
    
      const rWrap = wrap.getBoundingClientRect();
      const rTab  = activeEl.getBoundingClientRect();
    
      const left = (rTab.left - rWrap.left) + wrap.scrollLeft;
      bar.style.left  = left + 'px';
      bar.style.width = rTab.width + 'px';
    }
    
    // ç»‘å®š
    function bindTabs(){
      document.querySelectorAll('#topTabs .tab').forEach(tab=>{
        tab.addEventListener('click', ()=>{
          document.querySelectorAll('#topTabs .tab').forEach(t=>t.classList.remove('active'));
          tab.classList.add('active');
    
          const key = tab.dataset.top;
          document.querySelectorAll('.tab-pane').forEach(p=>p.classList.remove('active'));
          document.getElementById('pane-'+key)?.classList.add('active');
    
          setTabIntro(key);
          // ä¸‹ä¸€å¸§å†è®¡ç®—ï¼Œé¿å…å¸ƒå±€è¿˜æœªå®Œæˆ
          requestAnimationFrame(()=>moveInkbar(tab));
        });
      });
    
      // æ¨ªå‘æ»šåŠ¨æ—¶ä¹Ÿè¦æ›´æ–° inkbar
      const wrap = document.getElementById('topTabs');
      wrap?.addEventListener('scroll', ()=>{
        const active = document.querySelector('#topTabs .tab.active');
        if(active) moveInkbar(active);
      }, { passive:true });
    }
    
    document.addEventListener('DOMContentLoaded', ()=>{
      bindTabs();
      const active = document.querySelector('#topTabs .tab.active') || document.querySelector('#topTabs .tab');
      if(active) {
        setTabIntro(active.dataset.top);
        // å­—ä½“/æ»šåŠ¨æ¡æ¸²æŸ“åå†å®šä½
        requestAnimationFrame(()=>moveInkbar(active));
      }
    });
    window.addEventListener('resize', ()=>{
      const active = document.querySelector('#topTabs .tab.active');
      if(active) moveInkbar(active);
    });
    
     //è´¦æˆ·æ€»è§ˆå±•å¼€æ”¶èµ·
    document.addEventListener("DOMContentLoaded",()=>{
      const scope=document.getElementById('checkScope');
      const btn=document.getElementById('btnToggleCheck');
      if(!scope||!btn)return;
      const setExpand=(expand)=>{
        scope.classList.toggle('expanded',expand);
        btn.classList.toggle('expanded',expand);
      };
      setExpand(false);
      btn.addEventListener('click',()=>{setExpand(!scope.classList.contains('expanded'));});
    });
     
    //ç¼ºå¤±åŒåè´¦æˆ·å…¬å¸ä¸‹æ‹‰
    document.addEventListener('DOMContentLoaded',()=>{
      const groups = document.querySelectorAll('#tblMissingSameName .group-row');
      groups.forEach(row=>{
        const btn = row.querySelector('.expand-btn');
        const groupId = row.dataset.group;
        // é»˜è®¤å±•å¼€ï¼šdetail-row å·²æ˜¾ç¤º
        btn.addEventListener('click',()=>{
          const expanded = btn.classList.toggle('expanded');
          document.querySelectorAll(`.group-${groupId}`).forEach(d=>{
            d.style.display = expanded ? 'table-row' : 'none';
          });
          btn.textContent = expanded ? 'â–¼' : 'â–¶';
        });
      });
    });

    // ===== èµ„é‡‘æµæ°´æ ¸æŸ¥åº•ç¨¿å¯¼å‡ºï¼šè‡ªæ£€ç‰ˆ JSï¼ˆä½œç”¨åŸŸå®‰å…¨ + å»¶è¿Ÿåˆå§‹åŒ–ï¼‰ =====
    (function initWP(){
  // è‹¥é¡µé¢è¿˜æ²¡å‡†å¤‡å¥½ï¼Œç­‰ DOM å†è·‘
  if (document.readyState === 'loading'){
    document.addEventListener('DOMContentLoaded', initWP, {once:true});
    return;
  }

  // ====== çŠ¶æ€ ======
  const WP = {
    isIPO: true,           // å¼¹çª—é‡Œæ”¹ï¼›é IPO åªé®â€œä¿¡æ¯æµ‹è¯•â€å¡ç‰‡
    market: "A",
    fyEnd: "12-31",
    materiality: "",

    step1Saved: false,
    directTest: "Y",
    risk: "",
    riskLabel: "",

    accounts: [
      { id:1, org:"æ’æ³½ç§‘æŠ€æœ‰é™å…¬å¸",    bankNo:"6222001001234567890", bank:"ä¸­å›½é“¶è¡ŒåŒ—äº¬åˆ†è¡Œ", total:238803000, tx:500, method:"", sample:null },
      { id:2, org:"ä¸­æ’å®ä¸šé›†å›¢æœ‰é™å…¬å¸", bankNo:"6217002209876543210", bank:"å»ºè®¾é“¶è¡Œä¸Šæµ·åˆ†è¡Œ", total:257803000, tx:500, method:"", sample:null },
      { id:3, org:"ä¸­ç§‘å¯å…ƒæŠ€æœ¯æœ‰é™å…¬å¸", bankNo:"6217990011223344556", bank:"æ‹›å•†é“¶è¡Œæ·±åœ³åˆ†è¡Œ", total:198123000, tx:360, method:"", sample:null },
      { id:4, org:"ååˆ›æ•°æ™ºæœ‰é™å…¬å¸",    bankNo:"6217009966332211008", bank:"å·¥å•†é“¶è¡Œæ­å·åˆ†è¡Œ", total:303560000, tx:820, method:"", sample:null },
      { id:5, org:"è¿œèˆªå›½é™…è´¸æ˜“æœ‰é™å…¬å¸", bankNo:"6212340099887766554", bank:"å†œä¸šé“¶è¡Œå—äº¬åˆ†è¡Œ", total:126990000, tx:210, method:"", sample:null },
      { id:6, org:"éœ–æ‚¦ç”µå­è‚¡ä»½æœ‰é™å…¬å¸", bankNo:"6215667788990011223", bank:"æµ¦å‘é“¶è¡Œä¸Šæµ·åˆ†è¡Œ", total:335500000, tx:980, method:"", sample:null }
    ]
  };

  const METHOD_TEXT = {
    "1":"1. é€šè¿‡é‚®ä»¶/Uç›˜ç­‰æä¾›ä¸‹è½½è®°å½•",
    "2":"2. æˆ‘æ–¹ä»é“¶è¡Œè·å–",
    "3":"3. ç”±SDSå¹³å°ä¸‹å‘æˆ–é‚®ä»¶æ¨é€",
    "4":"4. è¿œç¨‹åŒå½•è·å–"
  };
  const RISK_RATIO = { "é‡å¤§+":0.25, "é‡å¤§":0.15, "æé«˜":0.10, "åŸºç¡€":0.05 };

  // ====== å·¥å…· ======
  const $  = sel => document.querySelector(sel);
  const $all = sel => Array.from(document.querySelectorAll(sel));
  const fmt = n => (Number(n)||0).toLocaleString('zh-CN');
  const empty = v => v===null || v===undefined || v==="";

  // ====== é¡¶éƒ¨ä¿¡æ¯/é®ç½© ======
  function applyMask(){
    // åªé®â€œä¿¡æ¯æµ‹è¯•â€å¡ç‰‡
    $('#wpMaskInfo').style.display = WP.isIPO ? 'none' : 'flex';
  }
  function renderTopBar(){
    $("#wpKind").textContent = WP.isIPO ? "IPO" : "éIPO";
    $("#wpMarket").textContent = WP.market;
    applyMask();
  }

  // ç»Ÿä¸€è®¾ç½®çŠ¶æ€å¾½æ ‡ï¼šsel å¯ä¼ é€‰æ‹©å™¨æˆ–å…ƒç´ ï¼›cls ä¼  'st-green' | 'st-blue' | 'st-gray'
  function setBadge(sel, text, cls){
  const el = (typeof sel === 'string') ? document.querySelector(sel) : sel;
  if (!el) return;
  el.textContent = text;
  el.classList.remove('st-green','st-blue','st-gray','st-red');
  el.classList.add(cls);
}

  // ====== æ­¥éª¤çŠ¶æ€ ======
  function refreshStepStates(){
  // S1ï¼šå·²å®Œæˆ=ç»¿ï¼›æœªå®Œæˆ=çº¢
  setBadge('#s1State', WP.step1Saved ? 'å·²å®Œæˆ' : 'æœªå®Œæˆ',
           WP.step1Saved ? 'st-green' : 'st-red');

  // S2ï¼šå®Œæˆ S1 æ‰å¯ç”¨ï¼›å¯ç”¨=è“ï¼›ä¸å¯ç”¨=ç°
  const s2Disabled = !WP.step1Saved;
  document.querySelectorAll('input[name="wpDT"]').forEach(r => r.disabled = s2Disabled);
  setBadge('#s2State', s2Disabled ? 'ä¸å¯ç”¨' : 'å¯ç”¨',
           s2Disabled ? 'st-gray' : 'st-blue');
  document.getElementById('s2Hint').textContent = s2Disabled ? 'è¯·å…ˆå®Œæˆå¹¶ä¿å­˜ Step1' : 'å¯é€‰æ‹© Yes/No';

  // S3ï¼šS1 å®Œæˆä¸” DT=Y æ‰å¯ç”¨ï¼›å¯ç”¨=è“ï¼›ä¸å¯ç”¨=ç°
  const s3Enable = WP.step1Saved && WP.directTest === 'Y';
  document.getElementById('riskSel').disabled = !s3Enable;
  document.getElementById('btnCalc').disabled = !s3Enable;
  setBadge('#s3State', s3Enable ? 'å¯ç”¨' : 'ä¸å¯ç”¨',
           s3Enable ? 'st-blue' : 'st-gray');
}

  // ä¿å­˜æŒ‰é’®å¯ç”¨æ€§ï¼ˆæ‰€æœ‰è¡Œéƒ½é€‰äº†æ–¹å¼æ‰å¯ä¿å­˜ï¼‰
  function updateS1SaveBtn(){
    const anyEmpty = WP.accounts.some(a=> empty(a.method));
    $("#s1Save").disabled = anyEmpty || WP.step1Saved;
  }

  // ====== è¡¨æ ¼æ¸²æŸ“ ======
  function renderTable(){
    const tb = $("#wpTable tbody");
    tb.innerHTML = WP.accounts.map(a=>{
      const methodCell = WP.step1Saved
        ? (a.method ? METHOD_TEXT[a.method] : '<span class="muted">â€”</span>')
        : `<select class="mSel" data-id="${a.id}">
             <option value="">é€‰æ‹©æ–¹å¼â€¦</option>
             <option value="1" ${a.method==="1"?"selected":""}>${METHOD_TEXT["1"]}</option>
             <option value="2" ${a.method==="2"?"selected":""}>${METHOD_TEXT["2"]}</option>
             <option value="3" ${a.method==="3"?"selected":""}>${METHOD_TEXT["3"]}</option>
             <option value="4" ${a.method==="4"?"selected":""}>${METHOD_TEXT["4"]}</option>
           </select>`;

      const sampleCell = (a.sample!=null && WP.step1Saved && WP.directTest==="Y")
        ? `<span class="sample-edit" data-id="${a.id}" title="ç‚¹å‡»ä¿®æ”¹">${fmt(a.sample)}</span>`
        : (a.sample!=null ? `<span>${fmt(a.sample)}</span>` : '<span class="muted">â€”</span>');

      return `<tr>
        <td>${a.org}</td>
        <td>${a.bankNo}</td>
        <td>${a.bank}</td>
        <td class="num">${fmt(a.total)}</td>
        <td class="num">${fmt(a.tx)}</td>
        <td>${methodCell}</td>
        <td class="num">${sampleCell}</td>
      </tr>`;
    }).join("");

    // é€è¡Œé€‰æ‹©æ–¹å¼
    if (!WP.step1Saved){
      $all(".mSel").forEach(sel=>{
        sel.addEventListener("change",(e)=>{
          const id = Number(e.target.getAttribute("data-id"));
          const row = WP.accounts.find(x=>x.id===id);
          row.method = e.target.value;
          updateS1SaveBtn();
        });
      });
      updateS1SaveBtn();
    }

    // æ ·æœ¬é‡å°±åœ°ä¿®æ”¹ï¼ˆä»… S1 å®Œæˆ + DT=Yï¼‰
    $all(".sample-edit").forEach(span=>{
      span.addEventListener("click",()=>{
        const id = Number(span.getAttribute("data-id"));
        const row = WP.accounts.find(x=>x.id===id);
        const cur = row.sample ?? 0;
        span.outerHTML = `<input type="number" min="0" class="sample-input" data-id="${id}" value="${cur}" style="width:110px;">`;
        const input = document.querySelector(`.sample-input[data-id="${id}"]`);
        const commit = ()=>{
          const v = Number(input.value||0);
          row.sample = Math.max(0, Math.round(v));
          renderTable();
        };
        input.addEventListener("blur", commit);
        input.addEventListener("keydown", e=>{ if(e.key==="Enter") commit(); });
        input.focus(); input.select();
      });
    });
  }

  // ====== æ ·æœ¬é‡è®¡ç®— ======
  function computeSamples(){
    if (!WP.risk || !RISK_RATIO[WP.risk]) return;
    const ratio = RISK_RATIO[WP.risk];
    WP.accounts.forEach(a=> a.sample = Math.ceil(a.tx * ratio));
    $("#riskNote").textContent = "åŸºäºé£é™©ç­‰çº§ï¼š" + (WP.riskLabel || "â€”");
    renderTable();
  }

  function updateStep1Buttons(){
    const saveBtn = $("#s1Save");
    const modBtn  = $("#s1Modify");
    if (!saveBtn || !modBtn) return;
    if (WP.step1Saved){
      saveBtn.style.display = "none";
      modBtn.style.display  = "";
    } else {
      saveBtn.style.display = "";
      modBtn.style.display  = "none";
    }
  }

  // ====== Step1 ä¿å­˜ / ä¿®æ”¹ ======
  $("#s1Save") && $("#s1Save").addEventListener("click", ()=>{
    const anyEmpty = WP.accounts.some(a=> empty(a.method));
    if (anyEmpty){
      alert("ä»æœ‰è´¦å·æœªé€‰æ‹©â€œæ•°æ®è·å–æ–¹å¼â€ã€‚");
      return;
    }
    WP.step1Saved = true;

    // ä¿å­˜åé‡ç½® Step2/3ï¼ˆDirect Test å›åˆ° Yesï¼›é£é™©ä¸æ ·æœ¬é‡æ¸…ç©ºï¼‰
    WP.directTest = "Y";
    $all('input[name="wpDT"]').forEach(r=> r.checked = (r.value==="Y"));
    WP.risk = ""; 
    WP.riskLabel = "";
    WP.accounts.forEach(x=> x.sample = null);
    $("#riskSel").value = ""; 
    $("#riskNote").textContent = "åŸºäºé£é™©ç­‰çº§ï¼šâ€”";

    renderTable();
    refreshStepStates();
    updateStep1Buttons(); // â† åˆ‡åˆ°â€œä¿®æ”¹ Step1â€
  });

  $("#s1Modify") && $("#s1Modify").addEventListener("click", ()=>{
    // ä¿®æ”¹ Step1 â†’ å›åˆ°å¯ç¼–è¾‘ï¼Œå¹¶é‡ç½® Step2/3
    WP.step1Saved = false;
    WP.directTest = "Y";
    $all('input[name="wpDT"]').forEach(r=> r.checked = (r.value==="Y"));
    WP.risk = ""; 
    WP.riskLabel = "";
    WP.accounts.forEach(x=> x.sample = null);
    $("#riskSel").value = ""; 
    $("#riskNote").textContent = "åŸºäºé£é™©ç­‰çº§ï¼šâ€”";

    renderTable();
    refreshStepStates();
    updateStep1Buttons(); // â† åˆ‡å›â€œä¿å­˜ Step1â€
  });

  // ====== Step2 ======
  $all('input[name="wpDT"]').forEach(r=>{
    r.addEventListener("change", ()=>{
      WP.directTest = r.value;
      if (WP.directTest==="N"){
        WP.risk = ""; 
        WP.riskLabel = "";
        WP.accounts.forEach(a=> a.sample=null);
        $("#riskSel").value = "";
        $("#riskNote").textContent = "Direct Test = å¦ï¼Œæœ¬æ­¥éª¤ä¸é€‚ç”¨";
        renderTable();
      } else {
        $("#riskNote").textContent = "åŸºäºé£é™©ç­‰çº§ï¼šâ€”";
      }
      refreshStepStates();
    });
  });

  // ====== Step3 ======
  $("#riskSel") && $("#riskSel").addEventListener("change",(e)=>{
    const map = {"é‡å¤§+":"é‡è¦çš„+","é‡å¤§":"é‡è¦çš„","æé«˜":"æé«˜çš„","åŸºç¡€":"åŸºç¡€çš„"};
    WP.risk = e.target.value;
    WP.riskLabel = map[WP.risk] || "";
  });
  $("#btnCalc") && $("#btnCalc").addEventListener("click", ()=>{
    if (!WP.risk){ alert("è¯·å…ˆé€‰æ‹©é£é™©ç­‰çº§"); return; }
    computeSamples();
  });

  // å¯é€‰ï¼šåˆå§‹åŒ–æ—¶ä¹ŸåŒæ­¥ä¸€æ¬¡æŒ‰é’®æ˜¾éšï¼ˆæ”¾åœ¨ä½ çš„åˆå§‹åŒ–å°¾éƒ¨ï¼‰
  updateStep1Buttons();

  // ====== å·¥å…·æ ï¼šè‡ªå®šä¹‰è¡¨å¤´ / å¯¼å‡º / å¯¼å…¥ ======
  $("#btnCols").addEventListener("click", ()=> alert("è‡ªå®šä¹‰è¡¨å¤´ï¼šå ä½ï¼ˆæ¥ä½ ä»¬çš„è¡¨å¤´é…ç½®å¼¹çª—ï¼‰"));
  $("#btnExport").addEventListener("click", ()=>{
    if (!WP.isIPO){ alert("å½“å‰å·¥ä½œç°¿ç±»å‹ä¸ºé IPOï¼Œæœ¬åŠŸèƒ½ä¸é€‚ç”¨"); return; }
    const m = Number(WP.materiality||0);
    if (!m){ alert("è¯·å…ˆåœ¨å¼¹çª—ä¸­å¡«å†™é‡è¦æ€§æ°´å¹³ï¼ˆMaterialityï¼‰åå†å¯¼å‡ºåº•ç¨¿ã€‚"); return; }
    if (!WP.step1Saved){ alert("è¯·å…ˆå®Œæˆå¹¶ä¿å­˜ Step1ã€‚"); return; }
    alert("æ ¡éªŒé€šè¿‡ï¼šè§¦å‘å¯¼å‡ºï¼ˆå¯¹æ¥åç«¯æ¥å£ï¼‰");
  });
  $("#btnImport").addEventListener("change", (e)=>{
    const f = e.target.files?.[0];
    if (!f) return;
    alert("å·²é€‰æ‹©æ–‡ä»¶ï¼š" + f.name + "ï¼ˆè§£æå¯¼å…¥é€»è¾‘åœ¨æ­¤å¯¹æ¥ï¼‰");
    e.target.value = "";
  });

  // ====== é¡¶éƒ¨ âœ å¼¹çª— ======
  const modal = $("#wpModal");
  $("#wpEditMarket").addEventListener("click", ()=>{
    $all('input[name="wpIPO"]').forEach(r=> r.checked = (WP.isIPO ? r.value==="Y" : r.value==="N"));
    $("#wpMarketSel").value = WP.market;
    $("#wpFyEnd").value     = WP.fyEnd || "";
    $("#wpMateriality").value = WP.materiality || "";
    modal.style.display="flex";
  });
  $("#wpModalClose").addEventListener("click", ()=> modal.style.display="none");
  $("#wpModalCancel").addEventListener("click", ()=> modal.style.display="none");
  $("#wpModalOk").addEventListener("click", ()=>{
    WP.isIPO = (document.querySelector('input[name="wpIPO"]:checked')?.value || "Y")==="Y";
    WP.market = $("#wpMarketSel").value || "A";
    WP.fyEnd  = $("#wpFyEnd").value.trim();
    WP.materiality = $("#wpMateriality").value.trim();
    renderTopBar();
    modal.style.display="none";
  });

  // ====== åˆå§‹åŒ– ======
  renderTopBar();
  renderTable();
  refreshStepStates();
})();

    

      
    /* =============== ç»è¥å®è´¨ï¼šå›¾è¡¨ =============== */
    /* =============== ç»è¥å®è´¨ï¼šé€šç”¨ï¼ˆæ—¥ç²’åº¦ï¼‰ =============== */
    /* 1) ç”Ÿæˆ 2023-01-01 ~ 2024-12-31 çš„æ¯æ—¥æ—¥æœŸ */
    function genDays(start, end){
      const out = [];
      const s = new Date(start), e = new Date(end);
      for(let d=new Date(s); d<=e; d.setDate(d.getDate()+1)){
        out.push(d.toISOString().slice(0,10)); // YYYY-MM-DD
      }
      return out;
    }
    const days = genDays('2023-01-01','2024-12-31'); // å…± 731 å¤©ï¼ˆå«é—°å¹´ 2024ï¼‰
    
    /* 2) ç”Ÿæˆâ€œå°–å³°å‹â€æ—¥çº§ç¤ºä¾‹æ•°æ®ï¼ˆæ¥å…¥çœŸå®æ•°æ®æ—¶æ›¿æ¢ dataInDaily / dataOutDailyï¼‰ */
    function genSpikyDaily(len, baseMin, baseMax, spikeProb=0.06, spikeMin=6e6, spikeMax=8e7){
      return Array.from({length: len}, (_,i)=>{
        // å°é¢åŸºçº¿ + è½»å¾®æ³¢åŠ¨
        const base = baseMin + Math.random()*(baseMax-baseMin);
        const wave = Math.sin(i/13)*0.15*base + Math.cos(i/29)*0.1*base;
        let v = Math.max(0, base + wave);
    
        // ä»¥å°æ¦‚ç‡äº§ç”Ÿå¤§é¢å°–å³°
        if (Math.random() < spikeProb){
          v += spikeMin + Math.random()*(spikeMax-spikeMin);
        }
        return Math.round(v);
      });
    }
    const dataInDaily  = genSpikyDaily(days.length, 1.2e5, 9e5, 0.05, 2e6, 6e7);  // æ—¥æµå…¥
    const dataOutDaily = genSpikyDaily(days.length, 1.0e5, 8e5, 0.05, 2e6, 5e7);  // æ—¥æµå‡º
    
    /* 3) å·¥å…·å‡½æ•° */
    function sum(a){return a.reduce((s,x)=>s+x,0)}
    function avg(a){return a.length? (sum(a)/a.length):0}
    function fmt(n){return n.toLocaleString('zh-CN')}
    const fmtK = n => (n||0).toLocaleString('zh-CN');
    
    function pickByYearDays(year, arr){   // ä»æ—¥çº§æ•°ç»„ä¸­æˆªå–å¹´æ®µ
      if (year==='2023'){
        return arr.slice(0, 365);
      }
      if (year==='2024'){
        return arr.slice(365);
      }
      return arr; // 2023-2024
    }
    function pickDaysX(year){             // å–å¯¹åº”çš„ X è½´ï¼ˆæ—¥æœŸï¼‰
      if (year==='2023') return days.slice(0,365);
      if (year==='2024') return days.slice(365);
      return days;
    }
    
    const palette = {
      blue:  '#2152ff',
      blueA: 'rgba(33,82,255,0.14)',
      red:   '#E64646',
      redA:  'rgba(230,70,70,0.10)',
      axis:  '#cbd5e1',
      text:  '#334155',
      grid:  '#e9eef7'
    };
    function baseGrid(){ return { left: 56, right: 16, top: 28, bottom: 56, containLabel: true }; }
    function baseDataZoom(){
      return [
        { type:'inside', zoomOnMouseWheel:false, moveOnMouseWheel:true, moveOnMouseMove:true },
        { type:'slider', height:14, bottom:12, handleSize:0, borderColor:'#dfe6f2',
          backgroundColor:'#f1f5f9', fillerColor:'rgba(30,73,226,.12)' }
      ];
    }
    function baseAxis(xCats){
      return {
        xAxis: { type:'category', data:xCats, boundaryGap:false,
          axisLine:{lineStyle:{color:palette.axis}}, axisLabel:{color:palette.text, margin:10},
          axisTick:{show:false}, splitLine:{show:false}
        },
        yAxis: { type:'value', axisLine:{show:false},
          axisLabel:{color:palette.text, formatter: v=>fmtK(v)},
          splitLine:{show:true, lineStyle:{color:palette.grid}}
        }
      };
    }
    function baseTooltip(formatter){
      return {
        trigger:'axis', confine:true, className:'echarts-tip', borderWidth:0,
        backgroundColor:'transparent', padding:0,
        axisPointer:{type:'line', lineStyle:{color:'#94a3b8', type:'dashed'}},
        formatter
      };
    }
    function makeLineChart(domId, opt){
      const chart = echarts.init(document.getElementById(domId));
      chart.setOption(opt, true);
      window.addEventListener('resize', ()=>chart.resize());
      return chart;
    }
    
    /* ========= èµ„é‡‘æµæ°´ä½™é¢ï¼šå•è“çº¿ï¼ˆé˜¶æ¢¯ï¼‰+ è§’æ ‡ + ç¼©æ”¾ ========= */
    function renderBalance(){
      const y    = document.getElementById('yearBalance')?.value || '2023-2024';
      const xSel = pickDaysX(y);
    
      // ç”¨â€œæ—¥æµå…¥-æ—¥æµå‡ºâ€çš„ç´¯è®¡è¿‘ä¼¼ä½™é¢ï¼ˆ>0 çº¦æŸï¼‰ï¼›å¦‚æœ‰çœŸå®ä½™é¢ï¼Œæ›¿æ¢ balanceData/xSel å³å¯
      const inSel  = pickByYearDays(y, dataInDaily);
      const outSel = pickByYearDays(y, dataOutDaily);
      let acc = 0;
      const balanceData = inSel.map((v,i)=>{
        acc = Math.max(0, acc + v - (outSel[i] || 0));   // â† ä¸å…è®¸ä¸ºè´Ÿ
        return acc;
      });
      const lastBal = balanceData.length ? balanceData[balanceData.length-1] : 0;
    
      makeLineChart('chart-balance', {
        color: [palette.blue],                                  // å›ºå®šè°ƒè‰²
        grid:  baseGrid(),
        ...baseAxis(xSel),
        dataZoom: baseDataZoom(),
        tooltip: baseTooltip(p=>{
          const v = p[0]?.value ?? 0;
          return `
            <div class="tip-card">
              <div class="t">${p[0].axisValue}</div>
              <div class="tip-row"><span class="tip-k">ä½™é¢</span><span class="tip-v">Â¥ ${fmtK(v)}</span></div>
            </div>`;
        }),
        // å³ä¸Šè§’â€œä½™é¢è§’æ ‡â€
        /* âœ… è¿™é‡Œæ–°å¢ legend */
        legend: {
          top: 6,
          right: 10,
          icon: 'roundRect',
          itemWidth: 12,
          itemHeight: 12,
          textStyle:{ color:'#475569' }
        },
        xAxis: { ...baseAxis(xSel).xAxis, boundaryGap: false },
        yAxis: { ...baseAxis(xSel).yAxis, min: 0 },             // y è½´ä» 0 å¼€å§‹
        series: [{
          name:'ä½™é¢',
          type:'line',
          step: 'middle',                                       // â† é˜¶æ¢¯çº¿ï¼Œæ›´åƒä½™é¢å˜åŒ–
          smooth:false,
          sampling:'lttb',
          showSymbol:false,
          connectNulls:true,
          lineStyle:{ width: 2.4, color: palette.blue },
          areaStyle:{
            color: new echarts.graphic.LinearGradient(0,0,0,1,[
              {offset:0, color: palette.blueA},
              {offset:1, color:'rgba(33,82,255,0)'}
            ])
          },
          data: balanceData
        }]
      });
    }
    
    /* ========= æµå…¥æµå‡ºè¶‹åŠ¿ï¼šè“/çº¢åŒçº¿ + ç¼©æ”¾ï¼ˆæ— é¢ç§¯ï¼‰ ========= */
    function renderIO(){
      const y    = document.getElementById('yearIO')?.value || '2023-2024';
      const xSel = pickDaysX(y);
      const inSel  = pickByYearDays(y, dataInDaily);
      const outSel = pickByYearDays(y, dataOutDaily);
    
      // KPIï¼ˆæ²¿ç”¨ï¼‰
      const $ = id => document.getElementById(id);
      if ($('io_in_sum'))  $('io_in_sum').textContent  = 'Â¥' + fmt(sum(inSel));
      if ($('io_in_avg'))  $('io_in_avg').textContent  = 'Â¥' + fmt(Math.round(avg(inSel)));
      if ($('io_out_sum')) $('io_out_sum').textContent = 'Â¥' + fmt(sum(outSel));
      if ($('io_out_avg')) $('io_out_avg').textContent = 'Â¥' + fmt(Math.round(avg(outSel)));
    
      makeLineChart('chart-io', {
        color: [palette.blue, palette.red],                     // â† å¼ºåˆ¶â€œæµå…¥è“ / æµå‡ºçº¢â€
        grid:  baseGrid(),
        ...baseAxis(xSel),
        legend:{ top:6, right:8, icon:'roundRect', itemWidth:10, itemHeight:10,
          textStyle:{ color: palette.text } },
        dataZoom: baseDataZoom(),
        tooltip: baseTooltip(params=>{
          const pin  = params.find(p=>p.seriesName==='æµå…¥');
          const pout = params.find(p=>p.seriesName==='æµå‡º');
          return `
            <div class="tip-card">
              <div class="t">${params[0].axisValue}</div>
              <div class="tip-row"><span class="tip-k">æµå…¥</span><span class="tip-v" style="color:${palette.blue}">Â¥ ${fmtK(pin?.value||0)}</span></div>
              <div class="tip-row"><span class="tip-k">æµå‡º</span><span class="tip-v" style="color:${palette.red}">Â¥ ${fmtK(pout?.value||0)}</span></div>
            </div>`;
        }),
        xAxis: { ...baseAxis(xSel).xAxis, boundaryGap: false },
        yAxis: { ...baseAxis(xSel).yAxis, min: 0 },             // ä» 0 èµ·ï¼Œæ›´ç›´è§‚
        series: [
          { name:'æµå…¥', type:'line', smooth:false, sampling:'lttb', showSymbol:false, connectNulls:true,
            lineStyle:{ width:2, color: palette.blue }, data: inSel },
          { name:'æµå‡º', type:'line', smooth:false, sampling:'lttb', showSymbol:false, connectNulls:true,
            lineStyle:{ width:2, color: palette.red  }, data: outSel }
        ]
      });
    }
    
    /* é¦–æ¬¡æ¸²æŸ“ & è”åŠ¨ï¼ˆä¿æŒä¸å˜ï¼‰ */
    renderBalance();
    renderIO();
    document.getElementById('yearBalance')?.addEventListener('change', renderBalance);
    document.getElementById('yearIO')?.addEventListener('change', renderIO);


    /* ===== ä¾èµ–ä¸å ä½ï¼ˆè‹¥ä½ é¡¹ç›®é‡Œå·²æœ‰ months / dataIn / dataOut / ez å°±ä¼šè‡ªåŠ¨å¤ç”¨ï¼‰ ===== */
    const C_BLUE='#2152ff', C_RED='#E64646';
    if(typeof window.months==='undefined'){
      window.months=[...Array.from({length:12},(_,i)=>`2023-${String(i+1).padStart(2,'0')}`),
                     ...Array.from({length:12},(_,i)=>`2024-${String(i+1).padStart(2,'0')}`)];
    }
    if(typeof window.dataIn==='undefined' || typeof window.dataOut==='undefined'){
      window.dataIn = months.map(()=>Math.round(2e6+Math.random()*8e6));
      window.dataOut= months.map(()=>Math.round(1.5e6+Math.random()*7e6));
    }
    if(typeof window.ez==='undefined'){
      window.ez=function(domId,opt){const el=document.getElementById(domId);
        const inst=echarts.getInstanceByDom(el)||echarts.init(el);inst.setOption(opt,true);return inst;}
    }
    const yFmt=v=>(v||0).toLocaleString('zh-CN');
    
    /* ===== 7 ç±»å æ¯”ï¼ˆå¯æ¥çœŸå®å€¼ï¼‰ ===== */
    const categories=['å…¨ä½“å¯¹æ‰‹æ–¹','å·²çŸ¥å…³è”æ–¹','ä¾›åº”å•†','å®¢æˆ·','å‘˜å·¥','å…¶ä»–','ä¸ªäºº'];
    function renderCompCats(){
      const nums=[100,28,0,0,0,0,0]; // TODO: æ›¿æ¢æˆä½ çš„çœŸå®ç»Ÿè®¡
      const total=nums.reduce((s,x)=>s+x,0)||1;
      const wrap=document.getElementById('compCats'); if(!wrap) return;
      wrap.innerHTML=categories.map((n,i)=>`
        <div class="cat">
          <div class="name">${n}</div>
          <div class="pct">${(nums[i]/total*100).toFixed(2)}%</div>
        </div>`).join('');
    }
    
    /* ===== æœˆåº¦åˆ†å¸ƒï¼ˆäº¤æ˜“æ€»é¢ / æµå…¥æ–¹ / æµå‡ºæ–¹ï¼‰â€”â€”å›¾äºŒæ ·å¼è“çº¢æŸ±çŠ¶ ===== */
    function renderCompCharts(mode='total'){
      if(!document.getElementById('chart-comp-monthly')) return;
      let series=[];
      if(mode==='in'){
        series=[{name:'æµå…¥',type:'bar',barWidth:16,itemStyle:{color:C_BLUE},data:dataIn}];
      }else if(mode==='out'){
        series=[{name:'æµå‡º',type:'bar',barWidth:16,itemStyle:{color:C_RED},data:dataOut}];
      }else{
        series=[
          {name:'æµå…¥',type:'bar',barWidth:16,itemStyle:{color:C_BLUE},data:dataIn},
          {name:'æµå‡º',type:'bar',barWidth:16,itemStyle:{color:C_RED}, data:dataOut}
        ];
      }
      ez('chart-comp-monthly',{
        grid:{left:56,right:16,top:30,bottom:40,containLabel:true},
        color:[C_BLUE,C_RED],
        legend:{top:6,right:8,icon:'roundRect',itemWidth:10,itemHeight:10},
        tooltip:{trigger:'axis',axisPointer:{type:'shadow'},valueFormatter:yFmt},
        xAxis:{type:'category',data:months,axisTick:{show:false}},
        yAxis:{type:'value',axisTick:{show:false},splitLine:{lineStyle:{color:'#eef2f7'}},axisLabel:{formatter:yFmt}},
        series
      });
    
      // â€”â€” Top20ï¼ˆå³ä¾§åˆ—è¡¨ï¼Œå›¾ä¸€é£æ ¼ï¼‰ã€‚è¿™é‡Œæ¼”ç¤ºç”¨å ä½ï¼Œæ¥ä½ çœŸå®èšåˆå³å¯ã€‚
      const list = Array.from({length:10},(_,i)=>({
        name:['abcæœ‰é™å…¬å¸','a****æ–°èƒ½æºæ±½è½¦æŠ€æœ¯æœ‰é™å…¬å¸','w**è‚¡ä»½æœ‰é™å…¬å¸','b****æ±½è½¦éƒ¨ä»¶æœ‰é™å…¬å¸',
              'k****æ±½è½¦ç”µå­é›¶éƒ¨ä»¶æœ‰é™å…¬å¸','o3****é‡‘å±å¡‘æ–™åˆ¶å“å‚','p****é›†å›¢è‚¡ä»½æœ‰é™å…¬å¸å‹Ÿé›†åˆèµ„ä¸“æˆ·',
              'h****motivesystemsholdingco.ltd','l****æ±½è½¦é›¶éƒ¨ä»¶æœ‰é™å…¬å¸','x****ææ–™ç§‘æŠ€æœ‰é™å…¬å¸'][i] || `å¯¹æ‰‹æ–¹ ${i+1}`,
        amount:Math.round(2e7+Math.random()*5e8)
      })).sort((a,b)=>b.amount-a.amount);
      renderTop20Panel(list);
    }
    
    // ç»Ÿä¸€é‡‘é¢æ ¼å¼
    function fmtCNY(n){ return `Â¥${(Number(n)||0).toLocaleString('zh-CN')}`; }
    
    /* ===== Top20 åˆ—è¡¨æ¸²æŸ“ï¼šæ ‡é¢˜ = â€œTop20 äº¤æ˜“æ€»é¢â€ ===== */
    function renderTop20Panel(list){
      const box = document.getElementById('chart-comp-top20');
      if(!box) return;
    
      // å¦‚æœè¿™ä¸ªå®¹å™¨ä¹‹å‰è¢« ECharts ä½¿ç”¨è¿‡ï¼Œå…ˆé‡Šæ”¾ï¼Œé¿å…è¦†ç›–
      const old = echarts.getInstanceByDom(box);
      if(old) old.dispose();
    
      // å…è®¸ä¼ ç©ºä½¿ç”¨å¤–éƒ¨å ä½
      list = Array.isArray(list) ? list : (window.__top20List || []);
      const total = list.reduce((s,x)=>s + (Number(x.amount)||0), 0);
    
      box.innerHTML = `
        <div class="top20-card">
          <div class="top20-head">
            <div>
              <span class="top20-title">Top20 äº¤æ˜“æ€»é¢</span>
              <span class="top20-sub">å æ¯”å¯æ›¿æ¢ä¸ºçœŸå®å€¼</span>
            </div>
            <div class="top20-total">${fmtCNY(total)}</div>
          </div>
    
          <div class="top20-list">
            ${list.map((row,idx)=>`
              <div class="top20-row">
                <div class="rank-badge ${idx===0?'top1':idx===1?'top2':idx===2?'top3':''}">${idx+1}</div>
                <div class="cp-name" title="${row.name}">${row.name}</div>
                <div class="cp-amt">${fmtCNY(row.amount)}</div>
              </div>
            `).join('')}
          </div>
        </div>`;
    }
    
    /* ===== Tab åˆ‡æ¢ ===== */
    document.getElementById('compTabs')?.addEventListener('click',e=>{
      const tab=e.target.closest('.tab'); if(!tab) return;
      document.querySelectorAll('#compTabs .tab').forEach(t=>t.classList.remove('active'));
      tab.classList.add('active');
      renderCompCharts(tab.dataset.mode); // total | in | out
    });
    
    /* ===== åˆå§‹åŒ– ===== */
    renderCompCats();
    renderCompCharts('total');


    
    /* =============== ä½ åŸæœ‰çš„è¡¨æ ¼åˆ†é¡µä¸å¡«å……ï¼ˆä¸æ”¹åŠ¨ç»“æ„ï¼‰ =============== */
    let currentPageDeal=1, currentPageCorp=1, currentRoutinePage=1;
    const pageSize=10;
    let bizFilteredList = companies.slice(); // ç»è¥å®è´¨åŒºåŸŸå½“å‰ç­›é€‰ç»“æœ
    
    function paginate(arr,page){return arr.slice((page-1)*pageSize,page*pageSize);}
    function renderPagination(eleId,total,current,handler){
      const pages=Math.max(1,Math.ceil(total/pageSize));
      let html='';
      for(let i=1;i<=pages;i++){
        html+=`<button class="btn ${i===current?'btn-primary':''}" onclick="${handler}(${i})">${i}</button>`;
      }
      document.getElementById(eleId).innerHTML=html;
    }
    
    function toggleSb(li){
      li.classList.toggle('open');
      const submenu = li.querySelector('.sb-submenu');
      if (submenu) submenu.classList.toggle('show');
    }
    
    /* ä¸¤å¼ è¡¨ */
    function fillBizTables(list=bizFilteredList){
      const totalSum = list.reduce((s,x)=>s+x.total,0)||1;
    
      // äº¤æ˜“æ˜ç»†
      const dealPage=paginate(list,currentPageDeal);
      document.querySelector('#tblDeal tbody').innerHTML = dealPage.map(r=>`
        <tr>
          <td>${r.name}</td>
          <td>${r.ctype}</td><td>${r.relation}</td>
          <td>${r.blacklist}</td>
          <td style="color:#2563eb">${fmtWan(r.inflow)}</td>
          <td style="color:#ef4444">${fmtWan(r.outflow)}</td>
          <td><b>${fmtWan(r.total)}</b></td>
          <td>${(r.total/totalSum*100).toFixed(2)}%</td>
          <td>${r.txCnt}</td>
          <td>${r.sales}</td><td>${r.purchase}</td><td>${r.job}</td>
          <td>${r.note}</td>
          <td><button class="btn">æŸ¥çœ‹è¯¦æƒ…</button></td>
        </tr>`).join('');
      renderPagination('pagination-deal',list.length,currentPageDeal,'gotoDeal');
    
      // å·¥å•†ä¿¡æ¯
      const corpPage=paginate(list,currentPageCorp);
      document.querySelector('#tblCorp tbody').innerHTML = corpPage.map(r=>`
        <tr>
          <td>${r.name}</td><td><b>${fmtWan(r.total)}</b></td>
          <td>${r.foundedDate}</td><td>${r.startDate}</td><td>${r.endDate}</td>
          <td>${r.term}</td><td>${r.status}</td><td>${r.capital}</td>
          <td>${r.industry}</td><td>${r.scope}</td><td>${r.addr}</td>
          <td>${r.contact}</td><td>${r.directors}</td>
        </tr>`).join('');
      renderPagination('pagination-corp',list.length,currentPageCorp,'gotoCorp');
    }
    function gotoDeal(p){currentPageDeal=p;fillBizTables()}
    function gotoCorp(p){currentPageCorp=p;fillBizTables()}
    
    // ================== åˆ·æ–°åè®°å¿†ï¼šé¡¶å±‚ Tab & å­è¡¨ Tab ==================
    /* ================== åˆ·æ–°è®°å¿†çš„ key ================== */
    const STORAGE_KEYS = {
      topTab:  'topTab.active',   // é¡¶éƒ¨ï¼šaccount/biz/...
      listTab: 'biz.listTab'      // å­è¡¨ï¼šdeal/corp
    };
    
    /* ================== æƒ°æ€§æ¸²æŸ“å¼€å…³ ================== */
    let __dealInited = false;
    let __corpInited = false;
    
    /* è‹¥å¤–éƒ¨å·²å‡†å¤‡å¥½ companies / bizFilteredListï¼Œåˆ™å¤ç”¨ */
    window.bizFilteredList = window.bizFilteredList || (window.companies ? companies.slice() : []);
    
    /* ================== æ¸²æŸ“å‡½æ•°ï¼ˆå¤ç”¨ä½ è‡ªå·±çš„ï¼‰ ================== */
    function renderDealOnce(){
      if (__dealInited) return;
      __dealInited = true;
      if (typeof fillBizTables === 'function') fillBizTables();
    }
    function renderCorpOnce(){
      if (__corpInited) return;
      __corpInited = true;
      if (typeof fillBizTables === 'function') fillBizTables();
    }
    
    /* ================== inkbar åŒæ­¥ï¼ˆå¯é€‰ï¼‰ ================== */
    function updateInkbar(){
      const bar  = document.getElementById('inkbar');
      const tabs = document.getElementById('topTabs');
      if (!bar || !tabs) return;
      const act = tabs.querySelector('.tab.active');
      if (!act) return;
      const rb = tabs.getBoundingClientRect();
      const ra = act.getBoundingClientRect();
      bar.style.left  = (ra.left - rb.left + tabs.scrollLeft) + 'px';
      bar.style.width = ra.width + 'px';
    }
    
    /* ================== å­è¡¨åˆ‡æ¢ï¼ˆç»Ÿä¸€å…¥å£ï¼‰ ================== */
    function switchSubTable(view){ // 'deal' | 'corp'
      const showDeal = view === 'deal';
      const dealWrap = document.getElementById('tbl-deal-wrap');
      const corpWrap = document.getElementById('tbl-corp-wrap');
    
      dealWrap?.classList.toggle('hide', !showDeal);
      corpWrap?.classList.toggle('hide',  showDeal);
    
      // è®°å¿†å½“å‰å­è¡¨
      sessionStorage.setItem(STORAGE_KEYS.listTab, view);
    
      // æƒ°æ€§æ¸²æŸ“ä¸€æ¬¡ï¼ˆä¸é‡ç½®ç­›é€‰ï¼‰
      if (showDeal) renderDealOnce(); else renderCorpOnce();
    
      // åŒæ­¥è€ tabsï¼ˆ#listTabsï¼‰
      const listTabs = document.getElementById('listTabs');
      if (listTabs){
        listTabs.querySelectorAll('.table-tab').forEach(x=>{
          x.classList.toggle('active', x.dataset.view === view);
        });
      }
    
      // åŒæ­¥æ–°åˆ‡æ¢æ¡ï¼ˆ#tblSwitcherï¼‰
      const switcher = document.getElementById('tblSwitcher');
      if (switcher){
        switcher.querySelectorAll('.opt').forEach(x=>{
          const on = x.dataset.view === view;
          x.classList.toggle('active', on);
          x.setAttribute('aria-selected', on ? 'true' : 'false');
        });
      }
    
      // è¡¨æ ¼å¯èƒ½éœ€è¦é‡ç®—åˆ—å®½
      setTimeout(()=>window.dispatchEvent(new Event('resize')), 0);
    }
    
    /* ================== ç»è¥å®è´¨é¡µæ˜¾ç¤ºï¼šæŒ‰è®°å¿†æ¢å¤å­è¡¨å¹¶ç«‹å³æ¸²æŸ“ ================== */
    function onBizPageShown(){
      const saved = sessionStorage.getItem(STORAGE_KEYS.listTab);
      switchSubTable(saved === 'corp' ? 'corp' : 'deal');  // é»˜è®¤ deal
    }
    
    /* ================== æ—§çš„é¡¶éƒ¨å­è¡¨ Tabï¼ˆä¿ç•™å…¼å®¹ï¼‰ ================== */
    (function initListTabs(){
      const listTabs = document.getElementById('listTabs');
      if (!listTabs) return;
      listTabs.addEventListener('click', e=>{
        const tab = e.target.closest('.table-tab'); if(!tab) return;
        switchSubTable(tab.dataset.view === 'corp' ? 'corp' : 'deal');
      });
    })();
    
    /* ================== æ–°çš„å³ä¾§â€œå·¦å³åˆ‡æ¢æ¡â€ï¼ˆä¿ç•™å…¼å®¹ï¼‰ ================== */
    (function initSwitcher(){
      const wrap = document.getElementById('tblSwitcher');
      if (!wrap) return;
      wrap.addEventListener('click', e=>{
        const btn = e.target.closest('.opt'); if(!btn) return;
    
        // å¦‚éœ€åˆ‡æ¢æ—¶é‡ç½®ç­›é€‰ï¼Œæ”¾å¼€ä¸‹é¢ä¸¤è¡Œï¼›å¦åˆ™ä¿æŒå½“å‰ç­›é€‰çŠ¶æ€
        // const sel = document.getElementById('fType'); if (sel) sel.selectedIndex = 0;
        // window.bizFilteredList = (window.companies || []).slice();
    
        // ä½ è‹¥å¸Œæœ›åˆ‡æ¢æ—¶å¼ºåˆ¶åˆ·æ–°ï¼Œä¹Ÿå¯ä¿ç•™è¿™å¥ï¼ˆå¯åˆ ï¼‰
        if (typeof window.fillBizTables === 'function') window.fillBizTables();
    
        switchSubTable(btn.dataset.view === 'corp' ? 'corp' : 'deal');
      });
    })();
    
    /* ================== é¡¶éƒ¨é¡µé¢åˆ‡æ¢ï¼ˆå¸¦è®°å¿† + é¦–æ¬¡æ¢å¤ï¼‰ ================== */
    (function initTopTabs(){
      const topTabs = document.getElementById('topTabs');
      if (!topTabs) return;
    
      function showPane(key){
      // çº¦å®šï¼štab é¡µçš„ id ç»Ÿä¸€æ˜¯ pane-xxxï¼Œå’Œ data-top="xxx" å¯¹åº”
      document.querySelectorAll('.tab-pane').forEach(pane => {
        const paneKey = pane.id.replace(/^pane-/, ''); // ä¾‹å¦‚ pane-account -> account
        pane.classList.toggle('hide', paneKey !== key);
      });
}
    
      function activateTopTab(key){
        const target = topTabs.querySelector(`.tab[data-top="${key}"]`);
        if (!target) return;
    
        // å¤–è§‚æ¿€æ´»
        topTabs.querySelectorAll('.tab').forEach(t=>t.classList.remove('active'));
        target.classList.add('active');
    
        // æ˜¾éš pane
        showPane(key);

        // âœ… è‡ªå®šä¹‰æ˜¾ç¤ºç­›é€‰æ¡
        const FILTER_PAGES = ['biz', 'relation','personalâ€”transaction'];

        if (bizFilterBar) {
          bizFilterBar.classList.toggle('hide', !FILTER_PAGES.includes(key));
        }


    
        // è®°å¿†é¡¶å±‚ tab & inkbar
        sessionStorage.setItem(STORAGE_KEYS.topTab, key);
        updateInkbar();
    
        // è¿›å…¥ç»è¥å®è´¨æ—¶ï¼Œç«‹åˆ»æ¢å¤å­è¡¨å¹¶æ¸²æŸ“
        if (key === 'biz') onBizPageShown();
      }
    
      // ç‚¹å‡»åˆ‡æ¢
      topTabs.addEventListener('click', e=>{
        const t = e.target.closest('.tab'); if(!t) return;
        const key = t.dataset.top; if(!key) return;
        activateTopTab(key);
      });
    
      // âœ… é¦–æ¬¡æ¢å¤ï¼ˆåˆ·æ–°åå…³é”®ä¸€æ­¥ï¼‰
      const savedKey  = sessionStorage.getItem(STORAGE_KEYS.topTab);
      const domActive = topTabs.querySelector('.tab.active');
      const initialKey = savedKey || domActive?.dataset.top || 'biz';
      activateTopTab(initialKey);
    
      // åˆæ¬¡å¸ƒå±€ååŒæ­¥ä¸€æ¬¡ inkbar
      setTimeout(updateInkbar, 0);
    })();
    
    /* ================== çª—å£å°ºå¯¸å˜åŒ–æ—¶åŒæ­¥ inkbar ================== */
    window.addEventListener('resize', updateInkbar);
    
    /* ================== å…­ä¸ªæ“ä½œæŒ‰é’®ï¼šå ä½ç›‘å¬ï¼ˆæ›¿æ¢ä¸ºçœŸå®é€»è¾‘å³å¯ï¼‰ ================== */
    document.getElementById('btnQuick')  ?.addEventListener('click', ()=>console.log('å¿«é€ŸæŸ¥çœ‹å‹¾é€‰ç»“æœ'));
    document.getElementById('btnReset')  ?.addEventListener('click', ()=>console.log('é‡ç½®ç­›é€‰'));
    document.getElementById('btnHead')   ?.addEventListener('click', ()=>console.log('è‡ªå®šä¹‰è¡¨å¤´'));
    document.getElementById('btnDist')   ?.addEventListener('click', ()=>console.log('æµå…¥æµå‡ºåˆ†å¸ƒ'));
    document.getElementById('btnAnalyze')?.addEventListener('click', ()=>console.log('ç”Ÿæˆåˆ†æç»“æœ'));
    document.getElementById('btnFlow')   ?.addEventListener('click', ()=>console.log('ç”Ÿæˆæµæ°´'));
    
    
    /* å¹´åº¦/ç±»å‹ç­›é€‰è”åŠ¨ */
    document.getElementById('yearBalance')?.addEventListener('change',renderBalance);
    document.getElementById('yearIO')?.addEventListener('change',renderIO);
    document.getElementById('ctypeIO')?.addEventListener('change',renderIO);
    
    /* é¦–æ¬¡æ¸²æŸ“ */
    renderBalance();
    renderIO();
    renderCompCats();
    renderCompCharts();
    fillBizTables

    // â€”â€” é€ å‡æ•°é‡ï¼šå¦‚æœä½ æœ‰çœŸå®ç»Ÿè®¡ï¼Œè¿™é‡Œæ›¿æ¢å³å¯ â€”â€” //
    function updateFraudCount(n){
      var el = document.getElementById('fraudCount');
      if (el) el.textContent = Number(n||0);
    }
    // é¦–æ¬¡ç»™ä¸ªé»˜è®¤å€¼ï¼ˆ0ï¼‰ï¼›ä½ å®é™…æ¸²æŸ“å®Œåˆ—è¡¨åå¯å†æ¬¡è°ƒç”¨æ›´æ–°
    updateFraudCount(0);
    
    // â€”â€” ç‚¹å‡»â€œç¬¬ä¸‰æ–¹é…åˆé€ å‡åå•.xlsxâ€ï¼šä½ å¯ä»¥æ”¹æˆå®é™…ä¸‹è½½/é¢„è§ˆé€»è¾‘ â€”â€” //
    document.getElementById('fraudListFile')?.addEventListener('click', ()=>{
      // TODO: æ¢æˆçœŸå®è¡Œä¸ºï¼ˆä¾‹å¦‚æ‰“å¼€é“¾æ¥/è°ƒç”¨ä¸‹è½½æ¥å£ï¼‰
      // window.open('/files/ç¬¬ä¸‰æ–¹é…åˆé€ å‡åå•.xlsx', '_blank');
      console.log('æ‰“å¼€ï¼šç¬¬ä¸‰æ–¹é…åˆé€ å‡åå•.xlsx');
    });
    
    // â€”â€” å¦‚æœåˆ‡æ¢â€œäº¤æ˜“æ˜ç»†/å·¥å•†ä¿¡æ¯â€æˆ–ç­›é€‰åéœ€è¦æ›´æ–°æ•°é‡ï¼Œè°ƒç”¨ updateFraudCount(x) å³å¯ â€”â€” //
    // ä¾‹å¦‚ï¼šåœ¨ fillBizTables() æœ«å°¾ï¼š updateFraudCount(calculatedCount);

    /* ===================== å¢å¼ºç‰ˆ ezï¼šå¤§æ•°æ®é‡ç¨³æ€æ¸²æŸ“ ===================== */
    function ez(domId, option){
      const el = document.getElementById(domId);
      if (!el) return null;
    
      // 1) åˆå§‹åŒ–ï¼ˆcanvas + useDirtyRect æå‡åˆ·æ–°æ•ˆç‡ï¼‰
      const chart = echarts.getInstanceByDom(el) ||
                    echarts.init(el, null, { renderer: 'canvas', useDirtyRect: true });
    
      // 2) æ€§èƒ½ä¸å¥å£®æ€§ç¼ºçœé¡¹ï¼ˆä¸è¦†ç›–ä½ å·²è®¾ç½®çš„åŒåé¡¹ï¼‰
      //    - é‡‡æ · lttbï¼šé™ä½ 700+ ç‚¹å¯¹ DOM çš„å‹åŠ›ä¸”ä¿æŒå½¢çŠ¶
      //    - progressive å¤§å›¾ä¼˜åŒ–ï¼›large æ¨¡å¼
      //    - å…³é—­åŠ¨ç”»ï¼›é¿å…é¦–å¸§å¡/ç™½å±
      //    - è½´æ ‡ç­¾è‡ªåŠ¨é¿è®©ï¼›dataZoom åŠ  throttle é˜²æŠ–
      const enriched = (() => {
        // xAxis / yAxis ç»Ÿä¸€æˆæ•°ç»„å¤„ç†
        const toArr = v => Array.isArray(v) ? v : (v ? [v] : []);
        const xAxes = toArr(option.xAxis).map(ax => ({
          boundaryGap: ax?.boundaryGap ?? false,
          axisTick: { show: false, ...(ax?.axisTick||{}) },
          axisLabel: { hideOverlap: true, interval: 'auto', ...(ax?.axisLabel||{}) },
          ...ax
        }));
        const yAxes = toArr(option.yAxis).map(ay => ({
          min: ay?.min ?? 0, // ä½™é¢/æ”¶æ”¯ä¸€èˆ¬ä» 0 èµ·ï¼Œæ›´ç›´è§‚ï¼›ä½ å·²è‡ªè®¾åˆ™ä¸æ”¹
          axisTick: { show: false, ...(ay?.axisTick||{}) },
          splitLine: { lineStyle:{ color:'#eef2f7' }, ...(ay?.splitLine||{}) },
          ...ay
        }));
    
        const series = (option.series || []).map(s => ({
          showSymbol: false,
          symbol: 'circle',
          symbolSize: 3,
          smooth: false,                 // ä¸è¦è¿‡åº¦å¹³æ»‘ï¼Œä¿æŒâ€œæŠ˜çº¿/è„‰å†²æ„Ÿâ€
          sampling: 'lttb',              // å…³é”®ï¼šå¤§å¹…å‡è½»æ¸²æŸ“è´Ÿæ‹…
          large: true,
          largeThreshold: 2000,
          progressive: 8000,
          progressiveThreshold: 3000,
          clip: true,
          ...(s || {})
        }));
    
        const dataZoom = (option.dataZoom || []).map(z => ({
          throttle: 50,
          // ä¸æ”¹å˜ä½ çš„ç±»å‹/ä½ç½®ï¼Œä»…è¡¥ä¸Šé˜²æŠ–
          ...z
        }));
    
        return {
          animation: false,
          grid: { containLabel: true, ...(option.grid||{}) },
          xAxis: xAxes.length ? (Array.isArray(option.xAxis) ? xAxes : xAxes[0]) : option.xAxis,
          yAxis: yAxes.length ? (Array.isArray(option.yAxis) ? yAxes : yAxes[0]) : option.yAxis,
          series,
          dataZoom,
          ...option
        };
      })();
    
      // 3) æ¸²æŸ“ï¼ˆnotMerge + lazyUpdate æ›´ç¨³ï¼‰
      chart.setOption(enriched, { notMerge: true, lazyUpdate: true });
    
      // 4) å°ºå¯¸ç›‘å¬ï¼ˆé¿å…ç¼©æ”¾/åˆ‡æ¢åç™½å±ï¼‰
      if (!ez._ro) {
        ez._ro = new ResizeObserver(() => {
          try { chart.resize(); } catch(e){}
        });
      }
      ez._ro.observe(el);
    
      return chart;
    }




    

    /* =============== ç‰¹å®šå·¥å•†æŸ¥è¯¢ Routine åŒºåŸŸ =============== */
    (function(){
      "use strict";

      /* ---------- é€šç”¨å°å·¥å…· ---------- */

      // é‡‘é¢ï¼šå•ä½â€œä¸‡â€çš„æ ¼å¼åŒ–
      window.fmtWan = window.fmtWan || (n => {
        const v = Number(n) || 0;
        return v.toLocaleString('zh-CN');
      });

      // ç®€å•åˆ†é¡µ
      window.paginate = window.paginate || function(arr, page, size){
        const ps = Number(size) || 10;
        const p  = Math.max(1, Number(page) || 1);
        return (arr || []).slice((p-1)*ps, p*ps);
      };

      // åˆ†é¡µæŒ‰é’®
      window.renderPagination = window.renderPagination || function(eleId, total, current, handler){
        const ps    = 10;
        const pages = Math.max(1, Math.ceil((total||0)/ps));
        const host  = document.getElementById(eleId);
        if (!host) return;
        let html = '';
        for (let i = 1; i <= pages; i++){
          html += `<button class="btn ${i===current?'btn-primary':''}" onclick="${handler}(${i})">${i}</button>`;
        }
        host.innerHTML = html;
      };

      // echarts å¿«æ·æ¸²æŸ“
      window.ez = window.ez || function(domId,opt){
        if (typeof echarts === 'undefined') {
          console.error('[Routine] echarts æœªåŠ è½½');
          return null;
        }
        const el = document.getElementById(domId);
        if(!el) return null;
        const inst = echarts.getInstanceByDom(el) || echarts.init(el, null, {renderer:'canvas', useDirtyRect:true});
        inst.setOption(opt, {notMerge:true, lazyUpdate:true});
        return inst;
      };

      // è‹¥å¤–é¢æ²¡å®šä¹‰ Top20ï¼Œç»™ä¸ªç©ºå‡½æ•°é˜²æŠ¥é”™
      window.renderTop20 = window.renderTop20 || function(){};
      
      
      /* ---------- Routine é»˜è®¤é…ç½®ï¼ˆ1 & 2ï¼‰ ---------- */
      const ROUTINE_DEFAULTS = {
        // 1. ç»è¥æ—¶é—´è¾ƒçŸ­
        '2.1': { years: [1, 3, 5], labels: ['1å¹´å†…','1-3å¹´','3-5å¹´','5å¹´ä»¥ä¸Š'] },
        // 2. ç¤¾ä¿ç¼´çº³äººæ•°è¾ƒå°‘
        '2.2': { breaks:[50,100,500], labels: ['<=50','51-99','100-499','â‰¥500'] },
        '2.4': { breaks:[0.5,2,10], labels: ['<=0.5','0.5-2','2-10','â‰¥10'] }

      };

      

      /* ---------- Routine3 ç±»å‹å®šä¹‰ï¼š6 ä¸ªå¡ç‰‡ ---------- */
      const ROUTINE3_TYPES = [
        { key:'ä¸ªä½“å·¥å•†æˆ·',  class:'kpi-red',    color:'#ef4444' }, // çº¢
        { key:'ä¸ªäººç‹¬èµ„ä¼ä¸š', class:'kpi-orange', color:'#f59e0b' }, // é»„
        { key:'åˆä¼™ä¼ä¸š',    class:'kpi-blue',   color:'#2563eb' }, // è“
        { key:'æœ‰é™è´£ä»»å…¬å¸', class:'kpi-blue',   color:'#2563eb' }, // è“
        { key:'è‚¡ä»½æœ‰é™å…¬å¸', class:'kpi-blue',   color:'#2563eb' }, // è“
        { key:'å…¶ä»–',        class:'kpi-blue',   color:'#2563eb' }  // è“
      ];

      /* ---------- å…¨å±€çŠ¶æ€ ---------- */
      const routineState = {
        code: '2.1',       // '2.1' | '2.2' | '2.3'
        labels: [],
        breaks: [],
        raw: [],
        list: []
      };

      /* ---------- demo æ•°æ®ï¼ˆæ²¡ä¼  companies å°±é€ ä¸€æ‰¹ï¼‰ ---------- */
      function generateDemoCompanies(){
        const types = ['ä¸ªä½“å·¥å•†æˆ·','ä¸ªäººç‹¬èµ„ä¼ä¸š','åˆä¼™ä¼ä¸š','æœ‰é™è´£ä»»å…¬å¸','è‚¡ä»½æœ‰é™å…¬å¸','å…¶ä»–'];
        const arr = [];
        for(let i=1;i<=80;i++){
          const ctype = types[Math.floor(Math.random()*types.length)];
          const txCnt  = Math.floor(Math.random()*200)+1;          // 1~200 ç¬”
          const total  = Math.floor((Math.random()*40000)+2000);   // 2,000~42,000 ä¸‡
          const inflow = total * (0.5 + Math.random()*0.4);
          const outflow= total - inflow;
          const employees = Math.floor(Math.random()*300);
          const days = Math.floor(Math.random()*365*8); // 8å¹´å†…

          arr.push({
            id: i,
            name: 'å¯¹æ‰‹æ–¹'+i,
            ctype,
            relation: (Math.random()<0.2?'å…³è”':'éå…³è”'),
            sales: 'é”€å”®ç±»åˆ«'+((i%4)+1),
            purchase: 'é‡‡è´­ç±»åˆ«'+((i%4)+1),
            job: 'å²—ä½'+((i%5)+1),
            industry: 'è¡Œä¸š'+((i%6)+1),
            capital: (Math.random()*5000).toFixed(0),
            foundedDate: null,
            employees,
            type: '',
            txCnt,
            inflow,
            outflow,
            total,
            foundedDays: days
          });
        }
        return arr;
      }

      function daysSince(dateStr){
        if (!dateStr) return 0;
        const d = new Date(String(dateStr).replace(/-/g,'/'));
        if (isNaN(d)) return 0;
        return Math.max(0, Math.floor((Date.now()-d.getTime())/86400000));
      }

      function mapRecord(raw){
        return {
          id: raw.id,
          name: raw.name,
          ctype: raw.ctype,
          relation: raw.relation,
          sales: raw.sales,
          purchase: raw.purchase,
          job: raw.job,
          industry: raw.industry,
          capital: raw.capital,
          foundedDate: raw.foundedDate || raw.startDate || '',
          employees: Number(raw.employees)||0,
          type: raw.type,
          txCnt: Number(raw.txCnt)||0,
          inflow: Number(raw.inflow)||0,
          outflow: Number(raw.outflow)||0,
          total: Number(raw.total)||0,
          foundedDays: raw.foundedDays ?? daysSince(raw.startDate || raw.foundedDate)
        };
      }

      // æŠŠå½“å‰ window.companies åˆ·åˆ° routineState.list
      function refreshListFromCompanies(){
        if (!Array.isArray(window.companies) || !window.companies.length){
          window.companies = generateDemoCompanies();
        }
        routineState.raw  = window.companies;
        routineState.list = routineState.raw.map(mapRecord);
      }

      /* ---------- ç®±çº¿å›¾ç»Ÿè®¡ ---------- */
      function quartiles(arr){
        const a = arr.slice().sort((x,y)=>x-y);
        if (!a.length) return [0,0,0,0,0];
        const q = p => {
          const pos = (a.length - 1) * p;
          const lo  = Math.floor(pos);
          const hi  = Math.ceil(pos);
          return a[lo]*(hi-pos) + a[hi]*(pos-lo);
        };
        return [a[0], q(0.25), q(0.5), q(0.75), a[a.length-1]];
      }

      // å°ç®±çº¿ï¼šç™½è‰² + tooltip æ˜¾ç¤º min/max/median/Q1/Q3
      function renderSmallBoxplot(domId, stats, title){
        const el = document.getElementById(domId);
        if (!el) return;
        const inst = echarts.getInstanceByDom(el) || echarts.init(el);
        inst.setOption({
          grid:{left:0,right:0,top:0,bottom:0},
          xAxis:{ type:'category', data:[' '], show:false },
          yAxis:{ type:'value', show:false },
          tooltip:{
            confine:true,
            formatter: () => {
              const [min,q1,med,q3,max] = stats;
              return [
                `<b>${title||''}</b>`,
                `æœ€å°å€¼ï¼š${fmtWan(min)} ä¸‡`,
                `æœ€å¤§å€¼ï¼š${fmtWan(max)} ä¸‡`,
                `ä¸­ä½æ•°ï¼š${fmtWan(med)} ä¸‡`,
                `å››åˆ†ä¹‹ä¸€ä½ï¼š${fmtWan(q1)} ä¸‡`,
                `å››åˆ†ä¹‹ä¸‰ä½ï¼š${fmtWan(q3)} ä¸‡`
              ].join('<br/>');
            }
          },
          series:[{
            type:'boxplot',
            itemStyle:{
              color:'rgba(225,225,225,0)',
              borderColor:'#ffffff'
              
            },
            data:[stats]
          }]
        });
      }

      /* ---------- Routine1/2 åˆ†ç»„ï¼šæŒ‰ breaks åˆ† 4 æ®µ ---------- */
      function groupByBreaks(list){
        const b = routineState.breaks || [];
        const code = routineState.code;
        const groups = [[],[],[],[]];
        list.forEach(r=>{
          const x = (code==='2.1') ? r.foundedDays : r.employees;
          let idx = 3;
          if (b && b.length===3){
            idx = (x < b[0]) ? 0 : (x < b[1]) ? 1 : (x < b[2]) ? 2 : 3;
          }
          groups[idx].push(r);
        });
        return groups;
      }

      /* ---------- Routine3 åˆ†ç»„ï¼šæŒ‰ä¼ä¸šç±»å‹ 6 ç»„ ---------- */
      function groupForRoutine3(list){
        const groups = [[],[],[],[],[],[]];
        list.forEach(r=>{
          const t = (r.ctype || '').trim();
          let idx = 5; // é»˜è®¤â€œå…¶ä»–â€
          if (t === 'ä¸ªä½“å·¥å•†æˆ·') idx = 0;
          else if (t === 'ä¸ªäººç‹¬èµ„ä¼ä¸š') idx = 1;
          else if (t === 'åˆä¼™ä¼ä¸š') idx = 2;
          else if (t === 'æœ‰é™è´£ä»»å…¬å¸') idx = 3;
          else if (t === 'è‚¡ä»½æœ‰é™å…¬å¸') idx = 4;
          groups[idx].push(r);
        });
        return groups;
      }

      /* ---------- é¡¶éƒ¨ 4/6 å¡ç‰‡ ---------- */
      function renderRoutineStrip(){
      const list = (routineState.list||[]).slice();
      const code = routineState.code;
      const host = document.getElementById('topStrip');
      if (!host) return;

      let html = '';

      if (code === '2.3'){
        // Routine3ï¼š6 ä¸ªå¡ç‰‡
        const groups = groupForRoutine3(list);
        html = groups.map((g,i)=>{
          const tp = ROUTINE3_TYPES[i];
          const inSum  = g.reduce((s,x)=>s+x.inflow,0);
          const outSum = g.reduce((s,x)=>s+x.outflow,0);
          const vals   = g.map(x=>x.total);
          const stats  = vals.length ? quartiles(vals) : [0,0,0,0,0];
          const bpId   = `kpi-bp-3-${i}`;

          return `
            <div class="kpi-box-card ${tp.class}">
              <div class="kpi-left">
                <div class="kpi-title">${tp.key}</div>
                <div class="kpi-item"><span>å¯¹æ‰‹æ–¹æ•°é‡ï¼š</span><b>${g.length}</b> å®¶</div>
                <div class="kpi-item"><span>ç´¯è®¡æµå…¥ï¼š</span><b>${fmtWan(inSum)}</b> ä¸‡</div>
                <div class="kpi-item"><span>ç´¯è®¡æµå‡ºï¼š</span><b>${fmtWan(outSum)}</b> ä¸‡</div>
              </div>
              <div class="kpi-boxplot">
                <div class="boxplot-chart" id="${bpId}"></div>
              </div>
            </div>`;
        }).join('');

        host.innerHTML = html;

        // ç”¨ä¸Šé¢åŒä¸€ä¸ª groups ç”» 6 ä¸ªç®±çº¿å›¾ï¼Œä¸è¦å† const groups äº†
        groups.forEach((g,i)=>{
          const vals  = g.map(x=>x.total);
          const stats = vals.length ? quartiles(vals) : [0,0,0,0,0];
          renderSmallBoxplot(`kpi-bp-3-${i}`, stats, ROUTINE3_TYPES[i].key);
        });

      } else {
        // Routine1 / Routine2 åŸæ¥çš„åˆ†æ®µé€»è¾‘ä¿æŒä¸å˜
        const groups = groupByBreaks(list);
        const lab  = routineState.labels || [];
        const colorClass = ['kpi-red','kpi-orange','kpi-blue','kpi-blue'];

        html = groups.map((g,i)=>{
          const inSum  = g.reduce((s,x)=>s+x.inflow,0);
          const outSum = g.reduce((s,x)=>s+x.outflow,0);
          const vals   = g.map(x=>x.total);
          const stats  = vals.length ? quartiles(vals) : [0,0,0,0,0];
          const bpId   = `kpi-bp-${i}`;
          return `
            <div class="kpi-box-card ${colorClass[i]}">
              <div class="kpi-left">
                <div class="kpi-title">${lab[i] || ('åŒºé—´'+(i+1))}</div>
                <div class="kpi-item"><span>å¯¹æ‰‹æ–¹æ•°é‡ï¼š</span><b>${g.length}</b> å®¶</div>
                <div class="kpi-item"><span>ç´¯è®¡æµå…¥ï¼š</span><b>${fmtWan(inSum)}</b> ä¸‡</div>
                <div class="kpi-item"><span>ç´¯è®¡æµå‡ºï¼š</span><b>${fmtWan(outSum)}</b> ä¸‡</div>
              </div>
              <div class="kpi-boxplot">
                <div class="boxplot-chart" id="${bpId}"></div>
              </div>
            </div>`;
        }).join('');

        host.innerHTML = html;

        const groups2 = groupByBreaks(list);
        groups2.forEach((g,i)=>{
          const vals  = g.map(x=>x.total);
          const stats = vals.length ? quartiles(vals) : [0,0,0,0,0];
          renderSmallBoxplot(`kpi-bp-${i}`, stats, routineState.labels[i]);
        });
      }
    }

      /* ---------- æ°”æ³¡å›¾ / æ•£ç‚¹å›¾ ---------- */
      function renderScatterAndBox(){
        const list  = (routineState.list || []).slice();
        const code  = routineState.code;

        let xName = 'X';
        if (code === '2.1') xName = 'ç»è¥å¤©æ•°';
        else if (code === '2.2') xName = 'ç¼´çº³äººæ•°';
        else if (code === '2.3') xName = 'äº¤æ˜“ç¬”æ•°';

        let groups, series;

        if (code === '2.3'){
          // Routine3ï¼šæŒ‰ 6 ç±»å‹åˆ†ç»„ï¼ŒX=txCnt, Y=total
          groups = groupForRoutine3(list);
          series = groups.map((g,i)=>({
            name: ROUTINE3_TYPES[i].key,
            type:'scatter',
            data: g.map(r=>({
              name: r.name,
              value: [r.txCnt, r.total],
              symbolSize: Math.max(10, Math.sqrt(Math.abs(r.total||0))/40 + 8),
              itemStyle:{ color: ROUTINE3_TYPES[i].color },
              extra: r
            })),
            emphasis:{ focus:'series', scale:1.15 }
          }));
        } else {
          // Routine1/2ï¼šæŒ‰ breaks åˆ† 4 ç»„ï¼ŒX=days or employees, Y=total
          groups = groupByBreaks(list);
          const colors = ['#ef4444','#f59e0b','#2563eb','#2563eb'];
          series = groups.map((g,i)=>({
            name: routineState.labels[i] || ('åŒºé—´'+(i+1)),
            type:'scatter',
            data: g.map(r=>{
              const xVal = (code==='2.1') ? r.foundedDays : r.employees;
              return {
                name: r.name,
                value: [xVal, r.total],
                symbolSize: Math.max(10, Math.sqrt(Math.abs(r.total||0))/40 + 8),
                itemStyle:{ color: colors[i] },
                extra: r
              };
            }),
            emphasis:{ focus:'series', scale:1.15 }
          }));
        }

        // === ä¸“ä¸ºâ€œå·¦ä¸‹ç•™è¶³ç©ºé—´â€å®šçš„å¸¸é‡ ===
        const SLIDER_H   = 20;   // åº•éƒ¨æ»‘å—é«˜åº¦
        const GAP        = 5;   // è½´æ ‡ç­¾ä¸æ»‘å—çš„é—´è·
        const X_LABEL_H  = 5;   // xè½´åˆ»åº¦ä¸åç§°æ‰€éœ€é«˜åº¦
        const GRID_LEFT  = 15;   // å·¦ä¾§ç»™yè½´åˆ»åº¦ç•™çš„ç©ºé—´
        const GRID_right  = 56;
        const GRID_TOP   = 44;   // ä»…æŠŠâ€œç»˜å›¾åŒºâ€å‘ä¸‹ç§»ï¼Œæ ‡é¢˜ä¸åŠ¨
        const GRID_BOTTOM= SLIDER_H + GAP + X_LABEL_H;

        ez('chart-scatter',{
          grid:{ left: GRID_LEFT, GRID_right, top: GRID_TOP, bottom: GRID_BOTTOM, containLabel: true },

          legend:{ top: 6, right: 10, icon:'circle', itemWidth:8, itemHeight:8, textStyle:{ fontSize:11 }},

          tooltip: {
            trigger: "item",
            formatter: p => {
              const d = p.data.extra;
              const seriesName = p.seriesName || "";
              const xVal =
                code === "2.1"
                  ? d.foundedDays + " å¤©"
                  : code === "2.2"
                  ? d.employees + " äºº"
                  : "#" + (p.dataIndex + 1);

              return [
                `<b>${d.name}</b>`,
                seriesName ? `æ‰€å±åŒºé—´ï¼š${seriesName}` : "",
                `Xï¼š${xVal}`,
                `æµå…¥ï¼š${fmtWan(d.inflow)} ä¸‡`,
                `æµå‡ºï¼š${fmtWan(d.outflow)} ä¸‡`,
                `äº¤æ˜“é¢ï¼š<b>${fmtWan(d.total)} ä¸‡</b>`,
                `äº¤æ˜“ç¬”æ•°ï¼š${d.txCnt || 0}`
              ]
                .filter(Boolean)
                .join("<br/>");
            }
          },

          xAxis:{
            name: xName,
            type:'value',
            axisLine:{ onZero:false },
            axisLabel:{ fontSize:11, margin: 16 },  // ä¸æ»‘å—æ‹‰å¼€
            nameTextStyle:{ fontSize:12 },
            nameGap: 20
          },
          yAxis:{
            name:'äº¤æ˜“é‡‘é¢(ä¸‡)',
            type:'value',
            axisLabel:{ fontSize:11, margin: 10 },
            nameTextStyle:{ fontSize:12 },
            nameGap: 18
          },

          dataZoom:[
            { type:'inside', xAxisIndex:0, filterMode:'none' },
            {
              type:'slider',
              xAxisIndex:0,
              height: SLIDER_H,
              bottom: 6,                           // æ»‘å—å†å¾€ä¸‹ 6px ç¼“å†²
              borderColor:'#e5e7eb',
              backgroundColor:'#f1f5f9',
              fillerColor:'rgba(37,99,235,0.18)',
              showDetail:false
            }
          ],

          series   // â† ä¿æŒä½ ç°æœ‰çš„ series
        });
        // æ”¾åœ¨ä¸Šé¢é‚£æ®µ ez(...) è°ƒç”¨çš„åé¢ç´§è·Ÿç€
        setTimeout(()=>{
          const el = document.getElementById('chart-scatter');
          const inst = el && echarts.getInstanceByDom(el);
          inst && inst.resize();
        }, 0);

        // å…¨å±€ç›‘å¬çª—å£å°ºå¯¸å˜åŒ–ï¼ˆè‹¥æ²¡æœ‰çš„è¯å¯ä»¥åŠ ä¸Šï¼‰
        window.addEventListener('resize', ()=>{
          const el = document.getElementById('chart-scatter');
          const inst = el && echarts.getInstanceByDom(el);
          inst && inst.resize();
        });
        const __pendingCharts = new Map();  // domId -> option

        window.ez = function(domId, opt){
          if (typeof echarts === 'undefined') {
            console.error('[Routine] echarts æœªåŠ è½½'); return null;
          }
          const el = document.getElementById(domId);
          if (!el) return null;

          // è‹¥å®¹å™¨ä¸å¯è§æˆ–å®½é«˜ä¸º 0ï¼Œå…ˆç¼“å­˜ï¼Œç­‰æ˜¾ç¤ºåå†æ¸²æŸ“
          const invisible = (el.offsetParent === null) || (el.clientWidth === 0) || (el.clientHeight === 0);
          if (invisible) { __pendingCharts.set(domId, opt); return null; }

          let inst = echarts.getInstanceByDom(el);
          if (!inst) inst = echarts.init(el, null, {renderer:'canvas', useDirtyRect:true});
          inst.setOption(opt, {notMerge:true, lazyUpdate:true});
          return inst;
        };
      }

      // åˆ·æ–°æš‚å­˜çš„å›¾ + å¯¹ pane å†…æ‰€æœ‰å›¾ resize
      window.flushChartsInPane = function(paneSel){
        // å…ˆè¡¥æ¸²æŸ“ pending
        __pendingCharts.forEach((opt, id)=>{
          const el = document.getElementById(id);
          if (el && el.clientWidth > 0 && el.clientHeight > 0 && (!paneSel || el.closest(paneSel))){
            __pendingCharts.delete(id);
            window.ez(id, opt);
          }
        });
        // å†ç»Ÿä¸€ resize å·²æœ‰å®ä¾‹
        if (paneSel){
          document.querySelectorAll(`${paneSel} .boxplot-chart, ${paneSel} [id^="chart-"], ${paneSel} #chart-scatter`)
            .forEach(el=>{
              const inst = echarts.getInstanceByDom(el);
              if (inst) inst.resize();
            });
        }
      };

 
      /* ---------- äº¤æ˜“æ˜ç»†è¡¨ï¼ˆä¸€ä¸ªè¡¨ï¼Œå…±ç”¨ï¼‰ ---------- */
      let currentRoutinePage = 1;
      window.gotoRoutine = function(p){ currentRoutinePage = p; renderRoutineTable(); };

      function renderRoutineTable(){
        const list = (routineState.list||[]).slice();
        const pageItems = paginate(list, currentRoutinePage, 10);
        const thead = document.querySelector('#tblRoutineDetail thead');
        const tbody = document.querySelector('#tblRoutineDetail tbody');
        if (!thead || !tbody) return;

        thead.innerHTML = `
          <tr>
            <th>å¯¹æ‰‹æ–¹åç§°</th><th>æµå…¥æ€»é¢</th><th>æµå‡ºæ€»é¢</th><th>äº¤æ˜“æ€»é¢</th>
            <th>å¼‚å¸¸äº¤æ˜“æ€»é¢</th><th>å æ¯”1</th><th>å æ¯”2</th>
            <th>å¼‚å¸¸äº¤æ˜“ç¬”æ•°</th><th>äº¤æ˜“æ¬¡æ•°</th><th>å¯¹æ‰‹æ–¹ç±»å‹</th>
            <th>å…³è”å…³ç³»</th><th>é”€å”®ç±»åˆ«</th><th>é‡‡è´­ç±»åˆ«</th>
            <th>èŒä½</th><th>æ‰€å±é›†å›¢</th>
          </tr>`;

        tbody.innerHTML = pageItems.map(d=>`
          <tr>
            <td>${d.name||'-'}</td>
            <td style="color:#2563eb">${fmtWan(d.inflow)}</td>
            <td style="color:#ef4444">${fmtWan(d.outflow)}</td>
            <td><b>${fmtWan(d.total)}</b></td>
            <td>${fmtWan(d.outflow*0.15)}</td>
            <td>${(Math.random()*10).toFixed(2)}%</td>
            <td>${(Math.random()*5).toFixed(2)}%</td>
            <td>${Math.floor((d.txCnt||0)*0.1)}</td>
            <td>${d.txCnt||0}</td>
            <td>${d.ctype||'-'}</td>
            <td>${d.relation||'-'}</td>
            <td>${d.sales||'-'}</td>
            <td>${d.purchase||'-'}</td>
            <td>${d.job||'-'}</td>
            <td>é›†å›¢${(d.id||0)%5+1}</td>
          </tr>`).join('');

        renderPagination('pagination-routine', list.length, currentRoutinePage, 'gotoRoutine');
      }

      /* ---------- ä¸€é”®åˆ·æ–° ---------- */
      function updateAllRoutineViews(){
        refreshListFromCompanies();       // å…ˆä¿è¯ list æœ‰æ•°æ®
        renderRoutineStrip();
        renderScatterAndBox();
        renderTop20();
        renderRoutineTable();
      }

      /* ---------- å·¦ä¾§èœå•åˆ‡æ¢ ---------- */
      const routineMenu = document.getElementById('routineMenu');
      routineMenu && routineMenu.addEventListener('click', e=>{
        const it = e.target.closest('.item'); if (!it) return;
        [...routineMenu.children].forEach(m=>m.classList.remove('active'));
        it.classList.add('active');
        renderRoutine(it.dataset.code);
      });


      /* ---------- åˆ‡æ¢ Routine 1 / 2 / 3 / 4 ---------- */
      /* ---------- åˆ‡æ¢ Routine 1 / 2 / 3 / 4 / 7 ---------- */
      function renderRoutine(code){
        routineState.code = code;
        document.getElementById('pane-routine').setAttribute('data-routine', code);

        // â˜…â˜… 2.7ï¼šåªæ˜¾ç¤ºåœ°å›¾é¡µï¼Œéšè—é€šç”¨å—
        const r7xBlock = document.getElementById('r7x');
        const commonBlock = document.getElementById('routineCommon');

        if (code === '2.7') {
          if (commonBlock) commonBlock.style.display = 'none';
          if (r7xBlock) { r7xBlock.style.display = ''; }
          if (window.R7X && typeof window.R7X.show === 'function') {
            window.R7X.show();
          }
          return; // ä¸å†å¾€ä¸‹è·‘å…¶å®ƒ Routine çš„æ›´æ–°é€»è¾‘
        } else {
          // ç¦»å¼€ 2.7ï¼Œéšè—åœ°å›¾å—ï¼Œæ¢å¤é€šç”¨åŒº
          if (r7xBlock) r7xBlock.style.display = 'none';
          if (window.R7X && typeof window.R7X.hide === 'function') window.R7X.hide();
          if (commonBlock) commonBlock.style.display = '';
        }

        // ä¸‹é¢ä»æ˜¯ä½ åŸæœ‰çš„ 2.1~2.4 åˆ†æ”¯
        if (code==='2.1'){
          routineState.breaks = ROUTINE_DEFAULTS['2.1'].years.map(x=>x*365);
          routineState.labels = ROUTINE_DEFAULTS['2.1'].labels.slice();
          const t1 = document.getElementById('rTitle'); if(t1) t1.textContent = 'ç»è¥æ—¶é—´æ±‡æ€»æŒ‡æ ‡';
          const st = document.getElementById('scatterTitle'); if(st) st.textContent = 'ç»è¥æ—¶é—´åˆ†å¸ƒè¡¨';
        } else if (code==='2.2'){
          routineState.breaks = ROUTINE_DEFAULTS['2.2'].breaks.slice();
          routineState.labels = ROUTINE_DEFAULTS['2.2'].labels.slice();
          const t1 = document.getElementById('rTitle'); if(t1) t1.textContent = 'ç¤¾ä¿ç¼´çº³äººæ•°æ±‡æ€»æŒ‡æ ‡';
          const st = document.getElementById('scatterTitle'); if(st) st.textContent = 'ç¤¾ä¿ç¼´çº³äººæ•°åˆ†å¸ƒè¡¨';
        } else if (code==='2.3'){
          routineState.breaks = [];
          routineState.labels = ROUTINE3_TYPES.map(x=>x.key);
          const t1 = document.getElementById('rTitle'); if(t1) t1.textContent = 'ä¸»ä½“ç±»å‹æ±‡æ€»æŒ‡æ ‡';
          const st = document.getElementById('scatterTitle'); if(st) st.textContent = 'ä¸»ä½“ç±»å‹åˆ†å¸ƒè¡¨';
        } else if (code==='2.4'){
          routineState.breaks = ROUTINE_DEFAULTS['2.4'].breaks.slice();
          routineState.labels = ROUTINE_DEFAULTS['2.4'].labels.slice();
          const t1 = document.getElementById('rTitle'); if(t1) t1.textContent = 'äº¤æ˜“æ€»é¢/æ³¨å†Œèµ„æœ¬ æ±‡æ€»æŒ‡æ ‡';
          const st = document.getElementById('scatterTitle'); if(st) st.textContent = 'äº¤æ˜“è§„æ¨¡åˆ†å¸ƒè¡¨';
        }

        currentRoutinePage = 1;
        if (typeof updateAllRoutineViews === 'function') updateAllRoutineViews();
      }

      // åˆå§‹è¿›å…¥ï¼šRoutine1
      renderRoutine('2.1');
    })();


    /* ========== Routine7 æ¨¡å—ï¼šå·¦æŒ‡æ ‡ï½œå³åœ°å›¾ï¼Œå«æ¨¡æ‹Ÿæ•°æ® ========== */
    /* ========== Routine7 å¸¸é‡ ========== */
    const R7X_LEVELS = {
      city:     { label:'åŒå¸‚',     color:'#2563eb' },
      district: { label:'åŒåŒº/å¿',  color:'#16a34a' },
      street:   { label:'åŒè¡—é“',   color:'#f59e0b' },
      near:     { label:'è·ç¦»<1km', color:'#ef4444' },
      other:    { label:'å…¶ä»–',     color:'#334155' }
    };

    function toRad(d){ return d*Math.PI/180; }
    function haversine(a,b){
      const R=6371;
      const dLat=toRad((b.lat||0)-(a.lat||0));
      const dLng=toRad((b.lng||0)-(a.lng||0));
      const s1=Math.sin(dLat/2), s2=Math.sin(dLng/2);
      return 2*R*Math.asin(Math.sqrt(s1*s1 + Math.cos(toRad(a.lat||0))*Math.cos(toRad(b.lat||0))*s2*s2));
    }
    function fmtWan(n){ return (Number(n)||0).toLocaleString('zh-CN'); }

    /* ========== Demo æ•°æ®å…œåº•ï¼ˆä½ æœ‰çœŸå®æ•°æ®æ—¶ï¼Œä¼šè¢«è¦†ç›–ï¼‰ ========== */
    if(!window.auditUnits){
      window.auditUnits = [
        { id:'A', name:'è¢«å®¡è®¡å•ä½Aï¼ˆåŒ—äº¬ï¼‰', city:'åŒ—äº¬å¸‚', district:'æœé˜³åŒº', street:'å»ºå›½è·¯', lng:116.4736, lat:39.9146 },
        { id:'B', name:'è¢«å®¡è®¡å•ä½Bï¼ˆä¸Šæµ·ï¼‰', city:'ä¸Šæµ·å¸‚', district:'æµ¦ä¸œæ–°åŒº', street:'ä¸–çºªå¤§é“', lng:121.5120, lat:31.2400 },
      ];
    }
    if(!Array.isArray(window.companies) || !window.companies.length){
      const genAround = (anchor, n=100) => {
        const arr=[];
        for(let i=0;i<n;i++){
          const km = (Math.random()<0.75 ? (Math.random()*4 + 0.2) : (Math.random()*20 + 5));
          const brg = Math.random()*360;
          const dLat = (km/111) * Math.cos(toRad(brg));
          const dLng = (km/(111*Math.cos(toRad(anchor.lat)))) * Math.sin(toRad(brg));
          const inflow  = Math.floor(Math.random()*8000+500);
          const outflow = Math.floor(Math.random()*6000+300);
          arr.push({
            id:`${anchor.id}-${i+1}`,
            name:`å¯¹æ‰‹æ–¹_${anchor.id}_${i+1}`,
            city: anchor.city,
            district: i%2? anchor.district : 'å…¶ä»–åŒº',
            street: i%3? anchor.street : 'å…¶ä»–è¡—',
            lng: anchor.lng + dLng, lat: anchor.lat + dLat,
            inflow, outflow, total: inflow+outflow
          });
        }
        return arr;
      };
      window.companies = [...genAround(window.auditUnits[0]), ...genAround(window.auditUnits[1])];
    }

    /* ========== Routine7 æ¨¡å— ========== */
    (function(){
      let map, groups, anchorMarker;

      function classify(cp, anchor){
        const d = haversine(cp, anchor); // km
        if (d < 1) return {level:'near', dist:d};
        if (cp.street   && anchor.street   && cp.street   === anchor.street)   return {level:'street',   dist:d};
        if (cp.district && anchor.district && cp.district === anchor.district) return {level:'district', dist:d};
        if (cp.city     && anchor.city     && cp.city     === anchor.city)     return {level:'city',     dist:d};
        return {level:'other', dist:d};
      }

      function ensureMap(anchor){
        if (map) return;
        map = L.map('r7xMap', { zoomControl:false, attributionControl:false });
        L.control.zoom({ position:'topleft' }).addTo(map);
        L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {maxZoom:19}).addTo(map);

        groups = {
          city: L.layerGroup().addTo(map),
          district: L.layerGroup().addTo(map),
          street: L.layerGroup().addTo(map),
          near: L.layerGroup().addTo(map),
          other: L.layerGroup().addTo(map),
        };

        const starSvg = `
          <svg xmlns="http://www.w3.org/2000/svg" width="28" height="28" viewBox="0 0 24 24">
            <path fill="#111827" d="M12 2l3 6 6 .9-4.5 4.4 1 6.3L12 17l-5.5 2.6 1-6.3L3 8.9 9 8z" opacity=".9"/>
            <circle cx="12" cy="12" r="2" fill="#f59e0b"/>
          </svg>`;
        const starIcon = L.divIcon({ className:'', html:starSvg, iconSize:[28,28], iconAnchor:[14,14] });
        anchorMarker = L.marker([anchor.lat, anchor.lng], { icon: starIcon })
          .bindPopup(`<b>${anchor.name}</b><br>é”šç‚¹ï¼ˆè¢«å®¡è®¡å•ä½ï¼‰`)
          .addTo(map);
      }

      function setKpi(suffix, o){
        document.getElementById(`r7x${suffix}Cnt`).textContent = String(o.cnt||0);
        document.getElementById(`r7x${suffix}In`).textContent  = fmtWan(o.in||0)+' ä¸‡';
        document.getElementById(`r7x${suffix}Out`).textContent = fmtWan(o.out||0)+' ä¸‡';
      }

      function renderTable(rows){
        const tb = document.querySelector('#r7xTable tbody'); if(!tb) return;
        tb.innerHTML = rows.map(({cp,level,dist})=>`
          <tr>
            <td>${cp.name}</td>
            <td>${R7X_LEVELS[level].label}</td>
            <td>${dist.toFixed(2)}</td>
            <td>${cp.city||'-'}</td>
            <td>${cp.district||'-'}</td>
            <td>${cp.street||'-'}</td>
            <td>${(cp.lng||0).toFixed(5)}</td>
            <td>${(cp.lat||0).toFixed(5)}</td>
            <td>${fmtWan(cp.inflow)}</td>
            <td>${fmtWan(cp.outflow)}</td>
            <td><b>${fmtWan(cp.total)}</b></td>
          </tr>
        `).join('');
      }

      function levelOrder(l){ return ['near','street','district','city','other'].indexOf(l); }

      function refresh(anchor, visible){
        // æ¸…ç©ºå›¾å±‚
        Object.values(groups).forEach(g=>g.clearLayers());
        if (anchorMarker){
          anchorMarker.setLatLng([anchor.lat, anchor.lng]);
          anchorMarker.setPopupContent(`<b>${anchor.name}</b><br>é”šç‚¹ï¼ˆè¢«å®¡è®¡å•ä½ï¼‰`);
        }
        map.setView([anchor.lat, anchor.lng], 12);

        // ç»Ÿè®¡
        const stat = {
          city:{cnt:0,in:0,out:0}, district:{cnt:0,in:0,out:0},
          street:{cnt:0,in:0,out:0}, near:{cnt:0,in:0,out:0}, other:{cnt:0,in:0,out:0}
        };

        const rows = [];
        (window.companies||[]).forEach(cp=>{
          const {level, dist} = classify(cp, anchor);
          stat[level].cnt++; stat[level].in+=cp.inflow; stat[level].out+=cp.outflow;
          if (visible[level]){
            const dot = L.circleMarker([cp.lat, cp.lng], {
              radius: Math.max(5, Math.sqrt(Math.abs(cp.total||0))/60 + 4),
              color: R7X_LEVELS[level].color, fillColor:R7X_LEVELS[level].color, fillOpacity:.85, weight:0.8
            }).bindPopup([
              `<b>${cp.name}</b>`,
              `çº§åˆ«ï¼š${R7X_LEVELS[level].label}`,
              `è·ç¦»ï¼š${dist.toFixed(2)} km`,
              `æµå…¥ï¼š${fmtWan(cp.inflow)} ä¸‡`,
              `æµå‡ºï¼š${fmtWan(cp.outflow)} ä¸‡`,
              `äº¤æ˜“é¢ï¼š<b>${fmtWan(cp.total)} ä¸‡</b>`
            ].join('<br/>'));
            dot.addTo(groups[level]);
            rows.push({cp, level, dist});
          }
        });

        // KPI
        setKpi('City', stat.city);
        setKpi('District', stat.district);
        setKpi('Street', stat.street);
        setKpi('Near', stat.near);
        document.getElementById('r7xAnchorXY').textContent =
          `(${anchor.lng.toFixed(5)}, ${anchor.lat.toFixed(5)})`;

        // æ˜ç»†è¡¨
        rows.sort((a,b)=> a.level===b.level ? a.dist-b.dist : levelOrder(a.level)-levelOrder(b.level));
        renderTable(rows);
      }

      function currentChecks(){
        const ret={};
        const nodes = document.querySelectorAll('#r7x .r7x-filters input[type="checkbox"]');
        if (nodes.length){
          nodes.forEach(ch => ret[ch.value] = !!ch.checked);
        }else{
          ret.city = ret.district = ret.street = ret.near = true;
        }
        return ret;
      }

      function selectedAnchor(){
        const sel = document.getElementById('r7xAuditSel');
        const id  = (sel && sel.value) || window.auditUnits[0].id;
        return window.auditUnits.find(u=>u.id===id) || window.auditUnits[0];
      }

      // å¯¹å¤– APIï¼šshow / hide
      window.R7X = {
        show(){
          const block = document.getElementById('r7x'); if(!block) return;
          // å¡«å……ä¸‹æ‹‰ï¼ˆåªå¡«ä¸€æ¬¡ï¼‰
          const sel = document.getElementById('r7xAuditSel');
          if (sel && !sel.__filled){
            sel.innerHTML = window.auditUnits.map(u=>`<option value="${u.id}">${u.name}</option>`).join('');
            sel.__filled = true;
          }
          const anchor = selectedAnchor();

          // åœ°å›¾åˆå§‹åŒ– + é¦–æ¬¡åˆ·æ–°
          ensureMap(anchor);
          refresh(anchor, currentChecks());

          // ç»‘å®šäº‹ä»¶ï¼ˆåªç»‘ä¸€æ¬¡ï¼‰
          if (sel && !sel.__bound){
            sel.addEventListener('change', ()=> refresh(selectedAnchor(), currentChecks()));
            sel.__bound = true;
          }
          const boxes = document.querySelectorAll('#r7x .r7x-filters input[type="checkbox"]');
          if (boxes.length && !boxes[0].__bound){
            boxes.forEach(ch=>{
              ch.addEventListener('change', ()=> refresh(selectedAnchor(), currentChecks()));
              ch.__bound = true;
            });
          }

          // å°ºå¯¸æ ¡æ­£
          requestAnimationFrame(()=> map && map.invalidateSize());
        },
        hide(){
          const block = document.getElementById('r7x');
          if (block) block.style.display = 'none';
        }
      };
    })();
    // å³ä¾§ Routine ä¾§æ æŠ˜å æŒ‰é’®
    (function(){
      const split = document.querySelector('#pane-routine .split');
      const btn   = document.querySelector('#pane-routine .sbar-toggle-inset');
      if (!split || !btn) return;
      btn.addEventListener('click', () => {
        split.classList.toggle('is-collapsed');
      });
    })();

    // åˆå§‹è¿›å…¥
    renderRoutine("2.1");

    // å“åº”å¼ï¼šçª—å£å˜åŒ–æ—¶åŒæ­¥è°ƒæ•´å›¾è¡¨å°ºå¯¸
    window.addEventListener("resize", () => {
      const sc = document.getElementById("chart-scatter");
      if (sc) {
        const inst = echarts.getInstanceByDom(sc);
        inst && inst.resize();
      }
      for (let i = 0; i < 4; i++) {
        const bp = document.getElementById("kpi-bp-" + i);
        if (!bp) continue;
        const inst = echarts.getInstanceByDom(bp);
        inst && inst.resize();
      }
    });

    








    
    
    /* ===== é¡¶éƒ¨é¡µé¢åˆ‡æ¢ + åˆ·æ–°ä¿æŒå½“å‰é¡µ ===== */
    /* ===== é¡¶éƒ¨é¡µé¢åˆ‡æ¢ + åˆ·æ–°ä¿æŒå½“å‰é¡µ ===== */
    const TAB_KEY   = 'topTabs.active';
    const PANE_SEL  = '.tab-pane';
    const ID_PREFIX = 'pane-';
    
    function setPageVisible(key){
      document.querySelectorAll(PANE_SEL).forEach(el=>{
        el.classList.add('hide');
        el.classList.remove('active');
      });
      const tgt = document.getElementById(ID_PREFIX + key);
      if (tgt){
        tgt.classList.remove('hide');
        tgt.classList.add('active');
      }
    }
    
    function setTabActive(key){
      document.querySelectorAll('#topTabs .tab')
        .forEach(el=>el.classList.toggle('active', el.dataset.top === key));
    }
    
    function updateInkbar(key){
      const bar = document.getElementById('inkbar');
      const act = document.querySelector(`#topTabs .tab[data-top="${key}"]`);
      if (!bar || !act) return;
      requestAnimationFrame(()=>{
        bar.style.width = act.offsetWidth + 'px';
        bar.style.left  = act.offsetLeft + 'px';
      });
    }
    
    function activate(key){
      setTabActive(key);
      setPageVisible(key);
      updateInkbar(key);
      localStorage.setItem(TAB_KEY, key);
      setTimeout(()=>window.dispatchEvent(new Event('resize')),50);
    }
    
    document.getElementById('topTabs')?.addEventListener('click', e=>{
      const t = e.target.closest('.tab'); if(!t) return;
      activate(t.dataset.top);
    });
    
    document.addEventListener('DOMContentLoaded', ()=>{
      document.querySelectorAll(PANE_SEL).forEach(el=>el.classList.add('hide'));
      const saved = localStorage.getItem(TAB_KEY) || 'account';
      activate(saved);
    });
    
    window.addEventListener('load', ()=>{
      updateInkbar(localStorage.getItem(TAB_KEY) || 'account');
    });

      
  </script>
</body>
</html>
